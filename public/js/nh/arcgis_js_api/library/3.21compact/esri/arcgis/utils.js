// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.21/esri/copyright.txt for details.
//>>built
require({cache:{"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(n,m,h){n.DeferredList=function(q,p,f,n,u){var r=[];m.call(this);var c=this;0!==q.length||p||this.resolve([0,[]]);var b=0;h.forEach(q,function(d,e){function g(d,a){r[e]=[d,a];b++;b===q.length&&c.resolve(r)}d.then(function(b){p?c.resolve([e,b]):g(!0,b)},function(b){f?c.reject(b):g(!1,b);if(n)return null;throw b;})})};n.DeferredList.prototype=new m;n.DeferredList.prototype.gatherResults=
function(m){m=new n.DeferredList(m,!1,!0,!1);m.addCallback(function(m){var f=[];h.forEach(m,function(h){f.push(h[1])});return f});return m};return n.DeferredList})},"esri/dijit/PopupTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-construct ../kernel ../InfoTemplate ../PopupInfo ./PopupRenderer".split(" "),function(n,m,h,q,p,f,v,u){n=n([f,v],{declaredClass:"esri.dijit.PopupTemplate","-chains-":{constructor:"manual"},chartTheme:null,constructor:function(f,c){m.mixin(this,
c);this.initialize(f,c)},getTitle:function(f){var c;this.info&&(c=this.titleHasRelatedFields?"":this._getPopupValues(f,!0).title);return c||""},getContent:function(f){return this.info?(new u({template:this,graphic:f,chartTheme:this.chartTheme},q.create("div"))).domNode:""}});h("extend-esri")&&m.setObject("dijit.PopupTemplate",n,p);return n})},"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has dojo/Deferred dojo/sniff dojo/promise/all dojox/html/entities ./lang ./kernel ./request ./tasks/query ./tasks/QueryTask ./tasks/RelationshipQuery ./tasks/StatisticDefinition ./renderers/arcadeUtils dojo/i18n!dojo/cldr/nls/number".split(" "),
function(n,m,h,q,p,f,v,u,r,c,b,d,e,g,k,a,l,t,z){n=n(null,{declaredClass:"esri.PopupInfo",_reExprField:/^\s*expression\//i,_exprPrefix:"expression/",_relatedFieldPrefix:"relationships/",initialize:function(a,b){if(a){m.mixin(this,b);this.info=a;this.title=this.getTitle;this.content=this.getContent;this._exprCache=this._compileExpressions(this.info.expressionInfos);var d=this._fieldLabels={},c=this._fieldsMap={};this.info.fieldInfos&&h.forEach(this.info.fieldInfos,function(a){var b=a.fieldName.toLowerCase(),
g=this._isExpressionField(b)?this.getExpressionInfo(b):null;d[b]=g?g.title:a.label;c[b]=a},this);this.titleHasRelatedFields=!(!this.info.title||-1===this.info.title.indexOf("{"+this._relatedFieldPrefix))}},toJson:function(){return q.fromJson(q.toJson(this.info))},getTitle:function(){},getContent:function(){},getFieldInfo:function(a){var b;h.some(this.info&&this.info.fieldInfos,function(d){d.fieldName===a&&(b=d);return!!b});return b},getExpressionInfo:function(a){if(this._isExpressionField(a)){a=a.replace(this._reExprField,
"");a=a.toLowerCase();var b;h.some(this.info.expressionInfos,function(d){d.name.toLowerCase()===a&&(b=d);return!!b});return b}},getComponents:function(a){var b=this.info,d=new v,c,g;b.fieldInfos&&(g=h.filter(b.fieldInfos,function(a){return-1!==a.fieldName.indexOf(this._relatedFieldPrefix)},this));g&&0<g.length&&(c=this._getRelatedRecords({graphic:a,fieldsInfo:g}));c?c.always(m.hitch(this,function(){d.resolve(this._getPopupValues(a))})):d.resolve(this._getPopupValues(a));return d.promise},getAttachments:function(a){var b=
a.getSourceLayer();a=a.attributes;if(this.info.showAttachments&&b&&b.hasAttachments&&b.objectIdField&&(a=a&&a[b.objectIdField]))return b.queryAttachmentInfos(a)},_isExpressionField:function(a){return this._reExprField.test(a)},_compileExpressions:function(a){var b={};h.forEach(a,function(a){b[a.name]={compiledFunc:t.createFunction(a.expression)}});return b},_fetchAttributes:function(a){var b=m.clone(a.attributes)||{},d=this._exprPrefix,g=this._exprCache;h.forEach(this.info.expressionInfos,function(e){var l=
d+e.name;e=g[e.name];e=t.executeFunction(e&&e.compiledFunc,t.createExecContext(a,a._getViewInfo()));"string"===typeof e&&(e=c.encode(e));b[l]=e});return b},_getPopupValues:function(a,d){var g=this.info,c=a.getSourceLayer(),e=this._fetchAttributes(a),l=m.clone(e),k=g.fieldInfos,y="",t="",A,w,z,f,r,u=c&&c._getDateOpts&&c._getDateOpts().properties,u=u&&u.slice(0),p={dateFormat:{properties:u,formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)}};if(this._relatedInfo)for(f in this._relatedInfo)if(this._relatedInfo.hasOwnProperty(f)){var q=
this._relatedInfo[f],n=this._relatedLayersInfo[f];q&&(h.forEach(q.relatedFeatures,function(a){for(r in a.attributes)if(a.attributes.hasOwnProperty(r)&&"esriRelCardinalityOneToOne"===n.relation.cardinality){var b=this._toRelatedFieldName([n.relation.id,r]);e[b]=l[b]=a.attributes[r]}},this),h.forEach(q.relatedStatsFeatures,function(a){for(r in a.attributes)if(a.attributes.hasOwnProperty(r)){var b=this._toRelatedFieldName([n.relation.id,r]);e[b]=l[b]=a.attributes[r]}},this))}k&&h.forEach(k,function(a){w=
a.fieldName;var b=this._getLayerFieldInfo(c,w);b&&(w=a.fieldName=b.name);l[w]=this._formatValue(l[w],w,p);u&&a.format&&a.format.dateFormat&&(a=h.indexOf(u,w),-1<a&&u.splice(a,1))},this);if(c){f=c.types;var v=(q=c.typeIdField)&&e[q];for(w in e)if(e.hasOwnProperty(w)&&-1===w.indexOf(this._relatedFieldPrefix)&&(z=e[w],b.isDefined(z))){var I=this._getDomainName(c,a,f,v,w,z);b.isDefined(I)?l[w]=I:w===q&&(I=this._getTypeName(c,a,z),b.isDefined(I)&&(l[w]=I))}}g.title&&(y=this._processFieldsInLinks(this._fixTokens(g.title,
c),e),y=m.trim(b.substitute(l,y,p)||""));if(d)return{title:y};g.description&&(t=this._processFieldsInLinks(this._fixTokens(g.description,c),e),t=m.trim(b.substitute(l,t,p)||""));k&&(A=[],h.forEach(k,function(a){(w=a.fieldName)&&a.visible&&A.push([this._fieldLabels[w.toLowerCase()]||w,b.substitute(l,"${"+w+"}",p)||""])},this));var L,R;g.mediaInfos&&(L=[],h.forEach(g.mediaInfos,function(a){R=0;z=a.value;switch(a.type){case "image":var d=z.sourceURL,d=d&&m.trim(b.substitute(e,this._fixTokens(d,c)));
R=!!d;break;case "piechart":case "linechart":case "columnchart":case "barchart":var g,d=z.normalizeField;z.fields=h.map(z.fields,function(a){return(g=this._getLayerFieldInfo(c,a))?g.name:a},this);d&&(g=this._getLayerFieldInfo(c,d),z.normalizeField=g?g.name:d);R=h.some(z.fields,function(a){return b.isDefined(e[a])||-1!==a.indexOf(this._relatedFieldPrefix)&&this._relatedInfo},this);break;default:return}if(R){a=m.clone(a);z=a.value;var d=a.title?this._processFieldsInLinks(this._fixTokens(a.title,c),
e):"",k=a.caption?this._processFieldsInLinks(this._fixTokens(a.caption,c),e):"";a.title=d?m.trim(b.substitute(l,d,p)||""):"";a.caption=k?m.trim(b.substitute(l,k,p)||""):"";if("image"===a.type)z.sourceURL=b.substitute(e,this._fixTokens(z.sourceURL,c)),z.linkURL&&(z.linkURL=m.trim(b.substitute(e,this._fixTokens(z.linkURL,c))||""));else{var x,y;h.forEach(z.fields,function(a,b){if(-1!==a.indexOf(this._relatedFieldPrefix))y=this._getRelatedChartInfos(a,z,e,p),y instanceof Array?z.fields=y:z.fields[b]=
y;else{var d=e[a],d=void 0===d?null:d;x=e[z.normalizeField]||0;d&&x&&(d/=x);z.fields[b]={y:d,tooltip:(this._fieldLabels[a.toLowerCase()]||a)+":\x3cbr/\x3e"+this._formatValue(d,a,p,!!x)}}},this)}L.push(a)}},this));return{title:y,description:t,hasDescription:!!g.description,fields:A&&A.length?A:null,mediaInfos:L&&L.length?L:null,formatted:l,editSummary:c&&c.getEditSummary?c.getEditSummary(a):""}},_getRelatedChartInfos:function(a,d,c,e){var g,l,k,x,y,B;g=[];B=this._fromRelatedFieldName(a);y=B[0];l=this._relatedInfo[y];
y=this._relatedLayersInfo[y];l&&h.forEach(l.relatedFeatures,function(l){l=l.attributes;var y,t;for(t in l)if(l.hasOwnProperty(t)&&t===B[1]){y={};x=l[t];d.normalizeField&&(k=-1!==d.normalizeField.indexOf(this._relatedFieldPrefix)?l[this._fromRelatedFieldName(d.normalizeField)[1]]:c[d.normalizeField]);x&&k&&(x/=k);if(d.tooltipField)if(-1!==d.tooltipField.indexOf(this._relatedFieldPrefix)){var A=this._fromRelatedFieldName(d.tooltipField)[1],z=b.isDefined(l[A])?l[A]:A;y.tooltip=z+":\x3cbr/\x3e"+this._formatValue(x,
A,e,!!k)}else y.tooltip=(this._fieldLabels[a.toLowerCase()]||a)+":\x3cbr/\x3e"+this._formatValue(x,d.tooltipField,e,!!k);else y.tooltip=x;y.y=x;g.push(y)}},this);return"esriRelCardinalityOneToMany"===y.relation.cardinality||"esriRelCardinalityManyToMany"===y.relation.cardinality?g:g[0]},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",shortDateLE:"(datePattern: 'd/M/y', selector: 'date')",longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",
longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateLEShortTime:"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLEShortTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",
shortDateLELongTime:"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",shortDateLELongTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",year:"(datePattern: 'y', selector: 'date')"},_reHref:/href\s*=\s*\"([^\"]+)\"/ig,_reHrefApos:/href\s*=\s*\'([^\']+)\'/ig,
_fixTokens:function(a,b){var d=this;return a.replace(/(\{([^\{\r\n]+)\})/g,function(a,c,g){a=d._getLayerFieldInfo(b,g);return"$"+(a?"{"+a.name+"}":c)})},_encodeAttributes:function(a){a=m.clone(a)||{};var b,d;for(b in a)(d=a[b])&&"string"===typeof d&&(d=encodeURIComponent(d).replace(/\'/g,"\x26apos;"),a[b]=d);return a},_processFieldsInLinks:function(a,b){var d=this._encodeAttributes(b),c=this;a&&(a=a.replace(this._reHref,function(a,g){return c._addValuesToHref(a,g,b,d)}).replace(this._reHrefApos,function(a,
g){return c._addValuesToHref(a,g,b,d)}));return a},_addValuesToHref:function(a,d,c,g){d=d&&m.trim(d);return b.substitute(d&&0===d.indexOf("${")?c:g,a)},_getLayerFieldInfo:function(a,b){return a&&a.getField?a.getField(b):null},_formatValue:function(a,d,c,g){var e=this._fieldsMap[d.toLowerCase()],l=e&&e.format;d=-1!==h.indexOf(c.dateFormat.properties,d);var k="number"===typeof a&&!d&&(!l||!l.dateFormat);if(!b.isDefined(a)||!e||!b.isDefined(l))return k?this._forceLTR(a):a;var x="",e=[],t=l.hasOwnProperty("places")||
l.hasOwnProperty("digitSeparator"),y=l.hasOwnProperty("digitSeparator")?l.digitSeparator:!0;if(t&&!d)x="NumberFormat",e.push("places: "+(b.isDefined(l.places)&&(!g||0<l.places)?Number(l.places):"Infinity")),e.length&&(x+="("+e.join(",")+")");else if(l.dateFormat)x="DateFormat"+this._insertOffset(this._dateFormats[l.dateFormat]||this._dateFormats.shortDateShortTime);else return k?this._forceLTR(a):a;var B=this._applyFormatting(a,x,c);t&&-1<a.constructor.toString().indexOf("Array")&&(B="",h.forEach(a,
m.hitch(this,function(a,b){b&&(B+=" ");B+=this._applyFormatting(a,x,c)})));t&&!y&&z.group&&(B=B.replace(new RegExp("\\"+z.group,"g"),""));d&&(B='\x3cspan class\x3d"esriDateValue"\x3e'+B+"\x3c/span\x3e");return k?this._forceLTR(B):B},_applyFormatting:function(a,d,c){return b.substitute({myKey:a},"${myKey:"+d+"}",c)||""},_forceLTR:function(a){var b=u("ie");return b&&10>=b?a:"\x3cspan class\x3d'esriNumericValue'\x3e"+a+"\x3c/span\x3e"},_insertOffset:function(a){a&&(a=b.isDefined(this.utcOffset)?a.replace(/\)\s*$/,
", utcOffset:"+this.utcOffset+")"):a);return a},_getDomainName:function(a,b,d,c,g,e){return(a=a.getDomain&&a.getDomain(g,{feature:b}))&&a.codedValues?a.getName(e):null},_getTypeName:function(a,b,d){return(a=a.getType&&a.getType(b))&&a.name},_getRelatedRecords:function(a){var b=a.graphic,d=new v,c;this._relatedLayersInfo?this._queryRelatedLayers(b).then(m.hitch(this,function(a){this._setRelatedRecords(b,a);d.resolve(a)}),m.hitch(this,this._handlerErrorResponse,d)):this._getRelatedLayersInfo(a).then(m.hitch(this,
function(a){for(c in a)a.hasOwnProperty(c)&&a[c]&&(this._relatedLayersInfo[c].relatedLayerInfo=a[c]);this._queryRelatedLayers(b).then(m.hitch(this,function(a){this._setRelatedRecords(b,a);d.resolve(a)}),m.hitch(this,this._handlerErrorResponse,d))}),m.hitch(this,this._handlerErrorResponse,d));return d.promise},_getRelatedLayersInfo:function(a){var b=a.fieldsInfo,d,c,g={};d=a.graphic.getSourceLayer();this._relatedLayersInfo||(this._relatedLayersInfo={});h.forEach(b,function(a){var b,c,g,e;b=this._fromRelatedFieldName(a.fieldName);
c=b[0];b=b[1];c&&(this._relatedLayersInfo[c]||(h.some(d.relationships,function(a){if(a.id==c)return e=a,!0}),e&&(this._relatedLayersInfo[c]={relation:e,relatedFields:[],outStatistics:[]})),this._relatedLayersInfo[c]&&(this._relatedLayersInfo[c].relatedFields.push(b),a.statisticType&&(g=new l,g.statisticType=a.statisticType,g.onStatisticField=b,g.outStatisticFieldName=b,this._relatedLayersInfo[c].outStatistics.push(g))))},this);for(c in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(c)&&
this._relatedLayersInfo[c]&&(a=this._relatedLayersInfo[c].relation,a=d.url.replace(/[0-9]+$/,a.relatedTableId),this._relatedLayersInfo[c].relatedLayerUrl=a,g[c]=e({url:a,content:{f:"json"},callbackParamName:"callback"}));return r(g)},_queryRelatedLayers:function(a){var b={},d;for(d in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(d)&&(b[d]=this._queryRelatedLayer({graphic:a,relatedInfo:this._relatedLayersInfo[d]}));return r(b)},_queryRelatedLayer:function(a){var b,d,c,e,l,t,z,y,f,
w,G,p,u;b=a.graphic;d=b.getSourceLayer();c=d.url.match(/[0-9]+$/g)[0];G=a.relatedInfo;w=G.relatedLayerInfo;p=G.relatedLayerUrl;a=G.relation;h.some(w.relationships,function(a){if(a.relatedTableId===parseInt(c,10))return e=a,!0},this);e&&(l=new g,h.some(w.fields,function(a){if(a.name===e.keyField)return y=-1!==h.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],a.type)?"number":"string",!0}),e.relationshipTableId&&e.keyFieldInRelationshipTable?
(u=new v,this._queryRelatedRecords(b,e).then(m.hitch(this,function(a){var c;c=a[b.attributes[d.objectIdField]];a=h.map(c.features,function(a){return a.attributes[w.objectIdField]},this);G.outStatistics&&0<G.outStatistics.length&&w.supportsStatistics&&(f=new g,f.objectIds=a,f.outFields=l.outFields,f.outStatistics=G.outStatistics);f&&(t=new k(p),t.execute(f).then(m.hitch(this,function(a){var b=[];b.push(c);b.push(a);u.resolve(b)})))}))):(z="string"===y?e.keyField+"\x3d'"+b.attributes[a.keyField]+"'":
e.keyField+"\x3d"+b.attributes[a.keyField],l.where=z,l.outFields=G.relatedFields,G.outStatistics&&0<G.outStatistics.length&&w.supportsStatistics&&(f=new g,f.where=l.where,f.outFields=l.outFields,f.outStatistics=G.outStatistics),t=new k(p),z=[],z.push(t.execute(l)),f&&z.push(t.execute(f))));return z?r(z):u?u.promise:void 0},_setRelatedRecords:function(a,d){this._relatedInfo=[];for(var c in d)if(d.hasOwnProperty(c)&&d[c]){var e=d[c];this._relatedInfo[c]={};this._relatedInfo[c].relatedFeatures=e[0].features;
b.isDefined(e[1])&&(this._relatedInfo[c].relatedStatsFeatures=e[1].features)}},_handlerErrorResponse:function(a,b){a.reject(b)},_fromRelatedFieldName:function(a){var b=[];-1!==a.indexOf(this._relatedFieldPrefix)&&(a=a.split("/"),b=a.slice(1));return b},_toRelatedFieldName:function(a){var b="";a&&0<a.length&&(b=this._relatedFieldPrefix+a[0]+"/"+a[1]);return b},_queryRelatedRecords:function(b,d){var c=b.getSourceLayer(),e=new a;e.outFields=["*"];e.relationshipId=d.id;e.objectIds=[b.attributes[c.objectIdField]];
return c.queryRelatedFeatures(e)}});f("extend-esri")&&(d.PopupInfo=d.PopupInfoTemplate=n);return n})},"dojox/html/entities":function(){define(["dojo/_base/lang"],function(n){var m=n.getObject("dojox.html.entities",!0),h=function(h,f){var m,u;if(f._encCache&&f._encCache.regexp&&f._encCache.mapper&&f.length==f._encCache.length)m=f._encCache.mapper,u=f._encCache.regexp;else{m={};u=["["];var r;for(r=0;r<f.length;r++)m[f[r][0]]="\x26"+f[r][1]+";",u.push(f[r][0]);u.push("]");u=new RegExp(u.join(""),"g");
f._encCache={mapper:m,regexp:u,length:f.length}}return h=h.replace(u,function(c){return m[c]})},q=function(h,f){var m,u;if(f._decCache&&f._decCache.regexp&&f._decCache.mapper&&f.length==f._decCache.length)m=f._decCache.mapper,u=f._decCache.regexp;else{m={};u=["("];var r;for(r=0;r<f.length;r++){var c="\x26"+f[r][1]+";";r&&u.push("|");m[c]=f[r][0];u.push(c)}u.push(")");u=new RegExp(u.join(""),"g");f._decCache={mapper:m,regexp:u,length:f.length}}return h=h.replace(u,function(b){return m[b]})};m.html=
[["\x26","amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];m.latin=[["\u00a1","iexcl"],["\u00a2","cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7","sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa","ordf"],["\u00ab","laquo"],["\u00ac","not"],["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],["\u00b0","deg"],["\u00b1","plusmn"],["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4","acute"],["\u00b5","micro"],["\u00b6","para"],
["\u00b7","middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],["\u00bc","frac14"],["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0","Agrave"],["\u00c1","Aacute"],["\u00c2","Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5","Aring"],["\u00c6","AElig"],["\u00c7","Ccedil"],["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca","Ecirc"],["\u00cb","Euml"],["\u00cc","Igrave"],["\u00cd","Iacute"],["\u00ce","Icirc"],["\u00cf","Iuml"],["\u00d0","ETH"],["\u00d1",
"Ntilde"],["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],["\u00d6","Ouml"],["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da","Uacute"],["\u00db","Ucirc"],["\u00dc","Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df","szlig"],["\u00e0","agrave"],["\u00e1","aacute"],["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4","auml"],["\u00e5","aring"],["\u00e6","aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],["\u00e9","eacute"],["\u00ea","ecirc"],["\u00eb",
"euml"],["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],["\u00f0","eth"],["\u00f1","ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4","ocirc"],["\u00f5","otilde"],["\u00f6","ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9","ugrave"],["\u00fa","uacute"],["\u00fb","ucirc"],["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe","thorn"],["\u00ff","yuml"],["\u0192","fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393","Gamma"],["\u0394","Delta"],["\u0395","Epsilon"],
["\u0396","Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a","Kappa"],["\u039b","Lambda"],["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f","Omicron"],["\u03a0","Pi"],["\u03a1","Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],["\u03a6","Phi"],["\u03a7","Chi"],["\u03a8","Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2","beta"],["\u03b3","gamma"],["\u03b4","delta"],["\u03b5","epsilon"],["\u03b6","zeta"],["\u03b7","eta"],["\u03b8","theta"],["\u03b9","iota"],
["\u03ba","kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be","xi"],["\u03bf","omicron"],["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3","sigma"],["\u03c4","tau"],["\u03c5","upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],["\u03c9","omega"],["\u03d1","thetasym"],["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],["\u2026","hellip"],["\u2032","prime"],["\u2033","Prime"],["\u203e","oline"],["\u2044","frasl"],["\u2118","weierp"],["\u2111","image"],["\u211c",
"real"],["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191","uarr"],["\u2192","rarr"],["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0","lArr"],["\u21d1","uArr"],["\u21d2","rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],["\u2202","part"],["\u2203","exist"],["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],["\u2209","notin"],["\u220b","ni"],["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],["\u2217","lowast"],["\u221a","radic"],["\u221d","prop"],
["\u221e","infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229","cap"],["\u222a","cup"],["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245","cong"],["\u2248","asymp"],["\u2260","ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282","sub"],["\u2283","sup"],["\u2284","nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295","oplus"],["\u2297","otimes"],["\u22a5","perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309","rceil"],["\u230a","lfloor"],["\u230b","rfloor"],
["\u2329","lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663","clubs"],["\u2665","hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],["\u0160","Scaron"],["\u0161","scaron"],["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002","ensp"],["\u2003","emsp"],["\u2009","thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e","lrm"],["\u200f","rlm"],["\u2013","ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019","rsquo"],["\u201a","sbquo"],["\u201c","ldquo"],
["\u201d","rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030","permil"],["\u2039","lsaquo"],["\u203a","rsaquo"]];m.encode=function(p,f){p&&(f?p=h(p,f):(p=h(p,m.html),p=h(p,m.latin)));return p};m.decode=function(h,f){h&&(f?h=q(h,f):(h=q(h,m.html),h=q(h,m.latin)));return h};return m})},"esri/tasks/QueryTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ../geometry/Extent ../geometry/normalizeUtils ./Task ./FeatureSet".split(" "),
function(n,m,h,q,p,f,v,u,r,c,b,d,e){n=n(d,{declaredClass:"esri.tasks.QueryTask",_eventMap:{complete:["featureSet"],"execute-for-count-complete":["count"],"execute-for-ids-complete":["objectIds"],"execute-relationship-query-complete":["featureSets"]},constructor:function(b,d){this._handler=m.hitch(this,this._handler);this._relationshipQueryHandler=m.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=m.hitch(this,this._executeForIdsHandler);this._countHandler=m.hitch(this,this._countHandler);
this._extentHandler=m.hitch(this,this._extentHandler);this.source=d&&d.source;this.gdbVersion=d&&d.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",c:4,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForIds",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForExtent",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},
onExecuteForExtentComplete:function(){},execute:function(b,d,a,c,e){var g=e.assembly;b=this._encode(m.mixin({},this._url.query,{f:"json"},b.toJson(g&&g[0])));var l=this._handler,k=this._errorHandler;this.source&&(g={source:this.source.toJson()},b.layer=p.toJson(g));this.gdbVersion&&(b.gdbVersion=this.gdbVersion);return u({url:this._url.path+"/query",content:b,callbackParamName:"callback",load:function(b,c){l(b,c,d,a,e.dfd)},error:function(b){k(b,a,e.dfd)},callbackSuffix:c},this.requestOptions)},executeRelationshipQuery:function(b,
d,a){b=this._encode(m.mixin({},this._url.query,{f:"json"},b.toJson()));var c=this._relationshipQueryHandler,e=this._errorHandler;this.gdbVersion&&(b.gdbVersion=this.gdbVersion);var g=new q(r._dfdCanceller);g._pendingDfd=u({url:this._url.path+"/queryRelatedRecords",content:b,callbackParamName:"callback",load:function(b,e){c(b,e,d,a,g)},error:function(b){e(b,a,g)}},this.requestOptions);return g},executeForIds:function(b,d,a,c){var e=c.assembly;b=this._encode(m.mixin({},this._url.query,{f:"json",returnIdsOnly:!0},
b.toJson(e&&e[0])));var g=this._executeForIdsHandler,l=this._errorHandler;this.source&&(e={source:this.source.toJson()},b.layer=p.toJson(e));this.gdbVersion&&(b.gdbVersion=this.gdbVersion);return u({url:this._url.path+"/query",content:b,callbackParamName:"callback",load:function(b,e){g(b,e,d,a,c.dfd)},error:function(b){l(b,a,c.dfd)}},this.requestOptions)},executeForCount:function(b,d,a,c){var e=c.assembly;b=this._encode(m.mixin({},this._url.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},b.toJson(e&&
e[0])));var g=this._countHandler,l=this._errorHandler;this.source&&(e={source:this.source.toJson()},b.layer=p.toJson(e));this.gdbVersion&&(b.gdbVersion=this.gdbVersion);return u({url:this._url.path+"/query",content:b,callbackParamName:"callback",load:function(b,e){g(b,e,d,a,c.dfd)},error:function(b){l(b,a,c.dfd)}},this.requestOptions)},executeForExtent:function(b,d,a,c){var e=c.assembly;b=this._encode(m.mixin({},this._url.query,{f:"json",returnExtentOnly:!0,returnCountOnly:!0},b.toJson(e&&e[0])));
var g=this._extentHandler,l=this._errorHandler;this.source&&(e={source:this.source.toJson()},b.layer=p.toJson(e));this.gdbVersion&&(b.gdbVersion=this.gdbVersion);return u({url:this._url.path+"/query",content:b,callbackParamName:"callback",load:function(b,e){g(b,e,d,a,c.dfd)},error:function(b){l(b,a,c.dfd)}},this.requestOptions)},_handler:function(b,d,a,c,t){try{var g=new e(b);this._successHandler([g],"onComplete",a,t)}catch(y){this._errorHandler(y,c,t)}},_relationshipQueryHandler:function(b,d,a,c,
t){try{var g=b.geometryType,l=b.spatialReference,k={};h.forEach(b.relatedRecordGroups,function(a){var b={};b.geometryType=g;b.spatialReference=l;b.features=a.relatedRecords;b=new e(b);if(null!=a.objectId)k[a.objectId]=b;else for(var d in a)a.hasOwnProperty(d)&&"relatedRecords"!==d&&(k[a[d]]=b)});this._successHandler([k],"onExecuteRelationshipQueryComplete",a,t)}catch(B){this._errorHandler(B,c,t)}},_executeForIdsHandler:function(b,d,a,c,e){try{this._successHandler([b.objectIds],"onExecuteForIdsComplete",
a,e)}catch(z){this._errorHandler(z,c,e)}},_countHandler:function(b,d,a,c,e){try{var g,l=b.features,k=b.objectIds;if(k)g=k.length;else{if(l)throw Error("Unable to perform query. Please check your parameters.");g=b.count}this._successHandler([g],"onExecuteForCountComplete",a,e)}catch(B){this._errorHandler(B,c,e)}},_extentHandler:function(b,d,a,e,t){try{b.extent&&(b.extent=new c(b.extent)),this._successHandler([b],"onExecuteForExtentComplete",a,t)}catch(z){this._errorHandler(z,e,t)}}});b._createWrappers(n);
f("extend-esri")&&m.setObject("tasks.QueryTask",n,v);return n})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),function(n,m,h,q,p,f,v,u){n=n(u,{declaredClass:"esri.tasks._Task",_eventMap:{error:["error"],complete:["result"]},constructor:function(f,c){f&&m.isString(f)&&(this._url=v.urlToObject(this.url=f));c&&c.requestOptions&&(this.requestOptions=c.requestOptions);this.normalization=!0;
this._errorHandler=m.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var f=this._url,c=/^http:/i;this.url&&(this.url=this.url.replace(c,"https:"));f&&f.path&&(f.path=f.path.replace(c,"https:"))},_encode:function(f,c,b){var d,e,g={},k,a;for(k in f)if("declaredClass"!==k&&(d=f[k],e=typeof d,null!==d&&void 0!==d&&"function"!==e))if(m.isArray(d))for(g[k]=[],a=d.length,e=0;e<a;e++)g[k][e]=this._encode(d[e]);else"object"===e?d.toJson&&(e=d.toJson(b&&b[k]),"esri.tasks.FeatureSet"===
d.declaredClass&&e.spatialReference&&(e.sr=e.spatialReference,delete e.spatialReference),g[k]=c?e:h.toJson(e)):g[k]=d;return g},_successHandler:function(h,c,b,d){c&&this[c].apply(this,h);b&&b.apply(null,h);d&&f._resDfd(d,h)},_errorHandler:function(f,c,b){this.onError(f);c&&c(f);b&&b.errback(f)},setNormalization:function(f){this.normalization=f},onError:function(){}});q("extend-esri")&&(p.Task=n);return n})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),
function(n,m,h,q,p,f,v,u,r,c,b){n=n(null,{declaredClass:"esri.tasks.FeatureSet",constructor:function(d){if(d){m.mixin(this,d);var e=this.features,g=d.spatialReference,k=c.getGeometryType(d.geometryType),g=this.spatialReference=new u(g);this.geometryType=d.geometryType;d.fields&&(this.fields=d.fields);h.forEach(e,function(a,d){var c=a.geometry&&a.geometry.spatialReference;e[d]=new v(k&&a.geometry?new k(a.geometry):null,a.symbol&&b.fromJson(a.symbol),a.attributes);e[d].geometry&&!c&&e[d].geometry.setSpatialReference(g)});
this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(b){var d={};this.displayFieldName&&(d.displayFieldName=this.displayFieldName);this.fields&&(d.fields=this.fields);this.spatialReference?d.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(d.spatialReference=this.features[0].geometry.spatialReference.toJson());this.features[0]&&(this.features[0].geometry&&(d.geometryType=
c.getJsonType(this.features[0].geometry)),d.features=r._encodeGraphics(this.features,b));d.exceededTransferLimit=this.exceededTransferLimit;d.transform=this.transform;return f.fixJson(d)},_hydrate:function(){var b=this.transform,c=this.geometryType;if(b&&c)for(var g=this.features,k=b.translate[0],a=b.translate[1],l=b.scale[0],t=b.scale[1],f=function(a,b,d){if("esriGeometryPoint"===a)return function(a){a.x=b(a.x);a.y=d(a.y)};if("esriGeometryPolyline"===a||"esriGeometryPolygon"===a)return function(a){a=
a.rings||a.paths;var c,e,g,l,k,x,t,f;c=0;for(e=a.length;c<e;c++)for(k=a[c],g=0,l=k.length;g<l;g++)x=k[g],0<g?(t+=x[0],f+=x[1]):(t=x[0],f=x[1]),x[0]=b(t),x[1]=d(f)};if("esriGeometryEnvelope"===a)return function(a){a.xmin=b(a.xmin);a.ymin=d(a.ymin);a.xmax=b(a.xmax);a.ymax=d(a.ymax)};if("esriGeometryMultipoint"===a)return function(a){a=a.points;var c,e,g,l,k;c=0;for(e=a.length;c<e;c++)g=a[c],0<c?(l+=g[0],k+=g[1]):(l=g[0],k=g[1]),g[0]=b(l),g[1]=d(k)}}(c,function(a){return a*l+k},function(b){return a-
b*t}),b=0,c=g.length;b<c;b++)g[b].geometry&&f(g[b].geometry);this.transform=null},quantize:function(b){if(!this.geometryType)return this.transform=null,this;var d=b.translate[0],c=b.translate[1],k=b.scale[0],a=b.scale[1],l=this.features,t=function(a,b,d){var c,e,g,l,k,x,t=[];c=0;for(e=a.length;c<e;c++)if(g=a[c],0<c){if(x=b(g[0]),g=d(g[1]),x!==l||g!==k)t.push([x-l,g-k]),l=x,k=g}else l=b(g[0]),k=d(g[1]),t.push([l,k]);return 0<t.length?t:null},f=function(a,b,d){if("esriGeometryPoint"===a)return function(a){a.x=
b(a.x);a.y=d(a.y);return a};if("esriGeometryPolyline"===a||"esriGeometryPolygon"===a)return function(a){var c,e,g,l,k;g=a.rings||a.paths;k=[];c=0;for(e=g.length;c<e;c++)l=g[c],(l=t(l,b,d))&&k.push(l);return 0<k.length?(a.rings?a.rings=k:a.paths=k,a):null};if("esriGeometryMultipoint"===a)return function(a){var c;c=t(a.points,b,d);return 0<c.length?(a.points=c,a):null};if("esriGeometryEnvelope"===a)return function(a){return a}}(this.geometryType,function(a){return Math.round((a-d)/k)},function(b){return Math.round((c-
b)/a)}),h,m;h=0;for(m=l.length;h<m;h++)l[h].geometry&&(f(l[h].geometry)||l[h].setGeometry(null));this.transform=b;return this}});q("extend-esri")&&m.setObject("tasks.FeatureSet",n,p);return n})},"esri/tasks/RelationshipQuery":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","../kernel"],function(n,m,h,q,p){n=n(null,{declaredClass:"esri.tasks.RelationshipQuery",definitionExpression:"",relationshipId:null,returnGeometry:!1,objectIds:null,outSpatialReference:null,
outFields:null,toJson:function(){var f={definitionExpression:this.definitionExpression,relationshipId:this.relationshipId,returnGeometry:this.returnGeometry,maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision},m=this.objectIds,u=this.outFields,r=this.outSpatialReference;m&&(f.objectIds=m.join(","));u&&(f.outFields=u.join(","));r&&(f.outSR=r.wkid||h.toJson(r.toJson()));f._ts=this._ts;return f}});q("extend-esri")&&m.setObject("tasks.RelationshipQuery",n,p);return n})},
"esri/tasks/StatisticDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(n,m,h,q){n=n(null,{declaredClass:"esri.tasks.StatisticDefinition",toJson:function(){return{statisticType:this.statisticType,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount}}});h("extend-esri")&&m.setObject("tasks.StatisticDefinition",
n,q);return n})},"esri/dijit/PopupRenderer":function(){define("require dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/kernel dojo/sniff dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-style dojox/html/entities dijit/_Widget dijit/_Templated ../kernel ../urlUtils ./_EventedWidget dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),function(n,m,h,q,p,f,v,u,r,c,b,d,e,g,k,a,l,t,z,y){var A=0;m=m([z,k,a],{declaredClass:"esri.dijit._PopupRenderer",
constructor:function(){this._nls=q.mixin({},y.widgets.popup)},templateString:"\x3cdiv class\x3d'esriViewPopup'\x3e\x3cdiv class\x3d'mainSection'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_title'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv dojoAttachPoint\x3d'_description'\x3e\x3c/div\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'attachmentsSection hidden'\x3e\x3cdiv\x3e${_nls.NLS_attach}:\x3c/div\x3e\x3cul dojoAttachPoint\x3d'_attachmentsList'\x3e\x3c/ul\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaSection hidden'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_mediaTitle'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv class\x3d'caption' dojoAttachPoint\x3d'_mediaCaption'\x3e\x3c/div\x3e\x3cdiv class\x3d'gallery' dojoAttachPoint\x3d'_gallery'\x3e\x3cdiv class\x3d'mediaHandle prev' dojoAttachPoint\x3d'_prevMedia' dojoAttachEvent\x3d'onclick: _goToPrevMedia'\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaHandle next' dojoAttachPoint\x3d'_nextMedia' dojoAttachEvent\x3d'onclick: _goToNextMedia'\x3e\x3c/div\x3e\x3cul class\x3d'summary'\x3e\x3cli class\x3d'image mediaCount hidden' dojoAttachPoint\x3d'_imageCount'\x3e0\x3c/li\x3e\x3cli class\x3d'image mediaIcon hidden'\x3e\x3c/li\x3e\x3cli class\x3d'chart mediaCount hidden' dojoAttachPoint\x3d'_chartCount'\x3e0\x3c/li\x3e\x3cli class\x3d'chart mediaIcon hidden'\x3e\x3c/li\x3e\x3c/ul\x3e\x3cdiv class\x3d'frame' dojoAttachPoint\x3d'_mediaFrame'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummarySection hidden' dojoAttachPoint\x3d'_editSummarySection'\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3cdiv class\x3d'break hidden' dojoAttachPoint\x3d'_mediaBreak'\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummary' dojoAttachPoint\x3d'_editSummary'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e",
showTitle:!0,startup:function(){this.inherited(arguments);this.template.getComponents(this.graphic).then(q.hitch(this,this._handleComponentsSuccess),q.hitch(this,this._handleComponentsError))},destroy:function(){this._dfd&&this._dfd.cancel();this._destroyFrame();this.template=this.graphic=this._nls=this._mediaInfos=this._mediaPtr=this._dfd=null;this.inherited(arguments)},_goToPrevMedia:function(){0>this._mediaPtr-1||(this._mediaPtr--,this._updateUI(),this._displayMedia())},_goToNextMedia:function(){this._mediaPtr+
1!==this._mediaInfos.length&&(this._mediaPtr++,this._updateUI(),this._displayMedia())},_updateUI:function(){var a=this._mediaInfos,d=a.length,e=this.domNode,g=this._prevMedia,l=this._nextMedia;if(1<d){var k=0,t=0;p.forEach(a,function(a){"image"===a.type?k++:-1!==a.type.indexOf("chart")&&t++});k&&(c.set(this._imageCount,"innerHTML",k),f.query(".summary .image",e).removeClass("hidden"));t&&(c.set(this._chartCount,"innerHTML",t),f.query(".summary .chart",e).removeClass("hidden"))}else f.query(".summary",
e).addClass("hidden"),b.add(g,"hidden"),b.add(l,"hidden");a=this._mediaPtr;0===a?b.add(g,"hidden"):b.remove(g,"hidden");a===d-1?b.add(l,"hidden"):b.remove(l,"hidden");this._destroyFrame()},_displayMedia:function(){var a=this._mediaInfos[this._mediaPtr],d=a.title,e=a.caption,g=f.query(".mediaSection .hzLine",this.domNode)[0];c.set(this._mediaTitle,"innerHTML",d);b[d?"remove":"add"](this._mediaTitle,"hidden");c.set(this._mediaCaption,"innerHTML",e);b[e?"remove":"add"](this._mediaCaption,"hidden");b[d&&
e?"remove":"add"](g,"hidden");this._rid=null;if("image"===a.type)this._showImage(a.value);else{var l=this,d=["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip"],e=a.value.theme||this.chartTheme;q.isString(e)&&(e=e.replace(/\./gi,"/"),-1===e.indexOf("/")&&(e="dojox/charting/themes/"+e));e||(e="./Rainbow");d.push(e);try{var k=this._rid=A++;n(d,function(b,d,c){k===l._rid&&(l._rid=null,l._showChart(a.type,a.value,b,d,c))})}catch(F){console.log("PopupRenderer: error loading modules")}}},_preventNewTab:function(a){return(a=
a&&q.trim(a).toLowerCase())&&(0===a.indexOf("mailto:")||0===a.indexOf("tel:"))},_showImage:function(a){b.add(this._mediaFrame,"image");var c=e.get(this._gallery,"height"),g;a.linkURL&&(g=d.create("a",{href:a.linkURL,target:this._preventNewTab(a.linkURL)?"":"_blank"},this._mediaFrame));d.create("img",{className:"esriPopupMediaImage",src:a.sourceURL},g||this._mediaFrame);var l=f.query(".esriPopupMediaImage",this._mediaFrame)[0],k=this,t;t=h.connect(l,"onload",function(){h.disconnect(t);t=null;k._imageLoaded(l,
c)})},_showChart:function(a,c,e,g,l){b.remove(this._mediaFrame,"image");e=this._chart=new e(d.create("div",{"class":"chart"},this._mediaFrame),{margins:{l:4,t:4,r:4,b:4}});l&&e.setTheme(l);switch(a){case "piechart":e.addPlot("default",{type:"Pie",labels:!1});e.addSeries("Series A",c.fields);break;case "linechart":e.addPlot("default",{type:"Markers"});e.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});e.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});p.forEach(c.fields,
function(a,b){a.x=b+1});e.addSeries("Series A",c.fields);break;case "columnchart":e.addPlot("default",{type:"Columns",gap:3});e.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});e.addSeries("Series A",c.fields);break;case "barchart":e.addPlot("default",{type:"Bars",gap:3}),e.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1}),e.addAxis("y",{vertical:!0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1}),e.addSeries("Series A",c.fields)}this._action=new g(e);e.render()},
_destroyFrame:function(){this._rid=null;this._chart&&(this._chart.destroy(),this._chart=null);this._action&&(this._action.destroy(),this._action=null);c.set(this._mediaFrame,"innerHTML","")},_imageLoaded:function(a,b){var d=a.height;d<b&&e.set(a,"marginTop",Math.round((b-d)/2)+"px")},_attListHandler:function(a,b){if(a===this._dfd){this._dfd=null;var d="";b instanceof Error||!b||!b.length||p.forEach(b,function(a){d+="\x3cli\x3e";d+="\x3ca href\x3d'"+t.addProxy(a.url)+"' target\x3d'_blank'\x3e"+(a.name||
"[No name]")+"\x3c/a\x3e";d+="\x3c/li\x3e"});c.set(this._attachmentsList,"innerHTML",d||"\x3cli\x3e"+this._nls.NLS_noAttach+"\x3c/li\x3e")}},_handleComponentsSuccess:function(a){if(a){var d=this.showTitle?a.title:"",e=a.description,l=a.fields,k=a.mediaInfos,t=this.domNode,h=this._nls,z=this,w=this.template,m=this.graphic;this._prevMedia.title=h.NLS_prevMedia;this._nextMedia.title=h.NLS_nextMedia;c.set(this._title,"innerHTML",d);d||b.add(this._title,"hidden");!a.hasDescription&&l&&(e="",p.forEach(l,
function(a){e+="\x3ctr valign\x3d'top'\x3e";e+="\x3ctd class\x3d'attrName'\x3e"+g.encode(a[0])+"\x3c/td\x3e";e+="\x3ctd class\x3d'attrValue'\x3e"+a[1].replace(/^\s*(https?:\/\/[^\s]+)\s*$/i,"\x3ca target\x3d'_blank' href\x3d'$1' title\x3d'$1'\x3e"+h.NLS_moreInfo+"\x3c/a\x3e")+"\x3c/td\x3e";e+="\x3c/tr\x3e"}),e&&(e="\x3ctable class\x3d'attrTable' cellpadding\x3d'0px' cellspacing\x3d'0px'\x3e"+e+"\x3c/table\x3e"));c.set(this._description,"innerHTML",e);e||b.add(this._description,"hidden");f.query("a",
this._description).forEach(function(a){z._preventNewTab(a.href)?"_blank"===a.target&&c.remove(a,"target"):c.set(a,"target","_blank")});d&&e?f.query(".mainSection .hzLine",t).removeClass("hidden"):d||e?f.query(".mainSection .hzLine",t).addClass("hidden"):f.query(".mainSection",t).addClass("hidden");if(d=this._dfd=w.getAttachments(m))d.addBoth(q.hitch(this,this._attListHandler,d)),c.set(this._attachmentsList,"innerHTML","\x3cli\x3e"+h.NLS_searching+"...\x3c/li\x3e"),f.query(".attachmentsSection",t).removeClass("hidden");
k&&k.length&&(f.query(".mediaSection",t).removeClass("hidden"),r.setSelectable(this._mediaFrame,!1),this._mediaInfos=k,this._mediaPtr=0,this._updateUI(),this._displayMedia());a.editSummary&&(c.set(this._editSummary,"innerHTML",a.editSummary),k&&k.length&&b.remove(this._mediaBreak,"hidden"),b.remove(this._editSummarySection,"hidden"))}},_handleComponentsError:function(a){console.log("PopupRenderer: error loading template",a)}});v("extend-esri")&&q.setObject("dijit._PopupRenderer",m,l);return m})},
"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),function(n,m,h,q,p,f,v,u,r,c,b,d,e){function g(){}function k(a){return function(b,d,c,e){return b&&"string"==typeof d&&b[d]==g?b.on(d.substring(2).toLowerCase(),v.hitch(c,e)):a.apply(h,arguments)}}n.around(h,"connect",k);f.connect&&n.around(f,
"connect",k);n=q("dijit._Widget",[b,d,e],{onClick:g,onDblClick:g,onKeyDown:g,onKeyPress:g,onKeyUp:g,onMouseDown:g,onMouseMove:g,onMouseOut:g,onMouseOver:g,onMouseLeave:g,onMouseEnter:g,onMouseUp:g,constructor:function(a){this._toConnect={};for(var b in a)this[b]===g&&(this._toConnect[b.replace(/^on/,"").toLowerCase()]=a[b],delete a[b])},postCreate:function(){this.inherited(arguments);for(var a in this._toConnect)this.on(a,this._toConnect[a]);delete this._toConnect},on:function(a,b){return this[this._onMap(a)]===
g?h.connect(this.domNode,a.toLowerCase(),this,b):this.inherited(arguments)},_setFocusedAttr:function(a){this._focused=a;this._set("focused",a)},setAttribute:function(a,b){f.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.","","2.0");this.set(a,b)},attr:function(a,b){return 2<=arguments.length||"object"===typeof a?this.set.apply(this,arguments):this.get(a)},getDescendants:function(){f.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.",
"","2.0");return this.containerNode?u("[widgetId]",this.containerNode).map(c.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});p("dijit-legacy-requires")&&r(0,function(){require(["dijit/_base"])});return n})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),
function(n,m,h,q,p,f,v,u,r,c,b,d,e,g,k,a,l,t,z,y,A,B,x){function C(a){return function(b){u[b?"set":"remove"](this.domNode,a,b);this._set(a,b)}}e.add("dijit-legacy-requires",!g.isAsync);e.add("dojo-bidi",!1);e("dijit-legacy-requires")&&l(0,function(){n(["dijit/_base/manager"])});var D={};q=f("dijit._WidgetBase",[t,A],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:C("lang"),dir:"",_setDirAttr:C("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",
baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(a){this._set("ownerDocument",a)},attributeMap:{},_blankGif:q.blankGif||n.toUrl("dojo/resources/blank.gif"),textDir:"",_introspect:function(){var a=this.constructor;if(!a._setterAttrs){var b=a.prototype,d=a._setterAttrs=[],a=a._onMap={},c;for(c in b.attributeMap)d.push(c);for(c in b)/^on/.test(c)&&(a[c.substring(2).toLowerCase()]=c),/^_set[A-Z](.*)Attr$/.test(c)&&(c=c.charAt(4).toLowerCase()+
c.substr(5,c.length-9),b.attributeMap&&c in b.attributeMap||d.push(c))}},postscript:function(a,b){this.create(a,b)},create:function(a,b){this._introspect();this.srcNodeRef=v.byId(b);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&this.srcNodeRef.id&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);a&&(this.params=a,k.mixin(this,a));this.postMixInProperties();this.id||(this.id=x.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=
this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=y.body(this.ownerDocument);x.add(this);this.buildRendering();var d;if(this.domNode){this._applyAttributes();var c=this.srcNodeRef;c&&c.parentNode&&this.domNode!==c&&(c.parentNode.replaceChild(this.domNode,c),d=!0);this.domNode.setAttribute("widgetId",this.id)}this.postCreate();d&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var a={},b;for(b in this.params||{})a[b]=this._get(b);
m.forEach(this.constructor._setterAttrs,function(b){if(!(b in a)){var d=this._get(b);d&&this.set(b,d)}},this);for(b in a)this.set(b,a[b])},postMixInProperties:function(){},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var a=this.baseClass.split(" ");this.isLeftToRight()||(a=a.concat(m.map(a,function(a){return a+"Rtl"})));r.add(this.domNode,a)}},postCreate:function(){},startup:function(){this._started||(this._started=
!0,m.forEach(this.getChildren(),function(a){a._started||a._destroyed||!k.isFunction(a.startup)||(a.startup(),a._started=!0)}))},destroyRecursive:function(a){this._beingDestroyed=!0;this.destroyDescendants(a);this.destroy(a)},destroy:function(a){function b(b){b.destroyRecursive?b.destroyRecursive(a):b.destroy&&b.destroy(a)}this._beingDestroyed=!0;this.uninitialize();m.forEach(this._connects,k.hitch(this,"disconnect"));m.forEach(this._supportingWidgets,b);this.domNode&&m.forEach(x.findWidgets(this.domNode,
this.containerNode),b);this.destroyRendering(a);x.remove(this.id);this._destroyed=!0},destroyRendering:function(a){this.bgIframe&&(this.bgIframe.destroy(a),delete this.bgIframe);this.domNode&&(a?u.remove(this.domNode,"widgetId"):c.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(a||c.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(a){m.forEach(this.getChildren(),function(b){b.destroyRecursive&&b.destroyRecursive(a)})},uninitialize:function(){return!1},_setStyleAttr:function(a){var b=
this.domNode;k.isObject(a)?d.set(b,a):b.style.cssText=b.style.cssText?b.style.cssText+("; "+a):a;this._set("style",a)},_attrToDom:function(a,b,d){d=3<=arguments.length?d:this.attributeMap[a];m.forEach(k.isArray(d)?d:[d],function(d){var c=this[d.node||d||"domNode"];switch(d.type||"attribute"){case "attribute":k.isFunction(b)&&(b=k.hitch(this,b));d=d.attribute?d.attribute:/^on[A-Z][a-zA-Z]*$/.test(a)?a.toLowerCase():a;c.tagName?u.set(c,d,b):c.set(d,b);break;case "innerText":c.innerHTML="";c.appendChild(this.ownerDocument.createTextNode(b));
break;case "innerHTML":c.innerHTML=b;break;case "class":r.replace(c,b,this[a]);break;case "toggleClass":r.toggle(c,d.className||a,b)}},this)},get:function(a){var b=this._getAttrNames(a);return this[b.g]?this[b.g]():this._get(a)},set:function(a,b){if("object"===typeof a){for(var d in a)this.set(d,a[d]);return this}d=this._getAttrNames(a);var c=this[d.s];if(k.isFunction(c))var e=c.apply(this,Array.prototype.slice.call(arguments,1));else{var c=this.focusNode&&!k.isFunction(this.focusNode)?"focusNode":
"domNode",g=this[c]&&this[c].tagName,l;if((l=g)&&!(l=D[g])){l=this[c];var t={},f;for(f in l)t[f.toLowerCase()]=!0;l=D[g]=t}f=l;d=a in this.attributeMap?this.attributeMap[a]:d.s in this?this[d.s]:f&&d.l in f&&"function"!=typeof b||/^aria-|^data-|^role$/.test(a)?c:null;null!=d&&this._attrToDom(a,b,d);this._set(a,b)}return e||this},_attrPairNames:{},_getAttrNames:function(a){var b=this._attrPairNames;if(b[a])return b[a];var d=a.replace(/^[a-z]|-[a-zA-Z]/g,function(a){return a.charAt(a.length-1).toUpperCase()});
return b[a]={n:a+"Node",s:"_set"+d+"Attr",g:"_get"+d+"Attr",l:d.toLowerCase()}},_set:function(a,b){var d=this[a];this[a]=b;!this._created||d===b||d!==d&&b!==b||(this._watchCallbacks&&this._watchCallbacks(a,d,b),this.emit("attrmodified-"+a,{detail:{prevValue:d,newValue:b}}))},_get:function(a){return this[a]},emit:function(b,d,c){d=d||{};void 0===d.bubbles&&(d.bubbles=!0);void 0===d.cancelable&&(d.cancelable=!0);d.detail||(d.detail={});d.detail.widget=this;var e,g=this["on"+b];g&&(e=g.apply(this,c?
c:[d]));this._started&&!this._beingDestroyed&&a.emit(this.domNode,b.toLowerCase(),d);return e},on:function(b,d){var c=this._onMap(b);return c?h.after(this,c,d,!0):this.own(a(this.domNode,b,d))[0]},_onMap:function(a){var b=this.constructor,d=b._onMap;if(!d){var d=b._onMap={},c;for(c in b.prototype)/^on/.test(c)&&(d[c.replace(/^on/,"").toLowerCase()]=c)}return d["string"==typeof a&&a.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?
x.findWidgets(this.containerNode):[]},getParent:function(){return x.getEnclosingWidget(this.domNode.parentNode)},connect:function(a,b,d){return this.own(p.connect(a,b,this,d))[0]},disconnect:function(a){a.remove()},subscribe:function(a,b){return this.own(z.subscribe(a,k.hitch(this,b)))[0]},unsubscribe:function(a){a.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():b.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=d.get(this.domNode,"display")},
placeAt:function(a,b){var d=!a.tagName&&x.byId(a);!d||!d.addChild||b&&"number"!==typeof b?(d=d&&"domNode"in d?d.containerNode&&!/after|before|replace/.test(b||"")?d.containerNode:d.domNode:v.byId(a,this.ownerDocument),c.place(this.domNode,d,b),!this._started&&(this.getParent()||{})._started&&this.startup()):d.addChild(this,b);return this},defer:function(a,b){var d=setTimeout(k.hitch(this,function(){d&&(d=null,this._destroyed||k.hitch(this,a)())}),b||0);return{remove:function(){d&&(clearTimeout(d),
d=null);return null}}}});e("dojo-bidi")&&q.extend(B);return q})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(n,m,h){return h("dijit.Destroyable",null,{destroy:function(h){this._destroyed=!0},own:function(){var h=["destroyRecursive","destroy","remove"];n.forEach(arguments,function(p){function f(){u.remove();n.forEach(r,function(c){c.remove()})}var q,u=m.before(this,"destroy",function(c){p[q](c)}),r=[];p.then?(q="cancel",p.then(f,f)):n.forEach(h,
function(c){"function"===typeof p[c]&&(q||(q=c),r.push(m.after(p,c,f,!0)))})},this);return arguments}})})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(n,m,h,q,p,f){n=q("dijit._OnDijitClickMixin",null,{connect:function(h,m,r){return this.inherited(arguments,[h,"ondijitclick"==m?f:m,r])}});n.a11yclick=f;return n})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],
function(n,m,h,q){q.extend(m,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return h("dijit._FocusMixin",null,{_focusManager:n})})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(n,m,h,q){h(function(){m("highcontrast")&&n.add(q.body(),"dijit_a11y")});return m})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),
function(n,m,h,q,p,f,v){p.add("highcontrast",function(){var f=v.doc.createElement("div");try{f.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(m.blankGif||n.toUrl("./resources/blank.gif"))+'");';v.body().appendChild(f);var h=q.getComputedStyle(f),c=h.backgroundImage;return h.borderTopColor==h.borderRightColor||c&&("none"==c||"url(invalid-url:)"==c)}catch(b){return console.warn("hccss: exception detecting high-contrast mode, document is likely hidden: "+
b.toString()),!1}finally{8>=p("ie")?f.outerHTML="":v.body().removeChild(f)}});f(function(){p("highcontrast")&&h.add(v.body(),"dj_a11y")});return p})},"dijit/_Templated":function(){define("./_WidgetBase ./_TemplatedMixin ./_WidgetsInTemplateMixin dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/kernel".split(" "),function(n,m,h,q,p,f,v){f.extend(n,{waiRole:"",waiState:""});return p("dijit._Templated",[m,h],{constructor:function(){v.deprecated(this.declaredClass+": dijit._Templated deprecated, use dijit._TemplatedMixin and if necessary dijit._WidgetsInTemplateMixin",
"","2.0")},_processNode:function(f,h){var c=this.inherited(arguments),b=h(f,"waiRole");b&&f.setAttribute("role",b);(b=h(f,"waiState"))&&q.forEach(b.split(/\s*,\s*/),function(b){-1!=b.indexOf("-")&&(b=b.split("-"),f.setAttribute("aria-"+b[0],b[1]))});return c}})})},"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),function(n,m,h,q,p,f,v,u){var r=m("dijit._TemplatedMixin",u,{templateString:null,
templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(c){var b=this.declaredClass,d=this;return v.substitute(c,this,function(c,g){"!"==g.charAt(0)&&(c=q.getObject(g.substr(1),!1,d));if("undefined"==typeof c)throw Error(b+" template:"+g);return null==c?"":"!"==g.charAt(0)?c:this._escapeValue(""+c)},this)},_escapeValue:function(c){return c.replace(/["'<>&]/g,function(b){return{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;"}[b]})},buildRendering:function(){if(!this._rendered){this.templateString||
(this.templateString=n(this.templatePath,{sanitize:!0}));var c=r.getCachedTemplate(this.templateString,this._skipNodeCache,this.ownerDocument),b;if(q.isString(c)){if(b=h.toDom(this._stringRepl(c),this.ownerDocument),1!=b.nodeType)throw Error("Invalid template: "+c);}else b=c.cloneNode(!0);this.domNode=b}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(c){var b=this.containerNode;if(c&&b)for(;c.hasChildNodes();)b.appendChild(c.firstChild)}});
r._templateCache={};r.getCachedTemplate=function(c,b,d){var e=r._templateCache,g=c,k=e[g];if(k){try{if(!k.ownerDocument||k.ownerDocument==(d||document))return k}catch(a){}h.destroy(k)}c=v.trim(c);if(b||c.match(/\$\{([^\}]+)\}/g))return e[g]=c;b=h.toDom(c,d);if(1!=b.nodeType)throw Error("Invalid template: "+c);return e[g]=b};f("ie")&&p(window,"unload",function(){var c=r._templateCache,b;for(b in c){var d=c[b];"object"==typeof d&&h.destroy(d);delete c[b]}});return r})},"dojo/cache":function(){define(["./_base/kernel",
"./text"],function(n){return n.cache})},"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),function(n,m,h,q,p,f,v,u,r){var c=p.delegate(u,{mouseenter:f.enter,mouseleave:f.leave,keypress:h._keypress}),b;h=q("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);
this._beforeFillContent()},_beforeFillContent:function(){},_attachTemplateNodes:function(b){for(var d=b;;)if(1==d.nodeType&&(this._processTemplateNode(d,function(b,d){return b.getAttribute(d)},this._attach)||this.searchContainerNode)&&d.firstChild)d=d.firstChild;else{if(d==b)break;for(;!d.nextSibling;)if(d=d.parentNode,d==b)return;d=d.nextSibling}},_processTemplateNode:function(b,c,g){var d=!0,a=this.attachScope||this,e=c(b,"dojoAttachPoint")||c(b,"data-dojo-attach-point");if(e)for(var t=e.split(/\s*,\s*/);e=
t.shift();)p.isArray(a[e])?a[e].push(b):a[e]=b,d="containerNode"!=e,this._attachPoints.push(e);if(c=c(b,"dojoAttachEvent")||c(b,"data-dojo-attach-event"))for(e=c.split(/\s*,\s*/),t=p.trim;c=e.shift();)if(c){var f=null;-1!=c.indexOf(":")?(f=c.split(":"),c=t(f[0]),f=t(f[1])):c=t(c);f||(f=c);this._attachEvents.push(g(b,c,p.hitch(a,f)))}return d},_attach:function(d,e,g){e=e.replace(/^on/,"").toLowerCase();e="dijitclick"==e?b||(b=n("./a11yclick")):c[e]||e;return v(d,e,g)},_detachTemplateNodes:function(){var b=
this.attachScope||this;m.forEach(this._attachPoints,function(d){delete b[d]});this._attachPoints=[];m.forEach(this._attachEvents,function(b){b.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();this.inherited(arguments)}});p.extend(r,{dojoAttachEvent:"",dojoAttachPoint:""});return h})},"dijit/_WidgetsInTemplateMixin":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/parser"],function(n,m,h,q,p){return h("dijit._WidgetsInTemplateMixin",
null,{_earlyTemplatedStartup:!1,contextRequire:null,_beforeFillContent:function(){if(/dojoType|data-dojo-type/i.test(this.domNode.innerHTML)){var f=this.domNode;this.containerNode&&!this.searchContainerNode&&(this.containerNode.stopParser=!0);p.parse(f,{noStart:!this._earlyTemplatedStartup,template:!0,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,contextRequire:this.contextRequire,scope:"dojo"}).then(q.hitch(this,function(f){this._startupWidgets=f;for(var h=0;h<f.length;h++)this._processTemplateNode(f[h],
function(f,c){return f[c]},function(f,c,b){return c in f?f.connect(f,c,b):f.on(c,b,!0)});this.containerNode&&this.containerNode.stopParser&&delete this.containerNode.stopParser}));if(!this._startupWidgets)throw Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.");}},_processTemplateNode:function(f,h,m){return h(f,"dojoType")||h(f,"data-dojo-type")?
!0:this.inherited(arguments)},startup:function(){n.forEach(this._startupWidgets,function(f){f&&!f._started&&f.startup&&f.startup()});this._startupWidgets=null;this.inherited(arguments)}})})},"dojo/parser":function(){define("require ./_base/kernel ./_base/lang ./_base/array ./_base/config ./dom ./_base/window ./_base/url ./aspect ./promise/all ./date/stamp ./Deferred ./has ./query ./on ./ready".split(" "),function(n,m,h,q,p,f,v,u,r,c,b,d,e,g,k,a){function l(a){return eval("("+a+")")}function t(a){var b=
a._nameCaseMap,d=a.prototype;if(!b||b._extendCnt<y){var b=a._nameCaseMap={},c;for(c in d)"_"!==c.charAt(0)&&(b[c.toLowerCase()]=c);b._extendCnt=y}return b}function z(a,b){b||(b=n);var d=b._dojoParserCtorMap||(b._dojoParserCtorMap={}),c=a.join();if(!d[c]){for(var e=[],g=0,l=a.length;g<l;g++){var k=a[g];e[e.length]=d[k]=d[k]||h.getObject(k)||~k.indexOf("/")&&b(k)}g=e.shift();d[c]=e.length?g.createSubclass?g.createSubclass(e):g.extend.apply(g,e):g}return d[c]}new Date("X");var y=0;r.after(h,"extend",
function(){y++},!0);var A={_clearCache:function(){y++;_ctorMap={}},_functionFromScript:function(a,b){var d="",c="",e=a.getAttribute(b+"args")||a.getAttribute("args"),g=a.getAttribute("with"),e=(e||"").split(/\s*,\s*/);g&&g.length&&q.forEach(g.split(/\s*,\s*/),function(a){d+="with("+a+"){";c+="}"});return new Function(e,d+a.innerHTML+c)},instantiate:function(a,b,d){b=b||{};d=d||{};var c=(d.scope||m._scopeName)+"Type",e="data-"+(d.scope||m._scopeName)+"-",g=e+"type",l=e+"mixins",k=[];q.forEach(a,function(a){var d=
c in b?b[c]:a.getAttribute(g)||a.getAttribute(c);if(d){var e=a.getAttribute(l),d=e?[d].concat(e.split(/\s*,\s*/)):[d];k.push({node:a,types:d})}});return this._instantiate(k,b,d)},_instantiate:function(a,b,d,e){function g(a){b._started||d.noStart||q.forEach(a,function(a){"function"!==typeof a.startup||a._started||a.startup()});return a}a=q.map(a,function(a){var c=a.ctor||z(a.types,d.contextRequire);if(!c)throw Error("Unable to resolve constructor for: '"+a.types.join()+"'");return this.construct(c,
a.node,b,d,a.scripts,a.inherited)},this);return e?c(a).then(g):g(a)},construct:function(a,d,c,f,z,y){function x(a){D&&h.setObject(D,a);for(C=0;C<L.length;C++)r[L[C].advice||"after"](a,L[C].method,h.hitch(a,L[C].func),!0);for(C=0;C<R.length;C++)R[C].call(a);for(C=0;C<U.length;C++)a.watch(U[C].prop,U[C].func);for(C=0;C<T.length;C++)k(a,T[C].event,T[C].func);return a}var A=a&&a.prototype;f=f||{};var w={};f.defaults&&h.mixin(w,f.defaults);y&&h.mixin(w,y);var p;e("dom-attributes-explicit")?p=d.attributes:
e("dom-attributes-specified-flag")?p=q.filter(d.attributes,function(a){return a.specified}):(y=(/^input$|^img$/i.test(d.nodeName)?d:d.cloneNode(!1)).outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,""),p=q.map(y.split(/\s+/),function(a){var b=a.toLowerCase();return{name:a,value:"LI"==d.nodeName&&"value"==a||"enctype"==b?d.getAttribute(b):d.getAttributeNode(b).value}}));var B=f.scope||m._scopeName;y="data-"+B+"-";var n={};"dojo"!==B&&(n[y+"props"]=
"data-dojo-props",n[y+"type"]="data-dojo-type",n[y+"mixins"]="data-dojo-mixins",n[B+"type"]="dojotype",n[y+"id"]="data-dojo-id");for(var C=0,v,B=[],D,H;v=p[C++];){var E=v.name,I=E.toLowerCase();v=v.value;switch(n[I]||I){case "data-dojo-type":case "dojotype":case "data-dojo-mixins":break;case "data-dojo-props":H=v;break;case "data-dojo-id":case "jsid":D=v;break;case "data-dojo-attach-point":case "dojoattachpoint":w.dojoAttachPoint=v;break;case "data-dojo-attach-event":case "dojoattachevent":w.dojoAttachEvent=
v;break;case "class":w["class"]=d.className;break;case "style":w.style=d.style&&d.style.cssText;break;default:if(E in A||(E=t(a)[I]||E),E in A)switch(typeof A[E]){case "string":w[E]=v;break;case "number":w[E]=v.length?Number(v):NaN;break;case "boolean":w[E]="false"!=v.toLowerCase();break;case "function":""===v||-1!=v.search(/[^\w\.]+/i)?w[E]=new Function(v):w[E]=h.getObject(v,!1)||new Function(v);B.push(E);break;default:I=A[E],w[E]=I&&"length"in I?v?v.split(/\s*,\s*/):[]:I instanceof Date?""==v?new Date(""):
"now"==v?new Date:b.fromISOString(v):I instanceof u?m.baseUrl+v:l(v)}else w[E]=v}}for(p=0;p<B.length;p++)n=B[p].toLowerCase(),d.removeAttribute(n),d[n]=null;if(H)try{H=l.call(f.propsThis,"{"+H+"}"),h.mixin(w,H)}catch(Y){throw Error(Y.toString()+" in data-dojo-props\x3d'"+H+"'");}h.mixin(w,c);z||(z=a&&(a._noScript||A._noScript)?[]:g("\x3e script[type^\x3d'dojo/']",d));var L=[],R=[],U=[],T=[];if(z)for(C=0;C<z.length;C++)n=z[C],d.removeChild(n),c=n.getAttribute(y+"event")||n.getAttribute("event"),f=
n.getAttribute(y+"prop"),H=n.getAttribute(y+"method"),B=n.getAttribute(y+"advice"),p=n.getAttribute("type"),n=this._functionFromScript(n,y),c?"dojo/connect"==p?L.push({method:c,func:n}):"dojo/on"==p?T.push({event:c,func:n}):w[c]=n:"dojo/aspect"==p?L.push({method:H,advice:B,func:n}):"dojo/watch"==p?U.push({prop:f,func:n}):R.push(n);a=(z=a.markupFactory||A.markupFactory)?z(w,d,a):new a(w,d);return a.then?a.then(x):x(a)},scan:function(a,b){function c(a){if(!a.inherited){a.inherited={};var b=a.node,d=
c(a.parent),b={dir:b.getAttribute("dir")||d.dir,lang:b.getAttribute("lang")||d.lang,textDir:b.getAttribute(y)||d.textDir},e;for(e in b)b[e]&&(a.inherited[e]=b[e])}return a.inherited}var g=[],l=[],k={},f=(b.scope||m._scopeName)+"Type",t="data-"+(b.scope||m._scopeName)+"-",h=t+"type",y=t+"textdir",t=t+"mixins",x=a.firstChild,p=b.inherited;if(!p){var A=function(a,b){return a.getAttribute&&a.getAttribute(b)||a.parentNode&&A(a.parentNode,b)},p={dir:A(a,"dir"),lang:A(a,"lang"),textDir:A(a,y)},r;for(r in p)p[r]||
delete p[r]}for(var p={inherited:p},u,B;;)if(x)if(1!=x.nodeType)x=x.nextSibling;else if(u&&"script"==x.nodeName.toLowerCase())(v=x.getAttribute("type"))&&/^dojo\/\w/i.test(v)&&u.push(x),x=x.nextSibling;else if(B)x=x.nextSibling;else{var v=x.getAttribute(h)||x.getAttribute(f);r=x.firstChild;if(v||r&&(3!=r.nodeType||r.nextSibling)){B=null;if(v){var I=x.getAttribute(t);u=I?[v].concat(I.split(/\s*,\s*/)):[v];try{B=z(u,b.contextRequire)}catch(R){}B||q.forEach(u,function(a){~a.indexOf("/")&&!k[a]&&(k[a]=
!0,l[l.length]=a)});I=B&&!B.prototype._noScript?[]:null;p={types:u,ctor:B,parent:p,node:x,scripts:I};p.inherited=c(p);g.push(p)}else p={node:x,scripts:u,parent:p};u=I;B=x.stopParser||B&&B.prototype.stopParser&&!b.template;x=r}else x=x.nextSibling}else{if(!p||!p.node)break;x=p.node.nextSibling;B=!1;p=p.parent;u=p.scripts}var L=new d;l.length?(e("dojo-debug-messages")&&console.warn("WARNING: Modules being Auto-Required: "+l.join(", ")),(b.contextRequire||n)(l,function(){L.resolve(q.filter(g,function(a){if(!a.ctor)try{a.ctor=
z(a.types,b.contextRequire)}catch(Y){}for(var d=a.parent;d&&!d.types;)d=d.parent;var c=a.ctor&&a.ctor.prototype;a.instantiateChildren=!(c&&c.stopParser&&!b.template);a.instantiate=!d||d.instantiate&&d.instantiateChildren;return a.instantiate}))})):L.resolve(g);return L.promise},_require:function(a,b){var c=l("{"+a.innerHTML+"}"),e=[],g=[],k=new d,f=b&&b.contextRequire||n,t;for(t in c)e.push(t),g.push(c[t]);f(g,function(){for(var a=0;a<e.length;a++)h.setObject(e[a],arguments[a]);k.resolve(arguments)});
return k.promise},_scanAmd:function(a,b){var c=new d,e=c.promise;c.resolve(!0);var l=this;g("script[type\x3d'dojo/require']",a).forEach(function(a){e=e.then(function(){return l._require(a,b)});a.parentNode.removeChild(a)});return e},parse:function(a,b){!a||"string"==typeof a||"nodeType"in a||(b=a,a=b.rootNode);var d=a?f.byId(a):v.body();b=b||{};var c=b.template?{template:!0}:{},e=[],g=this,l=this._scanAmd(d,b).then(function(){return g.scan(d,b)}).then(function(a){return g._instantiate(a,c,b,!0)}).then(function(a){return e=
e.concat(a)}).otherwise(function(a){console.error("dojo/parser::parse() error",a);throw a;});h.mixin(e,l);return e}};m.parser=A;p.parseOnLoad&&a(100,A,"parse");return A})},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],function(n,m){var h={};n.setObject("dojo.date.stamp",h);h.fromISOString=function(q,p){h._isoRegExp||(h._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/);var f=h._isoRegExp.exec(q),n=null;
if(f){f.shift();f[1]&&f[1]--;f[6]&&(f[6]*=1E3);p&&(p=new Date(p),m.forEach(m.map("FullYear Month Date Hours Minutes Seconds Milliseconds".split(" "),function(c){return p["get"+c]()}),function(c,b){f[b]=f[b]||c}));n=new Date(f[0]||1970,f[1]||0,f[2]||1,f[3]||0,f[4]||0,f[5]||0,f[6]||0);100>f[0]&&n.setFullYear(f[0]||1970);var u=0,r=f[7]&&f[7].charAt(0);"Z"!=r&&(u=60*(f[8]||0)+(Number(f[9])||0),"-"!=r&&(u*=-1));r&&(u-=n.getTimezoneOffset());u&&n.setTime(n.getTime()+6E4*u)}return n};h.toISOString=function(h,
m){var f=function(b){return 10>b?"0"+b:b};m=m||{};var p=[],u=m.zulu?"getUTC":"get",r="";"time"!=m.selector&&(r=h[u+"FullYear"](),r=["0000".substr((r+"").length)+r,f(h[u+"Month"]()+1),f(h[u+"Date"]())].join("-"));p.push(r);if("date"!=m.selector){r=[f(h[u+"Hours"]()),f(h[u+"Minutes"]()),f(h[u+"Seconds"]())].join(":");u=h[u+"Milliseconds"]();m.milliseconds&&(r+="."+(100>u?"0":"")+f(u));if(m.zulu)r+="Z";else if("time"!=m.selector)var u=h.getTimezoneOffset(),c=Math.abs(u),r=r+((0<u?"-":"+")+f(Math.floor(c/
60))+":"+f(c%60));p.push(r)}return p.join("T")};return h})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on ../Evented dijit/_WidgetBase".split(" "),function(n,m,h,q,p,f){return n([f,p],{_onMap:function(f){var h=this.constructor._onMap,m;h&&h.FINAL||(delete this.constructor._onMap,h=this.registerConnectEvents(),h.FINAL=!0);f=f.toLowerCase();h[f]?m=this[h[f].method]:(f=this._onCamelCase(f),this[f]&&(m=f));return m},on:function(f,h){var m=this._onMap(f),
c=f.replace(/\-/g,""),b="on"+c in this.domNode;return m||!b?this.inherited(arguments):this.own(q(this.domNode,c,h))[0]},emit:function(f,h,p){var c,b,d,e=f.toLowerCase(),g=this.constructor._onMap||this.registerConnectEvents();b=this[this._onMap(e)];h=h||{};h.target||(h.target=this);b&&g&&g[e]&&(this._onObj2Arr(function(){c=Array.prototype.slice.call(arguments)},g[e].argKeys)(h),d=m.mixin({},arguments),d[2]=c,d[0]=g[e].name.replace(/^on/,""));return this.inherited(d||arguments)}})})},"esri/tasks/GeometryService":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/has ../kernel ../request ../deferredUtils ./Task ../geometry/Extent ../geometry/Polyline ../geometry/Polygon ../geometry/Multipoint ../geometry/jsonUtils".split(" "),
function(n,m,h,q,p,f,v,u,r,c,b,d,e,g,k){n=n(c,{declaredClass:"esri.tasks.GeometryService",_eventMap:{"areas-and-lengths-complete":["result"],"auto-complete-complete":["geometries"],"buffer-complete":["geometries"],"convex-hull-complete":["geometry"],"cut-complete":["result"],"densify-complete":["geometries"],"difference-complete":["geometries"],"distance-complete":["distance"],"generalize-complete":["geometries"],"intersect-complete":["geometries"],"label-points-complete":["geometries"],"lengths-complete":["result"],
"offset-complete":["geometries"],"project-complete":["geometries"],"relation-complete":["relations"],"reshape-complete":["geometry"],"simplify-complete":["geometries"],"trim-extend-complete":["geometries"],"union-complete":["geometry"]},constructor:function(a){a=m.hitch;this._projectHandler=a(this,this._projectHandler);this._simplifyHandler=a(this,this._simplifyHandler);this._bufferHandler=a(this,this._bufferHandler);this._areasAndLengthsHandler=a(this,this._areasAndLengthsHandler);this._lengthsHandler=
a(this,this._lengthsHandler);this._labelPointsHandler=a(this,this._labelPointsHandler);this._relationHandler=a(this,this._relationHandler);this._convexHullHandler=a(this,this._convexHullHandler);this._unionHandler=a(this,this._unionHandler);this._autoCompleteHandler=a(this,this._autoCompleteHandler);this._reshapeHandler=a(this,this._reshapeHandler);this._cutHandler=a(this,this._cutHandler);this._intersectHandler=a(this,this._intersectHandler);this._differenceHandler=a(this,this._differenceHandler);
this._trimExtendHandler=a(this,this._trimExtendHandler);this._densifyHandler=a(this,this._densifyHandler);this._generalizeHandler=a(this,this._densifyHandler);this._offsetHandler=a(this,this._offsetHandler);this._distanceHandler=a(this,this._distanceHandler);this._toGeoCoordinateHandler=a(this,this._toGeoCoordinateHandler);this._fromGeoCoordinateHandler=a(this,this._fromGeoCoordinateHandler);this.registerConnectEvents()},_encodeGeometries:function(a){var b=[],d,c=a.length;for(d=0;d<c;d++)b.push(a[d].toJson());
return{geometryType:k.getJsonType(a[0]),geometries:b}},_decodeGeometries:function(a,b,d){var c=k.getGeometryType(b);a=a.geometries;var e=[],g={spatialReference:d.toJson()},l=m.mixin;h.forEach(a,function(a,b){e[b]=new c(l(a,g))});return e},_toProjectGeometry:function(a){var c=a.spatialReference.toJson();return a instanceof b?new e({rings:[[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]],spatialReference:c}):new d({paths:[[].concat(a.points)],spatialReference:c})},
_fromProjectedGeometry:function(a,d,c){return"esriGeometryEnvelope"===d?(a=a.rings[0],new b(a[0][0],a[0][1],a[2][0],a[2][1],c)):new g({points:a.paths[0],spatialReference:c.toJson()})},project:function(a,b,d,c){var e=m.mixin({},this._url.query,{f:"json"}),g;a.geometries?(c=d,d=b,b=a.outSR,g=a.geometries[0],e=m.mixin(e,a.toJson())):(g=a[0],e=m.mixin(e,{outSR:b.wkid||q.toJson(b.toJson()),inSR:g.spatialReference.wkid||q.toJson(g.spatialReference.toJson()),geometries:q.toJson(this._encodeGeometries(a))}));
var l=k.getJsonType(g),f=this._projectHandler,t=this._errorHandler,h=new p(r._dfdCanceller);h._pendingDfd=u({url:this._url.path+"/project",content:e,callbackParamName:"callback",load:function(a,e){f(a,e,l,b,d,c,h)},error:function(a){t(a,c,h)}});return h},_projectHandler:function(a,b,d,c,e,g,k){try{var l=this._decodeGeometries(a,d,c);this._successHandler([l],"onProjectComplete",e,k)}catch(C){this._errorHandler(C,g,k)}},onProjectComplete:function(){},simplify:function(a,b,d){var c=a[0].spatialReference,
e=m.mixin({},this._url.query,{f:"json",sr:c.wkid?c.wkid:q.toJson(c.toJson()),geometries:q.toJson(this._encodeGeometries(a))}),g=k.getJsonType(a[0]),l=this._simplifyHandler,f=this._errorHandler,h=new p(r._dfdCanceller);h._pendingDfd=u({url:this._url.path+"/simplify",content:e,callbackParamName:"callback",load:function(a,e){l(a,e,g,c,b,d,h)},error:function(a){f(a,d,h)}});return h},_simplifyHandler:function(a,b,d,c,e,g,k){try{var l=this._decodeGeometries(a,d,c);this._successHandler([l],"onSimplifyComplete",
e,k)}catch(C){this._errorHandler(C,g,k)}},onSimplifyComplete:function(){},convexHull:function(a,b,d){var c=a[0].spatialReference;a=m.mixin({},this._url.query,{f:"json",sr:q.toJson(c.toJson()),geometries:q.toJson(this._encodeGeometries(a))});var e=this._convexHullHandler,g=this._errorHandler,l=new p(r._dfdCanceller);l._pendingDfd=u({url:this._url.path+"/convexHull",content:a,callbackParamName:"callback",load:function(a,g){e(a,g,c,b,d,l)},error:function(a){g(a,d,l)}});return l},_convexHullHandler:function(a,
b,d,c,e,g){try{var l=k.fromJson(a.geometry).setSpatialReference(d);this._successHandler([l],"onConvexHullComplete",c,g)}catch(x){this._errorHandler(x,e,g)}},onConvexHullComplete:function(){},union:function(a,b,d){var c=a[0].spatialReference;a=m.mixin({},this._url.query,{f:"json",sr:q.toJson(c.toJson()),geometries:q.toJson(this._encodeGeometries(a))});var e=this._unionHandler,g=this._errorHandler,l=new p(r._dfdCanceller);l._pendingDfd=u({url:this._url.path+"/union",content:a,callbackParamName:"callback",
load:function(a,g){e(a,g,c,b,d,l)},error:function(a){g(a,d,l)}});return l},_unionHandler:function(a,b,d,c,e,g){try{var l=k.fromJson(a.geometry).setSpatialReference(d);this._successHandler([l],"onUnionComplete",c,g)}catch(x){this._errorHandler(x,e,g)}},onUnionComplete:function(){},autoComplete:function(a,b,d,c){var e=a[0].spatialReference;a=m.mixin({},this._url.query,{f:"json",sr:q.toJson(e.toJson()),polygons:q.toJson(this._encodeGeometries(a).geometries),polylines:q.toJson(this._encodeGeometries(b).geometries)});
var g=this._autoCompleteHandler,l=this._errorHandler,k=new p(r._dfdCanceller);k._pendingDfd=u({url:this._url.path+"/autoComplete",content:a,callbackParamName:"callback",load:function(a,b){g(a,b,e,d,c,k)},error:function(a){l(a,c,k)}});return k},_autoCompleteHandler:function(a,b,d,c,g,k){try{var l=a.geometries;a=[];var f,h=l.length;for(f=0;f<h;f++)a[f]=new e({spatialReference:d,rings:l[f].rings});this._successHandler([a],"onAutoCompleteComplete",c,k)}catch(D){this._errorHandler(D,g,k)}},onAutoCompleteComplete:function(){},
reshape:function(a,b,d,c){var e=a.spatialReference;a=m.mixin({},this._url.query,{f:"json",sr:q.toJson(e.toJson()),target:q.toJson({geometryType:k.getJsonType(a),geometry:a.toJson()}),reshaper:q.toJson(b.toJson())});var g=this._reshapeHandler,l=this._errorHandler,f=new p(r._dfdCanceller);f._pendingDfd=u({url:this._url.path+"/reshape",content:a,callbackParamName:"callback",load:function(a,b){g(a,b,e,d,c,f)},error:function(a){l(a,c,f)}});return f},_reshapeHandler:function(a,b,d,c,e,g){try{var l=k.fromJson(a.geometry).setSpatialReference(d);
this._successHandler([l],"onReshapeComplete",c,g)}catch(x){this._errorHandler(x,e,g)}},onReshapeComplete:function(){},cut:function(a,b,d,c){var e=a[0].spatialReference,g=h.map(a,function(a){return a.toJson()});a=m.mixin({},this._url.query,{f:"json",sr:q.toJson(e.toJson()),target:q.toJson({geometryType:k.getJsonType(a[0]),geometries:g}),cutter:q.toJson(b.toJson())});var l=this._cutHandler,f=this._errorHandler,t=new p(r._dfdCanceller);t._pendingDfd=u({url:this._url.path+"/cut",content:a,callbackParamName:"callback",
load:function(a,b){l(a,b,e,d,c,t)},error:function(a){f(a,c,t)}});return t},_cutHandler:function(a,b,d,c,e,g){try{var l=a.geometries,f={};f.cutIndexes=a.cutIndexes;f.geometries=[];h.forEach(l,function(a){f.geometries.push(k.fromJson(a).setSpatialReference(d))});this._successHandler([f],"onCutComplete",c,g)}catch(C){this._errorHandler(C,e,g)}},onCutComplete:function(){},intersect:function(a,b,d,c){var e=a[0].spatialReference;a=m.mixin({},this._url.query,{f:"json",sr:q.toJson(e.toJson()),geometries:q.toJson(this._encodeGeometries(a)),
geometry:q.toJson({geometryType:k.getJsonType(b),geometry:b.toJson()})});var g=this._intersectHandler,l=this._errorHandler,f=new p(r._dfdCanceller);f._pendingDfd=u({url:this._url.path+"/intersect",content:a,callbackParamName:"callback",load:function(a,b){g(a,b,e,d,c,f)},error:function(a){l(a,c,f)}});return f},_intersectHandler:function(a,b,d,c,e,g){try{var l=[];h.forEach(a.geometries,function(a){l.push(k.fromJson(a).setSpatialReference(d))});this._successHandler([l],"onIntersectComplete",c,g)}catch(x){this._errorHandler(x,
e,g)}},onIntersectComplete:function(){},difference:function(a,b,d,c){var e=a[0].spatialReference;a=m.mixin({},this._url.query,{f:"json",sr:q.toJson(e.toJson()),geometries:q.toJson(this._encodeGeometries(a)),geometry:q.toJson({geometryType:k.getJsonType(b),geometry:b.toJson()})});var g=this._differenceHandler,l=this._errorHandler,f=new p(r._dfdCanceller);f._pendingDfd=u({url:this._url.path+"/difference",content:a,callbackParamName:"callback",load:function(a,b){g(a,b,e,d,c,f)},error:function(a){l(a,
c,f)}});return f},_differenceHandler:function(a,b,d,c,e,g){try{var l=[];h.forEach(a.geometries,function(a){l.push(k.fromJson(a).setSpatialReference(d))});this._successHandler([l],"onDifferenceComplete",c,g)}catch(x){this._errorHandler(x,e,g)}},onDifferenceComplete:function(){},buffer:function(a,b,d){var c=m.mixin({},this._url.query,{f:"json"},a.toJson()),e=a.outSpatialReference||a.geometries[0].spatialReference,g=this._bufferHandler,l=this._errorHandler,k=new p(r._dfdCanceller);k._pendingDfd=u({url:this._url.path+
"/buffer",content:c,callbackParamName:"callback",load:function(a,c){g(a,c,e,b,d,k)},error:function(a){l(a,d,k)}});return k},_bufferHandler:function(a,b,d,c,g,k){try{var l=a.geometries;a=[];var f,h=l.length;for(f=0;f<h;f++)a[f]=new e({spatialReference:d,rings:l[f].rings});this._successHandler([a],"onBufferComplete",c,k)}catch(D){this._errorHandler(D,g,k)}},onBufferComplete:function(){},areasAndLengths:function(a,b,d){a=m.mixin({},this._url.query,{f:"json"},a.toJson());var c=this._areasAndLengthsHandler,
e=this._errorHandler,g=new p(r._dfdCanceller);g._pendingDfd=u({url:this._url.path+"/areasAndLengths",content:a,callbackParamName:"callback",load:function(a,e){c(a,e,b,d,g)},error:function(a){e(a,d,g)}});return g},_areasAndLengthsHandler:function(a,b,d,c,e){try{this._successHandler([a],"onAreasAndLengthsComplete",d,e)}catch(A){this._errorHandler(A,c,e)}},onAreasAndLengthsComplete:function(){},lengths:function(a,b,d){a=m.mixin({},this._url.query,{f:"json"},a.toJson());var c=this._lengthsHandler,e=this._errorHandler,
g=new p(r._dfdCanceller);g._pendingDfd=u({url:this._url.path+"/lengths",content:a,callbackParamName:"callback",load:function(a,e){c(a,e,b,d,g)},error:function(a){e(a,d,g)}});return g},_lengthsHandler:function(a,b,d,c,e){try{this._successHandler([a],"onLengthsComplete",d,e)}catch(A){this._errorHandler(A,c,e)}},onLengthsComplete:function(){},labelPoints:function(a,b,d){var c=h.map(a,function(a){return a.toJson()}),e=a[0].spatialReference,c=m.mixin({},this._url.query,{f:"json",sr:e.wkid?e.wkid:q.toJson(e.toJson()),
polygons:q.toJson(c)}),g=this._labelPointsHandler,l=this._errorHandler,k=new p(r._dfdCanceller);k._pendingDfd=u({url:this._url.path+"/labelPoints",content:c,callbackParamName:"callback",load:function(c,l){g(c,l,a,e,b,d,k)},error:function(a){l(a,d,k)}});return k},_labelPointsHandler:function(a,b,d,c,e,g,f){try{var l=[];h.forEach(a.labelPoints,function(a){l.push(k.fromJson(a).setSpatialReference(c))});this._successHandler([l],"onLabelPointsComplete",e,f)}catch(C){this._errorHandler(C,g,f)}},onLabelPointsComplete:function(){},
relation:function(a,b,d){a=m.mixin({},this._url.query,{f:"json"},a.toJson());var c=this._relationHandler,e=this._errorHandler,g=new p(r._dfdCanceller);g._pendingDfd=u({url:this._url.path+"/relation",content:a,callbackParamName:"callback",load:function(a,e){c(a,e,b,d,g)},error:function(a){e(a,d,g)}});return g},_relationHandler:function(a,b,d,c,e){try{this._successHandler([a.relations],"onRelationComplete",d,e)}catch(A){this._errorHandler(A,c,e)}},onRelationComplete:function(){},trimExtend:function(a,
b,d){var c=m.mixin({},this._url.query,{f:"json"},a.toJson()),e=a.sr,g=this._trimExtendHandler,l=this._errorHandler,k=new p(r._dfdCanceller);k._pendingDfd=u({url:this._url.path+"/trimExtend",content:c,callbackParamName:"callback",load:function(a,c){g(a,c,e,b,d,k)},error:function(a){l(a,d,k)}});return k},_trimExtendHandler:function(a,b,c,e,g,k){try{var l=a.geometries;a=[];var f,h=l.length;for(f=0;f<h;f++)a[f]=new d({spatialReference:c,paths:l[f].paths});this._successHandler([a],"onTrimExtendComplete",
e,k)}catch(D){this._errorHandler(D,g,k)}},onTrimExtendComplete:function(){},densify:function(a,b,d){var c=m.mixin({},this._url.query,{f:"json"},a.toJson()),e=a.geometries[0].spatialReference,g=this._densifyHandler,l=this._errorHandler,k=new p(r._dfdCanceller);k._pendingDfd=u({url:this._url.path+"/densify",content:c,callbackParamName:"callback",load:function(a,c){g(a,c,e,b,d,k)},error:function(a){l(a,d,k)}});return k},_densifyHandler:function(a,b,d,c,e,g){try{var l=[];h.forEach(a.geometries,function(a){l.push(k.fromJson(a).setSpatialReference(d))});
this._successHandler([l],"onDensifyComplete",c,g)}catch(x){this._errorHandler(x,e,g)}},onDensifyComplete:function(){},generalize:function(a,b,d){var c=m.mixin({},this._url.query,{f:"json"},a.toJson()),e=a.geometries[0].spatialReference,g=this._generalizeHandler,l=this._errorHandler,k=new p(r._dfdCanceller);k._pendingDfd=u({url:this._url.path+"/generalize",content:c,callbackParamName:"callback",load:function(a,c){g(a,c,e,b,d,k)},error:function(a){l(a,d,k)}});return k},_generalizeHandler:function(a,
b,d,c,e,g){try{var l=[];h.forEach(a.geometries,function(a){l.push(k.fromJson(a).setSpatialReference(d))});this._successHandler([l],"onGeneralizeComplete",c,g)}catch(x){this._errorHandler(x,e,g)}},onGeneralizeComplete:function(){},offset:function(a,b,d){var c=m.mixin({},this._url.query,{f:"json"},a.toJson()),e=a.geometries[0].spatialReference,g=this._offsetHandler,k=this._errorHandler,l=new p(r._dfdCanceller);l._pendingDfd=u({url:this._url.path+"/offset",content:c,callbackParamName:"callback",load:function(a,
c){g(a,c,e,b,d,l)},error:function(a){k(a,d,l)}});return l},_offsetHandler:function(a,b,d,c,e,g){try{var l=[];h.forEach(a.geometries,function(a){l.push(k.fromJson(a).setSpatialReference(d))});this._successHandler([l],"onOffsetComplete",c,g)}catch(x){this._errorHandler(x,e,g)}},onOffsetComplete:function(){},distance:function(a,b,d){var c=m.mixin({},this._url.query,{f:"json"},a.toJson()),e=a.geometry1.spatialReference,g=this._distanceHandler,l=this._errorHandler,k=new p(r._dfdCanceller);k._pendingDfd=
u({url:this._url.path+"/distance",content:c,callbackParamName:"callback",load:function(a,c){g(a,c,e,b,d,k)},error:function(a){l(a,d,k)}});return k},_distanceHandler:function(a,b,d,c,e,g){try{a=a&&a.distance,this._successHandler([a],"onDistanceComplete",c,g)}catch(B){this._errorHandler(B,e,g)}},onDistanceComplete:function(){},toGeoCoordinateString:function(a,b,d){var c={};m.isObject(a.sr)?c.sr=a.sr.wkid||q.toJson(a.sr.toJson()):c.sr=a.sr;c.coordinates=q.toJson(a.coordinates);c.conversionType=a.conversionType||
"MGRS";c.conversionMode=a.conversionMode;c.numOfDigits=a.numOfDigits;c.rounding=a.rounding;c.addSpaces=a.addSpaces;a=m.mixin({},this._url.query,{f:"json"},c);var e=this._toGeoCoordinateHandler,g=this._errorHandler,k=new p(r._dfdCanceller);k._pendingDfd=u({url:this._url.path+"/toGeoCoordinateString",content:a,callbackParamName:"callback",load:function(a,c){e(a,c,b,d,k)},error:function(a){g(a,d,k)}});return k},_toGeoCoordinateHandler:function(a,b,d,c,e){try{this._successHandler([a.strings],"onToGeoCoordinateStringComplete",
d,e)}catch(A){this._errorHandler(A,c,e)}},onToGeoCoordinateStringComplete:function(){},fromGeoCoordinateString:function(a,b,d){var c={};m.isObject(a.sr)?c.sr=a.sr.wkid||q.toJson(a.sr.toJson()):c.sr=a.sr;c.strings=q.toJson(a.strings);c.conversionType=a.conversionType||"MGRS";c.conversionMode=a.conversionMode;a=m.mixin({},this._url.query,{f:"json"},c);var e=this._fromGeoCoordinateHandler,g=this._errorHandler,k=new p(r._dfdCanceller);k._pendingDfd=u({url:this._url.path+"/fromGeoCoordinateString",content:a,
callbackParamName:"callback",load:function(a,c){e(a,c,b,d,k)},error:function(a){g(a,d,k)}});return k},_fromGeoCoordinateHandler:function(a,b,d,c,e){try{this._successHandler([a.coordinates],"onToGeoCoordinateStringComplete",d,e)}catch(A){this._errorHandler(A,c,e)}},onFromGeoCoordinateStringComplete:function(){}});m.mixin(n,{UNIT_METER:9001,UNIT_GERMAN_METER:9031,UNIT_FOOT:9002,UNIT_SURVEY_FOOT:9003,UNIT_CLARKE_FOOT:9005,UNIT_FATHOM:9014,UNIT_NAUTICAL_MILE:9030,UNIT_SURVEY_CHAIN:9033,UNIT_SURVEY_LINK:9034,
UNIT_SURVEY_MILE:9035,UNIT_KILOMETER:9036,UNIT_CLARKE_YARD:9037,UNIT_CLARKE_CHAIN:9038,UNIT_CLARKE_LINK:9039,UNIT_SEARS_YARD:9040,UNIT_SEARS_FOOT:9041,UNIT_SEARS_CHAIN:9042,UNIT_SEARS_LINK:9043,UNIT_BENOIT_1895A_YARD:9050,UNIT_BENOIT_1895A_FOOT:9051,UNIT_BENOIT_1895A_CHAIN:9052,UNIT_BENOIT_1895A_LINK:9053,UNIT_BENOIT_1895B_YARD:9060,UNIT_BENOIT_1895B_FOOT:9061,UNIT_BENOIT_1895B_CHAIN:9062,UNIT_BENOIT_1895B_LINK:9063,UNIT_INDIAN_FOOT:9080,UNIT_INDIAN_1937_FOOT:9081,UNIT_INDIAN_1962_FOOT:9082,UNIT_INDIAN_1975_FOOT:9083,
UNIT_INDIAN_YARD:9084,UNIT_INDIAN_1937_YARD:9085,UNIT_INDIAN_1962_YARD:9086,UNIT_INDIAN_1975_YARD:9087,UNIT_FOOT_1865:9070,UNIT_RADIAN:9101,UNIT_DEGREE:9102,UNIT_ARCMINUTE:9103,UNIT_ARCSECOND:9104,UNIT_GRAD:9105,UNIT_GON:9106,UNIT_MICRORADIAN:9109,UNIT_ARCMINUTE_CENTESIMAL:9112,UNIT_ARCSECOND_CENTESIMAL:9113,UNIT_MIL6400:9114,UNIT_BRITISH_1936_FOOT:9095,UNIT_GOLDCOAST_FOOT:9094,UNIT_INTERNATIONAL_CHAIN:109003,UNIT_INTERNATIONAL_LINK:109004,UNIT_INTERNATIONAL_YARD:109001,UNIT_STATUTE_MILE:9093,UNIT_SURVEY_YARD:109002,
UNIT_50KILOMETER_LENGTH:109030,UNIT_150KILOMETER_LENGTH:109031,UNIT_DECIMETER:109005,UNIT_CENTIMETER:109006,UNIT_MILLIMETER:109007,UNIT_INTERNATIONAL_INCH:109008,UNIT_US_SURVEY_INCH:109009,UNIT_INTERNATIONAL_ROD:109010,UNIT_US_SURVEY_ROD:109011,UNIT_US_NAUTICAL_MILE:109012,UNIT_UK_NAUTICAL_MILE:109013,UNIT_SQUARE_INCHES:"esriSquareInches",UNIT_SQUARE_FEET:"esriSquareFeet",UNIT_SQUARE_YARDS:"esriSquareYards",UNIT_ACRES:"esriAcres",UNIT_SQUARE_MILES:"esriSquareMiles",UNIT_SQUARE_MILLIMETERS:"esriSquareMillimeters",
UNIT_SQUARE_CENTIMETERS:"esriSquareCentimeters",UNIT_SQUARE_DECIMETERS:"esriSquareDecimeters",UNIT_SQUARE_METERS:"esriSquareMeters",UNIT_ARES:"esriAres",UNIT_HECTARES:"esriHectares",UNIT_SQUARE_KILOMETERS:"esriSquareKilometers"});f("extend-esri")&&m.setObject("tasks.GeometryService",n,v);return n})},"esri/layers/FeatureLayer":function(){define("require module dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/date/locale dojo/sniff dojo/io-query dojo/dom-construct dojo/i18n dojo/when dojo/promise/all ../kernel ../lang ../request ../config ../deferredUtils ../SpatialReference ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../symbols/jsonUtils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/jsonUtils ../renderers/arcadeUtils ../tasks/QueryTask ../tasks/query ../tasks/FeatureSet ../tasks/StatisticDefinition ../geometry/Extent ../geometry/jsonUtils ../geometry/normalizeUtils ../geometry/scaleUtils ./GraphicsLayer ./Field ./TimeInfo ./FeatureType ./FeatureTemplate ./FeatureEditResult ./LabelClass ./SnapshotMode ./OnDemandMode ./SelectionMode ./StreamMode ./TrackManager ./HeatmapManager ./clustering/ClusterManager dojo/i18n!../nls/jsapi dojo/has!extend-esri?./agscommon".split(" "),
function(n,m,h,q,p,f,v,u,r,c,b,d,e,g,k,a,l,t,z,y,A,B,x,C,D,H,E,F,K,w,G,O,da,Z,ja,aa,sa,ta,I,L,R,U,T,Y,S,ea,fa,ka,la,ba,ga,ma){var ha=z.defaults,M=h(ta,{declaredClass:"esri.layers.FeatureLayer",invalidParams:"query contains one or more unsupported parameters",reHostedFS:/(https?:)?\/\/services.*\.arcgis\.com/i,maxPointCountForAuto:4E3,maxRecordCountForAuto:2E3,maxVertexCountForAuto:25E4,generalizeForScale:4E3,_eventMap:{"add-attachment-complete":["result"],"before-apply-edits":["adds","updates","deletes"],
"delete-attachments-complete":["results"],"edits-complete":["adds","updates","deletes"],"query-attachment-infos-complete":["results"],"query-count-complete":["count"],"query-features-complete":["featureSet"],"query-ids-complete":["objectIds"],"query-related-features-complete":["featureSets"],"selection-complete":["features","method"],"update-end":["error","info"]},constructor:function(a,b){this._preventInit||this._initFeatureLayer(a,b)},_initFeatureLayer:function(a,b){this.i18n=ma;b=b||{};this._aggregationInfo=
b.aggregationInfo;this.showLabels=null!=b.showLabels?b.showLabels:!0;this._outFields=b.outFields;this._defnExpr=b.definitionExpression;this._loadCallback=b.loadCallback;var d=b._usePatch;this._usePatch=null===d||void 0===d?!0:d;this._trackIdField=b.trackIdField;this.objectIdField=b.objectIdField;this._maxOffset=null!=b.maxAllowableOffset?b.maxAllowableOffset:this.maxAllowableOffset;this.quantize=null!=b.quantize?b.quantize:!0;this._optEditable=b.editable;this._optAutoGen=b.autoGeneralize;this.editSummaryCallback=
b.editSummaryCallback;this.userId=b.userId;this.userIsAdmin=b.userIsAdmin;this.useMapTime=b.hasOwnProperty("useMapTime")?!!b.useMapTime:!0;this.source=b.source;this.gdbVersion=b.gdbVersion;this.orderByFields=b.orderByFields;this.maxPointCountForAuto=null!=b.maxPointCountForAuto?b.maxPointCountForAuto:this.maxPointCountForAuto;this.maxRecordCountForAuto=null!=b.maxRecordCountForAuto?b.maxRecordCountForAuto:this.maxRecordCountForAuto;this.maxVertexCountForAuto=null!=b.maxVertexCountForAuto?b.maxVertexCountForAuto:
this.maxVertexCountForAuto;this.generalizeForScale=null!=b.generalizeForScale?b.generalizeForScale:this.generalizeForScale;this.queryPagination=null!=b.queryPagination?b.queryPagination:this.url?this.reHostedFS.test(this.url):!1;this.multipatchOption=b.multipatchOption;this._selectedFeatures={};this._selectedFeaturesArr=[];this._newFeatures=[];this._deletedFeatures={};this._ulid=this._getUniqueId();var c=M,d=this.mode=l.isDefined(b.mode)?b.mode:c.MODE_ONDEMAND;this._isStream&&(this.mode=d=c.MODE_STREAM);
switch(d){case c.MODE_SNAPSHOT:this.currentMode=c.MODE_SNAPSHOT;this._mode=new S(this);this._isSnapshot=!0;break;case c.MODE_ONDEMAND:case c.MODE_AUTO:this.currentMode=c.MODE_ONDEMAND;this._tileWidth=b.tileWidth||512;this._tileHeight=b.tileHeight||512;this._mode=new ea(this);this.latticeTiling=b.latticeTiling;break;case c.MODE_SELECTION:this.currentMode=c.MODE_SELECTION;this._mode=new fa(this);this._isSelOnly=!0;break;case c.MODE_STREAM:this.currentMode=c.MODE_STREAM,this._mode=new ka(this),this._isStream=
!0}this._initLayer=p.hitch(this,this._initLayer);this._selectHandler=p.hitch(this,this._selectHandler);this._editable=!1;if(p.isObject(a)&&a.layerDefinition)return this._collection=!0,this.mode=this._isStream?c.MODE_STREAM:c.MODE_SNAPSHOT,this._isStream||this._outFields||(this._outFields=["*"]),this._initLayer(a),this;this._task=new w(this.url,{source:this.source,gdbVersion:this.gdbVersion});d=this._url.path;this._fserver=!1;-1!==d.search(/\/FeatureServer\//i)&&(this._fserver=!0);this.mode===c.MODE_AUTO&&
this.reHostedFS.test(this.url)&&this._queryLimit();(c=b.resourceInfo)?this._initLayer(c):(this.source&&(c={source:this.source.toJson()},this._url.query=p.mixin(this._url.query,{layer:v.toJson(c)})),this.gdbVersion&&(this._url.query=p.mixin(this._url.query,{gdbVersion:this.gdbVersion})),t({url:d,content:p.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler}));this.registerConnectEvents()},_initLayer:function(a,b){if(a||b){this._json=a;this._findCredential();
if(this.credential&&this.credential.ssl||a&&a._ssl)this._useSSL(),this._task._useSSL();this.version=a.currentVersion;this.version||(this.version="capabilities"in a||"drawingInfo"in a||"hasAttachments"in a||"htmlPopupType"in a||"relationships"in a||"timeInfo"in a||"typeIdField"in a||"types"in a?10:9.3);this._collection&&(this._isStream||(this.currentMode=M.MODE_SNAPSHOT,this._mode=new S(this)),this._isSnapshot=!0,this._featureSet=a.featureSet,this._nextId=a.nextObjectId,a=a.layerDefinition);this.geometryType=
a.geometryType;"string"!==typeof this.multipatchOption&&"esriGeometryMultiPatch"===this.geometryType&&(this.multipatchOption="xyFootprint");if(a.hasOwnProperty("capabilities")){var d=this.capabilities=a.capabilities;d&&-1!==d.toLowerCase().indexOf("editing")?this._editable=!0:this._editable=!1}else this._collection||(this._editable=this._fserver);l.isDefined(this._optEditable)?(this._editable=this._optEditable,delete this._optEditable):"esriGeometryMultiPatch"===this.geometryType&&(this._editable=
!1);this._json=v.toJson(this._json);this.isEditable()?this._setMaxOffset(null):this.mode===M.MODE_SNAPSHOT||"esriGeometryPolyline"!==this.geometryType&&"esriGeometryPolygon"!==this.geometryType&&!this.hasXYFootprint()||(this._autoGeneralize=l.isDefined(this._optAutoGen)?this._optAutoGen:this.mode===M.MODE_ONDEMAND||this.mode===M.MODE_AUTO,delete this._optAutoGen);var d=a.effectiveMinScale||a.minScale,e=a.effectiveMaxScale||a.maxScale;!this._hasMin&&d&&this.setMinScale(d);!this._hasMax&&e&&this.setMaxScale(e);
this.layerId=a.id;this.name=a.name;this.description=a.description;this.copyright=a.copyrightText;this.type=a.type;this.displayField=a.displayField;this.defaultDefinitionExpression=a.definitionExpression||(a.isView?a.viewDefinitionQuery:a.definitionQuery);this.fullExtent=new Z(a.extent);this.initialExtent=new Z(this.fullExtent.toJson());this.fullExtent.spatialReference&&(this.spatialReference=new A(this.fullExtent.spatialReference.toJson()));this.defaultVisibility=a.defaultVisibility;if("esriGeometryPoint"===
this.geometryType||"esriGeometryMultipoint"===this.geometryType)this.latticeTiling=!1;this.hasM=a.hasM||!1;this.hasZ=a.hasZ||!1;this.indexedFields=a.indexedFields;this.maxRecordCount=a.maxRecordCount;this.canModifyLayer=a.canModifyLayer;this.supportsStatistics=a.supportsStatistics;this.supportsAdvancedQueries=this._collection?!1:a.supportsAdvancedQueries;this.supportsCalculate=a.supportsCalculate;this.supportsAttachmentsByUploadId=a.supportsAttachmentsByUploadId;this.supportsCoordinatesQuantization=
a.supportsCoordinatesQuantization;this.quantize=this.quantize&&this.supportsCoordinatesQuantization;this.hasLabels=a.hasLabels;this.canScaleSymbols=a.canScaleSymbols;this.supportsRollbackOnFailureParameter=this.supportsRollbackOnFailure=a.supportsRollbackOnFailure;this.syncCanReturnChanges=a.syncCanReturnChanges;this.isDataVersioned=a.isDataVersioned;this.editFieldsInfo=a.editFieldsInfo;this.ownershipBasedAccessControlForFeatures=a.ownershipBasedAccessControlForFeatures;this.editFieldsInfo&&this.ownershipBasedAccessControlForFeatures&&
(this.creatorField=this.editFieldsInfo.creatorField);this.relationships=a.relationships;this.allowGeometryUpdates=l.isDefined(a.allowGeometryUpdates)?a.allowGeometryUpdates:!0;this.allowUpdateWithoutMValues=!!a.allowUpdateWithoutMValues;this.advancedQueryCapabilities=a.advancedQueryCapabilities||{supportsStatistics:this.supportsStatistics,supportsOrderBy:this.supportsAdvancedQueries,supportsDistinct:this.supportsAdvancedQueries};this.useStandardizedQueries=a.useStandardizedQueries;this.tileMaxRecordCount=
a.tileMaxRecordCount;this.standardMaxRecordCount=a.standardMaxRecordCount;this._setMaxOffset(this._maxOffset,!0);this._isTable="Table"===this.type;for(var g=this.fields=[],e=a.fields,d=0;d<e.length;d++)g.push(new I(e[d]));if(!this.objectIdField){this.objectIdField=a.objectIdField;if(!this.objectIdField)for(e=a.fields,d=0;d<e.length;d++)if(g=e[d],"esriFieldTypeOID"===g.type){this.objectIdField=g.name;break}this.objectIdField||this._isStream||console.debug("esri.layers.FeatureLayer: "+l.substitute({url:this.url},
"objectIdField is not set [url: ${url}]"))}if(!l.isDefined(this._nextId)){e=this.objectIdField;g=-1;if(this._collection&&e)for(var N=(d=this._featureSet)&&d.features,k=N?N.length:0,P,d=0;d<k;d++)P=(P=N[d].attributes)&&P[e],P>g&&(g=P);this._nextId=g+1}this.globalIdField=a.globalIdField;if(d=this.typeIdField=a.typeIdField)if(d=!this._getField(d)&&this._getField(d,!0))this.typeIdField=d.name;this.visibilityField=a.visibilityField;if(e=a.defaultSymbol)this.defaultSymbol=D.fromJson(e);var h=this.types=
[],m=a.types,t,w,g=(d=this.editFieldsInfo)&&d.creatorField,N=d&&d.editorField;P=g||N;k=[];if(m)for(d=0;d<m.length;d++)t=new R(m[d]),w=t.templates,P&&w&&w.length&&(k=k.concat(w)),h.push(t);m=a.templates;t=this.templates=[];if(m)for(d=0;d<m.length;d++)h=new U(m[d]),P&&k.push(h),t.push(h);for(d=0;d<k.length;d++)if(P=p.getObject("prototype.attributes",!1,k[d]))g&&delete P[g],N&&delete P[N];if(d=a.timeInfo)this.timeInfo=new L(d),this._startTimeField=d.startTimeField,this._endTimeField=d.endTimeField,this._startTimeField&&
this._endTimeField&&(this._twoTimeFields=!0),this._trackIdField?d.trackIdField=this._trackIdField:this._trackIdField=d.trackIdField;this.hasAttachments=!this._collection&&a.hasAttachments?!0:!1;this.htmlPopupType=a.htmlPopupType;var d=a.drawingInfo,r;(g=d&&d.labelingInfo)&&!this.labelingInfo&&(this.labelingInfo=f.map(g,function(a){return new Y(a)}),this._fixLabelExpr());if(!this.renderer)if(d&&d.renderer){if(r=d.renderer,this.setRenderer(F.fromJson(r)),"classBreaks"===r.type&&this.renderer.setMaxInclusive(!0),
!this._collection){var n=r.type,e=[];r=this.renderer;switch(n){case "simple":e.push(r.symbol);break;case "uniqueValue":case "classBreaks":e.push(r.defaultSymbol),e=e.concat(f.map(r.infos,function(a){return a.symbol}))}var e=f.filter(e,l.isDefined),u=this._url.path+"/images/",q=this._getToken();f.forEach(e,function(a){var b=a.url;b&&(-1===b.search(/https?\:/)&&-1===b.indexOf("data:")&&(a.url=u+b),q&&-1!==a.url.search(/https?\:/)&&(a.url+="?token\x3d"+q))})}}else if(e)m=this.types,0<m.length?(r=new E(this.defaultSymbol,
this.typeIdField),f.forEach(m,function(a){r.addValue(a.id,a.symbol)})):r=new H(this.defaultSymbol),this.setRenderer(r);else if(!this._isTable){switch(this.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":n=new B;break;case "esriGeometryPolyline":n=new x;break;case "esriGeometryPolygon":n=new C;break;default:this.hasXYFootprint()&&(n=new C)}this.setRenderer(n?new H(n):null)}n=d&&d.transparency||0;!this.hasOwnProperty("opacity")&&0<n&&(this.opacity=1-n/100);(c("ie")||7<=c("trident")||
c("safari"))&&this.isEditable()&&10.02>this.version&&(this._ts=!0);this.statistics=a.statistics;this._fixRendererFields();this._updateRequiredFieldsFromLabelingInfo();this._checkFields();this._updateCaps();var G=function(){this.currentMode!==M.MODE_SNAPSHOT&&(this.queryPagination=!1);null==this._maxOffset||this._isFractionalOffsetAllowed()||this._setMaxOffset(this._maxOffset);this.loaded=!0;this.onLoad(this);var a=this._loadCallback;a&&(delete this._loadCallback,a(this))};this._collection?(n=this._featureSet,
this._featureSet=null,this._mode._drawFeatures(new O(n)),this._fcAdded=!0,G.call(this)):this._forceIdentity(this._limitPromise?function(){var a=this;this._limitPromise.then(function(b){a._checkMode(b)});this._limitPromise.always(function(){a._limitPromise=null;G.call(a)})}:G)}},setShowLabels:function(a){this.showLabels=a;this.onShowLabelsChange()},onShowLabelsChange:function(){},onRendererChange:function(a){this.inherited(arguments);var b=this._map;this._ager=!!(a&&a.observationAger&&a.observationRenderer);
a&&"colors"in a&&"blurRadius"in a&&"maxPixelIntensity"in a?"esriGeometryPoint"==this.geometryType&&!this._heatmapManager&&b&&(this._heatmapManager=new ba(this),this._heatmapManager.initialize(b)):this.renderer&&this.renderer.getRendererInfo?f.some(this.renderer.rendererInfos,function(a){return a.renderer&&"colors"in a.renderer&&"blurRadius"in a.renderer})||(this._heatmapManager=null):this._heatmapManager=null;this.timeInfo&&b&&(a&&(a.latestObservationRenderer||a.trackRenderer)?this._trackManager||
(this._trackManager=new la(this),this._trackManager.initialize(b),this._childLayer=this._trackManager.container,this._mode._applyTimeFilter()):this._trackManager&&!this._isStream&&(this._trackManager.destroy(),this._trackManager=null));if(a){var d=[],b=f.filter([a,a.observationRenderer,a.latestObservationRenderer,a.trackRenderer],l.isDefined),c=function(a){return null!=a&&"function"!=typeof a&&a};f.forEach(b,function(a){var b=c(a.attributeField),e=c(a.attributeField2);a=c(a.attributeField3);!1!==
b&&d.push(b);!1!==e&&d.push(e);!1!==a&&d.push(a)});this._requiredFields=d}else this._requiredFields=[];this.loaded&&(this._fixRendererFields(),this._checkFields(this._requiredFields),this._collection&&(this._typesDirty=!0))},getAggregationInfo:function(){return this._aggregationInfo},setAggregationInfo:function(a){this._aggregationInfo=a;this.loaded&&this._map&&this._evalClusterManager();this.onAggregationInfoChange()},isAggregationEnabled:function(){return this._clusterManager&&this._clusterManager.isClusteringEnabled()},
getAggregationRenderer:function(){return this.isAggregationEnabled()?this._clusterManager.getClusterRenderer():null},getAggregationLayer:function(){return this._clusterManager?this._clusterManager.container:null},_evalClusterManager:function(){var a=this.getAggregationInfo();a?this._canCluster(a)?this._clusterManager?this._updateClusterManager(a):this._clusterManager=this._createClusterManager(a):console.log("FeatureLayer: Clustering is supported only for non-editable point layers in snapshot mode when map spatial reference is WGS84 or WebMercator"):
this._destroyClusterManager()},_canCluster:function(a){var b=this._map.spatialReference;return"cluster"===a.type&&(b.isWebMercator()||4326===b.wkid)&&"esriGeometryPoint"===this.geometryType&&!this.isEditable()&&(this.mode===M.MODE_SNAPSHOT||this.currentMode===M.MODE_SNAPSHOT||this.currentMode===M.MODE_STREAM)},_createClusterManager:function(a){a=new ga({layer:this,aggregationInfo:a});this._clusterHandles=[a.on("renderer-change,mode-change",p.hitch(this,function(){this.onAggregationRendererChange()}))];
a.initialize(this._map);return a},_updateClusterManager:function(a){var b=this._clusterManager;b&&b.setAggregationInfo(a)},_destroyClusterManager:function(){f.forEach(this._clusterHandles,function(a){a.remove()});this._clusterHandles=null;this._clusterManager&&(this._clusterManager.destroy(),this._clusterManager=null)},redraw:function(){this.inherited(arguments);this._clusterManager&&this._clusterManager.redraw();this._trackManager&&this._trackManager.container&&this._trackManager.container.redraw()},
_evalSDRenderer:function(){this.inherited(arguments);var a=this._getRenderer();this._ager=!!(a&&a.observationAger&&a.observationRenderer);this._trackManager&&this._trackManager.container&&this._trackManager.container.setRenderer(a&&a.trackRenderer)},_setMap:function(a){var b=this.inherited(arguments),d=this._mode,c=this;d&&a.loaded&&d.initialize(a);this.geometryType&&this.attr("data-geometry-type",this.geometryType.replace(/esriGeometry/i,"").toLowerCase());this._addHandle=this.on("graphic-node-add",
function(a){a=a.graphic.attributes;(a=c._selectedFeatures[a&&a[c.objectIdField]])&&a.attr("data-selected","")});return b},_unsetMap:function(a){var b=this._mode;b&&b.suspend();this._destroyClusterManager();this._trackManager&&(this._trackManager.destroy(),this._trackManager=null);q.disconnect(this._zoomConnect);q.disconnect(this._addHandle);this._zoomConnect=this._addHandle=null;this._toggleTime(!1);this.inherited("_unsetMap",arguments)},refresh:function(){this._needsRefresh=!1;var a=this._mode;a&&
a.refresh()},hasXYFootprint:function(){return"esriGeometryMultiPatch"===this.geometryType&&"xyFootprint"===this.multipatchOption},getOutFields:function(){return f.filter(this._getOutFields(),function(a){return"*"===a||!!this._getField(a)},this)},getField:function(a){return this._getField(a,!0)},isOutField:function(a){a=this.getField(a);if(!a)return!1;var b=this.getOutFields();return-1<f.indexOf(b,"*")||-1<f.indexOf(b,a.name)},getFieldLabel:function(a){var b=this.infoTemplate,b=b&&b.getFieldInfo&&
b.getFieldInfo(a);a=p.isFunction(a)?null:this.getField(a);var d=b||a,c="";d&&(c=b&&b.label||a&&a.alias||d.name||d.fieldName);return c},getDomain:function(a,b){var d,c,e=b&&b.feature,g=e&&this.typeIdField&&e.attributes&&e.attributes[this.typeIdField];null!=g&&f.some(this.types,function(b){return b.id==g?((d=b.domains&&b.domains[a])&&"inherited"===d.type&&(d=this._getLayerDomain(a),c=!0),!0):!1},this);c||d||(d=this._getLayerDomain(a));return d},_getLayerDomain:function(a){var b;f.some(this.fields,function(d){d.name===
a&&(b=d.domain);return!!b});return b},getType:function(a){var b,d=a&&this.typeIdField&&a.attributes&&a.attributes[this.typeIdField];f.some(this.types,function(a){a.id==d&&(b=a);return!!b});return b},setEditable:function(a){if(!this._collection)return console.log("FeatureLayer:setEditable - this functionality is not yet supported for layer in a feature service"),this;if(!this.loaded)return this._optEditable=a,this;var b=this._editable;this._editable=a;this._updateCaps();if(b!==a)this.onCapabilitiesChange();
return this},getEditCapabilities:function(a){var b={canCreate:!1,canUpdate:!1,canDelete:!1,canUpdateGeometry:!1};if(!this.loaded||!this.isEditable())return b;var d=a&&a.feature;a=a&&a.userId||this.getUserId();var c=f.map(this.capabilities?this.capabilities.toLowerCase().split(","):[],p.trim),e=(b=-1<f.indexOf(c,"editing"))&&-1<f.indexOf(c,"create"),g=b&&-1<f.indexOf(c,"update"),c=b&&-1<f.indexOf(c,"delete"),k=this.ownershipBasedAccessControlForFeatures,l=this.editFieldsInfo,N=l&&l.creatorField,l=
l&&l.realm,d=(d=d&&d.attributes)&&N?d[N]:void 0,h=!!this.userIsAdmin,N=!k||h||!(!k.allowOthersToUpdate&&!k.allowUpdateToOthers),m=!k||h||!(!k.allowOthersToDelete&&!k.allowDeleteToOthers),t=!k||h||!k.hasOwnProperty("allowAnonymousToUpdate")||k.allowAnonymousToUpdate,k=!k||h||!k.hasOwnProperty("allowAnonymousToDelete")||k.allowAnonymousToDelete;a&&l&&(a=a+"@"+l);if(h||b&&!(e||g||c))e=g=c=!0;b={canCreate:e,canUpdate:g,canDelete:c,canUpdateGeometry:h||this.allowGeometryUpdates};a||(b.canUpdate=b.canUpdate&&
t,b.canDelete=b.canDelete&&k);null===d?(b.canUpdate=b.canUpdate&&N,b.canDelete=b.canDelete&&m):""!==d&&d&&a.toLowerCase()!==d.toLowerCase()&&(b.canUpdate=b.canUpdate&&N,b.canDelete=b.canDelete&&m);return b},getUserId:function(){var a;this.loaded&&(a=this.credential&&this.credential.userId||this.userId||"");return a},setUserIsAdmin:function(a){this.userIsAdmin=a},setEditSummaryCallback:function(a){this.editSummaryCallback=a},getEditSummary:function(a,b,d){d=l.isDefined(d)?d:(new Date).getTime();var c=
"";d=this.getEditInfo(a,b,d);(b=b&&b.callback||this.editSummaryCallback)&&(d=b(a,d)||"");if(p.isString(d))c=d;else{if(d){a=d.action;b=d.userId;var e=d.timeValue,g=0;a&&g++;b&&g++;l.isDefined(e)&&g++;1<g&&(c=("edit"===a?"edit":"create")+(b?"User":"")+(l.isDefined(e)?d.displayPattern:""))}c=c&&l.substitute(d,this.i18n.layers.FeatureLayer[c])}return c},getEditInfo:function(a,b,d){if(this.loaded){d=l.isDefined(d)?d:(new Date).getTime();b=b&&b.action||"last";var c=this.editFieldsInfo,e=c&&c.creatorField,
g=c&&c.creationDateField,k=c&&c.editorField,c=c&&c.editDateField,k=(a=a&&a.attributes)&&k?a[k]:void 0,c=a&&c?a[c]:null,e=this._getEditData(a&&e?a[e]:void 0,a&&g?a[g]:null,d);d=this._getEditData(k,c,d);var f;switch(b){case "creation":f=e;break;case "edit":f=d;break;case "last":f=d||e}f&&(f.action=f===d?"edit":"creation");return f}},_getEditData:function(a,b,d){var c,e,g;l.isDefined(b)&&(e=d-b,g=0>e?"Full":6E4>e?"Seconds":12E4>e?"Minute":36E5>e?"Minutes":72E5>e?"Hour":864E5>e?"Hours":6048E5>e?"WeekDay":
"Full");if(void 0!==a||g)c=c||{},c.userId=a,g&&(a=r.format,d=new Date(b),c.minutes=Math.floor(e/6E4),c.hours=Math.floor(e/36E5),c.weekDay=a(d,{datePattern:"EEEE",selector:"date"}),c.formattedDate=a(d,{selector:"date"}),c.formattedTime=a(d,{selector:"time"}),c.displayPattern=g,c.timeValue=b);return c},isEditable:function(){return!(!this._editable&&!this.userIsAdmin)},isQueryable:function(){var a=f.map(this.capabilities?this.capabilities.toLowerCase().split(","):[],p.trim);return this._isStream||this.userIsAdmin||
this._collection||-1!==f.indexOf(a,"query")||-1!==f.indexOf(a,"catalog")},setMaxAllowableOffset:function(a){this.isEditable()||this._setMaxOffset(a,!0);return this},getMaxAllowableOffset:function(){var a=this._quantizationParameters?this._quantizationParameters.tolerance:void 0;return null!=this._maxOffset?this._maxOffset:a},_setMaxOffset:function(a,b){if(null==a)return delete this._maxOffset,delete this._quantizationParameters,this;this.quantize&&this.supportsCoordinatesQuantization?("esriGeometryPolyline"===
this.geometryType?this._maxOffset=a:delete this._maxOffset,this._quantizationParameters={mode:"view",originPosition:"upperLeft",tolerance:a,extent:this.fullExtent}):(this._isFractionalOffsetAllowed()&&b||(a=Math.floor(a)),isNaN(a)||0===a?delete this._maxOffset:this._maxOffset=a,delete this._quantizationParameters);return this},_isFractionalOffsetAllowed:function(){return null==this.version||10.1<=this.version||navigator.languages&&this._isLangWithDot(navigator.languages[0])},_isLangWithDot:function(a){a=
(a=a&&a.split("-"))&&a[0]&&a[0].toLowerCase();return-1!==f.indexOf(this._langsWithDot,a)},_langsWithDot:"ar en et fr he ja ko th vi zh".split(" "),setAutoGeneralize:function(a){this.loaded?this.isEditable()||this.mode===M.MODE_SNAPSHOT||"esriGeometryPolyline"!==this.geometryType&&"esriGeometryPolygon"!==this.geometryType&&!this.hasXYFootprint()||((this._autoGeneralize=a)?(this._autoSnapshot&&(this._prevScale=null),this._updateMaxOffset()):this._setMaxOffset(null)):this._optAutoGen=a;return this},
setGDBVersion:function(a){this._collection||a===this.gdbVersion||!a&&!this.gdbVersion||(this.gdbVersion=a,this._task.gdbVersion=a,this._url.query=p.mixin(this._url.query,{gdbVersion:a}),this.loaded&&(this.clearSelection(),this._map&&this.refresh()),this.onGDBVersionChange());return this},hasAllFeatures:function(){return this._mode?this._mode.hasAllFeatures():!0},setDefinitionExpression:function(a){this._defnExpr=a;(a=this._mode)&&a.propertyChangeHandler(1);return this},getDefinitionExpression:function(){return this._defnExpr},
setTimeDefinition:function(a){this._isSnapshot?(this._timeDefn=a,(a=this._mode)&&a.propertyChangeHandler(2)):console.log("FeatureLayer.setTimeDefinition: layer in on-demand or selection mode does not support time definitions. Layer id \x3d "+this.id+", Layer URL \x3d "+this.url);return this},getTimeDefinition:function(){return this._timeDefn},setTimeOffset:function(a,b){this._timeOffset=a;this._timeOffsetUnits=b;var d=this._mode;d&&d.propertyChangeHandler(0);return this},setUseMapTime:function(a){this.useMapTime=
a;this._toggleTime(!this.suspended);(a=this._mode)&&a.propertyChangeHandler(0)},selectFeatures:function(a,b,d,c){b=b||M.SELECTION_NEW;this._hasPartialSelectedFeatures=!1;a=this._getShallowClone(a);var e=this._map,k,l=this,f=y._fixDfd(new u(y._dfdCanceller));a.outFields=this.getOutFields();a.returnGeometry=!0;a.multipatchOption=this.multipatchOption;e&&(a.outSpatialReference=new A(e.spatialReference.toJson()));if(!this._applyQueryFilters(a,!0))return k={features:[]},this._selectHandler(k,b,d,c,f),
f;if(e=this._canDoClientSideQuery(a))f._pendingDfd=g(this._doQuery(a,e)),f._pendingDfd.then(function(a){k={features:a};l._selectHandler(k,b,d,c,f)});else{if(this._collection)return this._resolve([Error("FeatureLayer::selectFeatures - "+this.invalidParams)],null,c,f,!0),f;if(this.loaded&&!this.isQueryable())return this._resolve([Error("Layer does not support query capability.")],null,c,f,!0),f;var h=this;this._ts&&(a._ts=(new Date).getTime());(f._pendingDfd=this._task.execute(a)).addCallbacks(function(a){h._selectHandler(a,
b,d,c,f)},function(a){h._hasPartialSelectedFeatures=!0;h._resolve([a],null,c,f,!0)})}return f},getSelectedFeatures:function(){var a=this._selectedFeatures,b=[],d;for(d in a)a.hasOwnProperty(d)&&b.push(a[d]);return b},clearSelection:function(a){var b=this._selectedFeatures,d=this._mode,c;for(c in b)b.hasOwnProperty(c)&&(this._unSelectFeatureIIf(c,d),d._removeFeatureIIf(c));this._selectedFeatures={};this._isSelOnly&&d._applyTimeFilter(!0);if(!a)this.onSelectionClear();return this},setSelectionSymbol:function(a){if(this._selectionSymbol=
a){var b=this._selectedFeatures,d;for(d in b)b.hasOwnProperty(d)&&b[d].setSymbol(a)}return this},getSelectionSymbol:function(){return this._selectionSymbol},setLabelingInfo:function(a){a?(this.labelingInfo=a,this._fixLabelExpr()):delete this.labelingInfo;this._collection&&(this._typesDirty=!0);this.onLabelingInfoChange()},_fixLabelExpr:function(){var a=/\[([^\[\]]+)\]/ig,b,d=this,c=function(a,b){var c=d._getField(b,!0);return"["+(c&&c.name||b)+"]"};f.forEach(this.labelingInfo,function(d){if(b=d.labelExpression)d.labelExpression=
b.replace(a,c)})},_updateRequiredFieldsFromLabelingInfo:function(){var a=[];f.forEach(this.labelingInfo,function(b){var d=b.labelExpressionInfo;if(b.labelExpression){var c=/[\[\]]/ig;b=b.labelExpression.match(/\[[^\[\]]+\]/ig);(b=f.map(b,function(a){return a.replace(c,"")}))&&(a=a.concat(b))}if(d){if(d.value){var e=/[\{\}]/ig;b=d.value.match(/\{[^\{\}]+\}/ig);(b=f.map(b,function(a){return a.replace(e,"")}))&&(a=a.concat(b))}d.expression&&(a=a.concat(K.extractFieldNames(d.expression)))}});a=f.map(a,
function(a){var b=this.getField(a);return b?b.name:a},this);this._requiredFields&&(this._requiredFields=this._requiredFields.concat(a))},__msigns:[{n:"applyEdits",c:5,a:[{i:0},{i:1}],e:4,f:1}],applyEdits:function(a,b,d,c,e,g){var k=g.assembly,l=g.dfd;this._applyNormalized(a,k&&k[0]);this._applyNormalized(b,k&&k[1]);this.onBeforeApplyEdits(a,b,d);var h={},N=this.objectIdField,k={f:"json"},m=!1;if(this._collection)g={},g.addResults=a?f.map(a,function(){m=!0;return{objectId:this._nextId++,success:!0}},
this):null,g.updateResults=b?f.map(b,function(a){m=!0;var b=a.attributes[N];h[b]=a;return{objectId:b,success:!0}},this):null,g.deleteResults=d?f.map(d,function(a){m=!0;return{objectId:a.attributes[N],success:!0}},this):null,m?this._editHandler(g,a,h,c,e,l):this._resolve([g.addResults,g.updateResults,g.deleteResults],null,c,l);else{a&&0<a.length&&(k.adds=this._convertFeaturesToJson(a,0,1),m=!0);if(b&&0<b.length){for(g=0;g<b.length;g++){var P=b[g];h[P.attributes[N]]=P}k.updates=this._convertFeaturesToJson(b,
0,0,1);m=!0}if(d&&0<d.length){b=[];for(g=0;g<d.length;g++)b.push(d[g].attributes[N]);k.deletes=b.join(",");m=!0}if(m){var w=this;return t({url:this._url.path+"/applyEdits",content:p.mixin(k,this._url.query),callbackParamName:"callback",load:function(b){w._editHandler(b,a,h,c,e,l)},error:function(a){w._resolve([a],null,e,l,!0)}},{usePost:!0})}this._resolve([],null,c,l)}},queryFeatures:function(a,b,d){return this._query("execute","onQueryFeaturesComplete",a,b,d)},queryRelatedFeatures:function(a,b,d){return this._query("executeRelationshipQuery",
"onQueryRelatedFeaturesComplete",a,b,d)},queryIds:function(a,b,d){return this._query("executeForIds","onQueryIdsComplete",a,b,d)},queryCount:function(a,b,d){return this._query("executeForCount","onQueryCountComplete",a,b,d)},queryExtent:function(a,b,d){return this._query("executeForExtent","onQueryExtentComplete",a,b,d)},queryAttachmentInfos:function(a,d,c){var e=this._url.path+"/"+a+"/attachments",g=new u(y._dfdCanceller),k=this;g._pendingDfd=t({url:e,content:p.mixin({f:"json"},this._url.query),
callbackParamName:"callback",load:function(c){c=c.attachmentInfos;var l;f.forEach(c,function(d){l=b.objectToQuery({gdbVersion:k._url.query&&k._url.query.gdbVersion,layer:k._url.query&&k._url.query.layer,token:k._getToken()});d.url=e+"/"+d.id+(l?"?"+l:"");d.objectId=a});k._resolve([c],"onQueryAttachmentInfosComplete",d,g)},error:function(a){k._resolve([a],null,c,g,!0)}});return g},addAttachment:function(a,b,d,c){return this._sendAttachment("add",a,b,d,c)},updateAttachment:function(a,b,c,e,g){c.appendChild(d.create("input",
{type:"hidden",name:"attachmentId",value:b}));return this._sendAttachment("update",a,c,e,g)},deleteAttachments:function(a,b,d,c){var e=this._url.path+"/"+a+"/deleteAttachments",g=new u(y._dfdCanceller),k=this;b={f:"json",attachmentIds:b.join(",")};g._pendingDfd=t({url:e,content:p.mixin(b,this._url.query),callbackParamName:"callback",load:p.hitch(this,function(b){b=b.deleteAttachmentResults;b=f.map(b,function(b){b=new T(b);b.attachmentId=b.objectId;b.objectId=a;return b});k._resolve([b],"onDeleteAttachmentsComplete",
d,g)}),error:function(a){k._resolve([a],null,c,g,!0)}},{usePost:!0});return g},addType:function(a){var b=this.types;if(b){if(f.some(b,function(b){return b.id==a.id?!0:!1}))return!1;b.push(a)}else this.types=[a];return this._typesDirty=!0},deleteType:function(a){if(this._collection){var b=this.types;if(b){var d=-1;f.some(b,function(b,c){return b.id==a?(d=c,!0):!1});if(-1<d)return this._typesDirty=!0,b.splice(d,1)[0]}}},toJson:function(){var a=this._json;if(a=p.isString(a)?v.fromJson(a):p.clone(a)){var a=
a.layerDefinition?a:{layerDefinition:a},b=a.layerDefinition,d=this._collection;if(d&&this._typesDirty){b.types=f.map(this.types||[],function(a){return a.toJson()});var c=this.renderer,e=this.labelingInfo,g=b.drawingInfo;!c&&!e||g||(g=b.drawingInfo={});g&&c&&-1===c.declaredClass.indexOf("TemporalRenderer")&&(g.renderer=c.toJson());e&&(g.labelingInfo=f.map(e,function(a){return a.toJson()}))}c=null;if(!d||this._fcAdded)c={geometryType:b.geometryType,features:this._convertFeaturesToJson(this.graphics,
!0)};a.featureSet=p.mixin({},a.featureSet||{},c);a.featureSet.transform&&(e=a.featureSet.transform,delete a.featureSet.transform,c=new O(a.featureSet),c.quantize(e),a.featureSet=c.toJson());d&&(a.nextObjectId=this._nextId,b.capabilities=this.capabilities);return a}},onSelectionComplete:function(){},onSelectionClear:function(){},onBeforeApplyEdits:function(){},onEditsComplete:function(){},onQueryFeaturesComplete:function(){},onQueryRelatedFeaturesComplete:function(){},onQueryIdsComplete:function(){},
onQueryCountComplete:function(){},onQueryExtentComplete:function(){},onQueryAttachmentInfosComplete:function(){},onAddAttachmentComplete:function(){},onUpdateAttachmentComplete:function(){},onDeleteAttachmentsComplete:function(){},onCapabilitiesChange:function(){},onGDBVersionChange:function(){},onQueryLimitExceeded:function(){},onLabelingInfoChange:function(){},onAggregationRendererChange:function(){},onAggregationInfoChange:function(){},_forceIdentity:function(b){var d=this,c,e=this._url&&this._url.path;
c=e&&e.toLowerCase().indexOf("/rest/services");var g=this.editFieldsInfo,g=g&&(g.creatorField||g.editorField);(this.userIsAdmin||g)&&!this._getToken()&&-1<c&&a.id?(c=e.substring(0,c)+"/rest/info",t({url:c,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(function(b){if(b.owningSystemUrl)return a.id.checkSignInStatus(b.owningSystemUrl+"/sharing")}).then(function(b){if(b)return a.id.getCredential(e)}).then(function(a){a&&d._findCredential()}).always(function(){b.call(d)})):b.call(this)},
_checkMode:function(a){var b=this.geometryType,d=this.maxRecordCount;a=(a=a&&a.features&&a.features[0])&&a.attributes&&a.attributes.exceedslimit;this.mode===M.MODE_AUTO&&!this.isEditable()&&0===a&&(this.queryPagination||("esriGeometryPolyline"===b||"esriGeometryPolygon"===b||"esriGeometryMultipoint"===b||this.hasXYFootprint())&&d>=this.maxRecordCountForAuto||"esriGeometryPoint"===b&&d>=this.maxPointCountForAuto)&&(this.currentMode=M.MODE_SNAPSHOT,this._mode=new S(this),this._isSnapshot=this._autoSnapshot=
!0)},_queryLimit:function(){var a=this,b=new u;this._limitPromise=b.promise;setTimeout(function(){var d=new G,c=new da;c.statisticType="exceedslimit";c.maxPointCount=a.maxPointCountForAuto;c.maxRecordCount=a.maxRecordCountForAuto;c.maxVertexCount=a.maxVertexCountForAuto;c.outStatisticFieldName="exceedslimit";d.outStatistics=[c];a.queryFeatures(d).promise.then(function(a){b.resolve(a)},function(a){b.reject(a)})},0)},_updateCaps:function(){var a=this._editable,b=p.trim(this.capabilities||""),d=f.map(b?
b.split(","):[],p.trim),c=f.map(b?b.toLowerCase().split(","):[],p.trim),b=f.indexOf(c,"editing"),e,c={Create:f.indexOf(c,"create"),Update:f.indexOf(c,"update"),Delete:f.indexOf(c,"delete")};if(a&&-1===b)d.push("Editing");else if(!a&&-1<b){a=[b];for(e in c)-1<c[e]&&a.push(c[e]);a.sort();for(e=a.length-1;0<=e;e--)d.splice(a[e],1)}this.capabilities=d.join(",")},_counter:{value:0},_getUniqueId:function(){return this._counter.value++},onSuspend:function(){this.inherited(arguments);this._toggleTime(!1);
var a=this._mode;a&&a.suspend()},onResume:function(a){this.inherited(arguments);this._toggleTime(!0);var b=this._mode,d=this._map,c=this._getRenderer();a.firstOccurrence?(this._fixRendererFields(),this._updateRequiredFieldsFromLabelingInfo(),this._checkFields(),this.clearSelection(),this._evalClusterManager(),this.timeInfo&&!this._trackManager&&(this._trackIdField||c&&(c.latestObservationRenderer||c.trackRenderer))&&(this._trackManager=new la(this),this._trackManager.initialize(d),this._childLayer=
this._trackManager.container),c&&"colors"in c&&"blurRadius"in c&&"maxPixelIntensity"in c&&"esriGeometryPoint"==this.geometryType&&!this._heatmapManager&&(this._heatmapManager=new ba(this),this._heatmapManager.initialize(d)),this._autoSnapshot&&this._autoGeneralize&&("esriGeometryPolyline"===this.geometryType||"esriGeometryPolygon"===this.geometryType||this.hasXYFootprint())&&!this.isEditable()&&null==this.getMaxAllowableOffset()&&(c=this.generalizeForScale,this._calculatedScale=c=this.maxScale?this.maxScale:
this.minScale?Math.min(c,this.minScale):Math.min(c,sa.getScale(d,this.initialExtent)),this._calcMaxOffset=d.extent.getWidth()/d.width/d.getScale()*c),this._zoomConnect=q.connect(d,"onZoomEnd",this,this._zoomEndHandler),this._updateMaxOffset(),this._needsRefresh=!1,b&&(b._init||b.initialize(d),b.startup())):(this._zoomEndHandler(),b&&b.resume())},_zoomEndHandler:function(){var a=this._map;this._updateMaxOffset();this._prevScale=a.getScale();!this.suspended&&this._needsRefresh&&this.refresh()},_updateMaxOffset:function(){var a=
this._map;a&&a.loaded&&this._autoGeneralize&&(this._autoSnapshot?(a=this.getMaxAllowableOffset(),this._setMaxOffset(this._getMaxOffsetForScale(),!0),this._needsRefresh||(this._needsRefresh=a!=this.getMaxAllowableOffset())):this._setMaxOffset(a.extent.getWidth()/a.width,!a.extent.spatialReference.isWebMercator()))},_getMaxOffsetForScale:function(){if(this._map){var a=this._map.getScale(),b=this._calculatedScale,d=this._calcMaxOffset,c=this._prevScale;return a>=b&&(null==c||c<b)?d:a<b&&(null==c||c>=
b)?null:this.getMaxAllowableOffset()}},_toggleTime:function(a){var b=this._map;a&&this.timeInfo&&this.useMapTime&&b?(this._mapTimeExtent=b.timeExtent,this._timeConnect||(this._timeConnect=q.connect(b,"onTimeExtentChange",this,this._timeChangeHandler))):(this._mapTimeExtent=null,q.disconnect(this._timeConnect),this._timeConnect=null)},_timeChangeHandler:function(a){this._mapTimeExtent=a;(a=this._mode)&&a.propertyChangeHandler(0)},_getOffsettedTE:function(a){var b=this._timeOffset,d=this._timeOffsetUnits;
return a&&b&&d?a.offset(-1*b,d):a},_getTimeOverlap:function(a,b){return a&&b?a.intersection(b):a||b},_getTimeFilter:function(a){var b=this.getTimeDefinition(),d;if(b&&(d=this._getTimeOverlap(b,null),!d))return[!1];if(a){if(a=d?this._getTimeOverlap(a,d):a,!a)return[!1]}else a=d;return[!0,a]},_getAttributeFilter:function(a){var b=this.getDefinitionExpression();return a?b?"("+b+") AND ("+a+")":a:b},_applyQueryFilters:function(a,b){a.where=this._getAttributeFilter(a.where);!a.returnGeometry||a.maxAllowableOffset||
a.quantizationParameters||(a.maxAllowableOffset=this._maxOffset,a.quantizationParameters=this._quantizationParameters);b&&this.supportsAdvancedQueries&&(a.orderByFields=a.orderByFields||this.getOrderByFields());if(this.timeInfo){var d=this._getTimeFilter(a.timeExtent);if(d[0])a.timeExtent=d[1];else return!1}return!0},_add:function(a){var b=this._selectionSymbol,d=a.attributes,c=this.visibilityField;b&&this._isSelOnly&&a.setSymbol(b);if(c&&d&&d.hasOwnProperty(c))a[d[c]?"show":"hide"]();return this.add.apply(this,
arguments)},_remove:function(){return this.remove.apply(this,arguments)},_canDoClientSideQuery:function(a){var b=[],d=this._map,c;if((this._collection||!this._isTable&&d)&&!(a.text||a.where&&a.where!==this.getDefinitionExpression()||a.orderByFields&&a.orderByFields.length&&(c=this.getOrderByFields()||[])&&a.orderByFields.join()!==c.join()||a.outStatistics||a.returnDistinctValues)){c=this._isSnapshot;var e=this._isSelOnly,g=a.geometry;if(g){if(e||a.spatialRelationship!==G.SPATIAL_REL_INTERSECTS||"extent"!==
g.type||!c&&!d.extent.contains(g))return;b.push(1)}if(d=a.objectIds)if(c)b.push(2);else{var g=d.length,k=this._mode,l=0,h;for(h=0;h<g;h++)k._getFeature(d[h])&&l++;if(l===g)b.push(2);else return}if(this.timeInfo)if(a=a.timeExtent,d=this._mapTimeExtent,c)a&&b.push(3);else if(e){if(a)return}else if(d)if(-1!==f.indexOf(b,2))a&&b.push(3);else if(-1!==f.indexOf(b,1))a==d&&b.push(3);else return;else if(0<b.length)a&&b.push(3);else if(a)return;return 0<b.length?b:null}},_getAbsMid:function(a){return n.toAbsMid?
n.toAbsMid(a):m.id.replace(/\/[^\/]*$/ig,"/")+a},_doQuery:function(a,b,d){var c=[],e=this.objectIdField,g=this,k=new u,l=new u,h=this.graphics;if(-1!==f.indexOf(b,1)){var m=this.spatialIndex||this._map&&this._map.spatialIndex,t,w=a.geometry._normalize(null,!0);null==m&&ha.autoSpatialIndexing?t=(this._map||this).addPlugin(this._getAbsMid("../plugins/spatialIndex")).then(p.hitch(this,p.partial(this._getFromIndex,w,m)),function(a){l.resolve(p.hitch(this,p.partial(this._filterByExtent,h,w)))}):m&&(t=
this._getFromIndex(w,m));t?t.then(function(a){for(var b=0;b<a.length;b++)a[b].results&&(c=c.concat(a[b].results));l.resolve(c)}).otherwise(function(a){l.reject(a)}):l.resolve(this._filterByExtent(h,w))}else l.resolve(h);l.then(function(l){c=l;if(-1!==f.indexOf(b,2)){var h=a.objectIds;c=f.filter(c,function(a){return-1<f.indexOf(h,a.attributes[e])})}-1!==f.indexOf(b,3)&&g.timeInfo&&(l=a.timeExtent,c=g._filterByTime(c,l.startTime,l.endTime).match);d&&(c=f.map(c,function(a){return a.attributes[e]},this));
k.resolve(c)});return k},_getFromIndex:function(a,b){b=b||this.spatialIndex||this._map.spatialIndex;a instanceof Array||(a=[a]);var d=this.id;return k(f.map(a,function(a){return b.intersects(a,d)}))},_filterByExtent:function(a,b){for(var d=[],c=0,e=a.length;c<e;c++){var g=a[c],k=g.geometry;k&&(this.normalization&&b.length?(b[0].intersects(k)||b[1].intersects(k))&&d.push(g):b.intersects(k)&&d.push(g))}return d},_filterByTime:function(a,b,d){var c=this._startTimeField,e=this._endTimeField,g;this._twoTimeFields||
(g=c||e);var k=l.isDefined,f=[],h=[],m,t=a.length,w,p;b=b?b.getTime():-Infinity;d=d?d.getTime():Infinity;if(g)for(m=0;m<t;m++)w=a[m],p=w.attributes,c=p[g],c>=b&&c<=d?f.push(w):h.push(w);else for(m=0;m<t;m++)w=a[m],p=w.attributes,g=p[c],p=p[e],g=k(g)?g:-Infinity,p=k(p)?p:Infinity,g>=b&&g<=d||p>=b&&p<=d||b>=g&&d<=p?f.push(w):h.push(w);return{match:f,noMatch:h}},_getSizeVariables:function(a){return a&&f.filter(a.getVisualVariablesForType("sizeInfo",!1),function(a){return!(!a.field&&!a.valueExpression)})},
_needClientSideSorting:function(a){return this._collection?!(!a||!a.length):f.some(a,function(a){return!!a.valueExpression})},_sortFeatures:function(a){var b=this.renderer,d=this._getSizeVariables(b);if(a&&1<a.length&&this._needClientSideSorting(d)){var c=d[0],e=this;a.sort(function(a,d){a._layer||(a._layer=e);d._layer||(d._layer=e);var g=b._getDataValue(a,c,"sizeInfo",null,e),k=b._getDataValue(d,c,"sizeInfo",null,e);return null==g?-1:null==k?1:k-g})}return a},_resolve:function(a,b,d,c,e){b&&this[b].apply(this,
a);d&&d.apply(null,a);c&&y._resDfd(c,a,e)},_getShallowClone:function(a){var b=new G,d;for(d in a)a.hasOwnProperty(d)&&(b[d]=a[d]);return b},_query:function(a,b,d,c,e){var k=this,l=this._map,h=new u(y._dfdCanceller),m=d,t,w,p;if("executeRelationshipQuery"!==a){var m=this._getShallowClone(d),r=this.getOutFields();m.outFields||(m.outFields=r);m.outFields&&m.outFields.length&&(w=-1<f.indexOf(r,"*")?!1:!f.every(m.outFields,function(a){return-1<f.indexOf(r,a)}));m.returnGeometry=d.hasOwnProperty("returnGeometry")?
d.returnGeometry:!d.outStatistics;m.returnGeometry&&(m.multipatchOption=this.multipatchOption,(m.maxAllowableOffset||m.quantizationParameters)&&(d=m.maxAllowableOffset||m.quantizationParameters.tolerance)&&d!==this.getMaxAllowableOffset()&&(p=!0));var n;l&&(l=l&&l.spatialReference,(d=m.outSpatialReference)?t=!d.equals(l):m.outSpatialReference=new A(l.toJson()));if(!this._applyQueryFilters(m,"execute"===a&&!m.outStatistics)){switch(a){case "execute":n=new O({features:[]});break;case "executeForIds":n=
[];break;case "executeForCount":n=0;break;case "executeForExtent":n={}}this._resolve([n],b,c,h);return h}if(l="executeForExtent"!==a&&!t&&!w&&!p&&this._canDoClientSideQuery(m))return h._pendingDfd=g(this._doQuery(m,l,"executeForIds"===a||"executeForCount"===a)),h._pendingDfd.then(function(d){switch(a){case "execute":n=new O;n.features=d;break;case "executeForIds":n=d;break;case "executeForCount":n=d.length}k._resolve([n],b,c,h)}),h}if(this._collection)return this._resolve([Error("FeatureLayer::_query - "+
this.invalidParams)],null,e,h,!0),h;if(this.loaded&&!this.isQueryable())return this._resolve([Error("Layer does not support query capability.")],null,e,h,!0),h;this._ts&&(m._ts=(new Date).getTime());(h._pendingDfd=this._task[a](m)).addCallbacks(function(d){var e=!!m.outStatistics||t||w||p;if("execute"===a||"executeRelationshipQuery"===a){var g,l;if("execute"===a)for(g=d.features,l=g.length,--l;0<=l;l--){if(g[l]._layer=k,!e&&!k._isTable){var f=k._mode._getFeature(g[l].attributes[k.objectIdField]);
f&&g.splice(l,1,f)}}else for(f in d)if(d.hasOwnProperty(f))for(g=d[f].features,l=g.length,--l;0<=l;l--)g[l]._layer=k}k._resolve([d],b,c,h)},function(a){k._resolve([a],null,e,h,!0)});return h},_convertFeaturesToJson:function(a,b,d,c){var e=[],g=this._selectionSymbol,k=this.visibilityField,l,h=this.objectIdField;this.loaded&&(d||c)&&(l=f.filter(this.fields,function(a){return!1===a.editable&&(!c||a.name!==h)}));for(d=0;d<a.length;d++){var m=a[d],t={},w=m.geometry,r=m.attributes,n=m.symbol;!w||c&&this.loaded&&
!this.allowGeometryUpdates||(t.geometry=w.toJson());k?(t.attributes=r=p.mixin({},r),r[k]=m.visible?1:0):r&&(t.attributes=p.mixin({},r));t.attributes&&l&&l.length&&f.forEach(l,function(a){delete t.attributes[a.name]});n&&n!==g&&(t.symbol=n.toJson());e.push(t)}return b?e:v.toJson(e)},_selectHandler:function(a,b,d,c,e){var g;c=M;switch(b){case c.SELECTION_NEW:this.clearSelection(!0);g=!0;break;case c.SELECTION_ADD:g=!0;break;case c.SELECTION_SUBTRACT:g=!1}c=a.features;var k=this._mode,l=[],f=this.objectIdField,
h,m;if(g)for(g=0;g<c.length;g++)h=c[g],m=h.attributes[f],h=k._addFeatureIIf(m,h),l.push(h),this._selectFeatureIIf(m,h,k);else for(g=0;g<c.length;g++)h=c[g],m=h.attributes[f],this._unSelectFeatureIIf(m,k),m=k._removeFeatureIIf(m),l.push(m||h);this._isSelOnly&&k._applyTimeFilter(!0);this._hasPartialSelectedFeatures=!!a.exceededTransferLimit;this._resolve([l,b,a.exceededTransferLimit?{queryLimitExceeded:!0}:null],"onSelectionComplete",d,e);if(a.exceededTransferLimit)this.onQueryLimitExceeded()},_selectFeatureIIf:function(a,
b,d){var c=this._selectedFeatures,e=c[a];e||(d._incRefCount(a),c[a]=b,this._isTable||(this._setSelectSymbol(b),b.attr("data-selected","")));return e||b},_unSelectFeatureIIf:function(a,b){var d=this._selectedFeatures[a];d&&(b._decRefCount(a),delete this._selectedFeatures[a],this._isTable||(this._setUnSelectSymbol(d),d.attr("data-selected")));return d},_isSelected:function(a){},_setSelectSymbol:function(a){var b=this._selectionSymbol;b&&!this._isSelOnly&&a.setSymbol(b)},_setUnSelectSymbol:function(a){var b=
this._selectionSymbol;b&&!this._isSelOnly&&b===a.symbol&&a.setSymbol(null,!0)},_getOutFields:function(){var a=[this.objectIdField,this.typeIdField,this.creatorField,this._startTimeField,this._endTimeField,this._trackIdField].concat(this._requiredFields).concat(this.dataAttributes),a=f.filter(a,function(a,b,d){return!!a&&f.indexOf(d,a)===b}),b=p.clone(this._outFields);if(b){if(-1!==f.indexOf(b,"*"))return b;f.forEach(a,function(a){-1===f.indexOf(b,a)&&b.push(a)});return b}return a},_checkFields:function(a){var b=
a||this._getOutFields();f.forEach(b,function(a){"*"!==a&&(this._getField(a)||console.debug("esri.layers.FeatureLayer: "+l.substitute({url:this.url,field:a},"unable to find '${field}' field in the layer 'fields' information [url: ${url}]")))},this);a||this._isTable||this._fserver||this._collection||this._isStream||f.some(this.fields,function(a){return a&&"esriFieldTypeGeometry"===a.type?!0:!1})||console.debug("esri.layers.FeatureLayer: "+l.substitute({url:this.url},"unable to find a field of type 'esriFieldTypeGeometry' in the layer 'fields' information. If you are using a map service layer, features will not have geometry [url: ${url}]"))},
_fixFieldCase:function(a,b,d){var c=a&&a[b],e;if(c&&!p.isFunction(c)){if(e=!this._getField(c)&&this._getField(c,!0))c=a[b]=e.name;d&&d.push(c)}return c},_fixRendererFields:function(){var a=this.renderer;this._orderBy=null;this._requiredFields=[];if(a&&0<this.fields.length){var b=[],d,a=f.filter([a,a.observationRenderer,a.latestObservationRenderer,a.trackRenderer],l.isDefined),c=[].concat(a);f.forEach(a,function(a){f.forEach(a.rendererInfos,function(a){a.renderer&&c.push(a.renderer)})});f.forEach(c,
function(a){this._fixFieldCase(a,"attributeField",b);this._fixFieldCase(a,"attributeField2",b);this._fixFieldCase(a,"attributeField3",b);this._fixFieldCase(a.rotationInfo,"field",b);(d=this._fixFieldCase(a.sizeInfo,"field",b))&&!this._orderBy&&(this._orderBy=[d+" DESC"]);this._fixFieldCase(a.sizeInfo,"normalizationField",b);this._fixFieldCase(a.colorInfo,"field",b);this._fixFieldCase(a.colorInfo,"normalizationField",b);this._fixFieldCase(a.field,"field",b);this._fixFieldCase(a.opacityInfo,"field",
b);this._fixFieldCase(a.opacityInfo,"normalizationField",b);f.forEach(a.visualVariables,function(a){d=this._fixFieldCase(a,"field",b);"sizeInfo"===a.type&&d&&!this._orderBy&&(this._orderBy=[d+" DESC"]);this._fixFieldCase(a,"normalizationField",b)},this);var c=f.map(a.getFieldsUsedInExpressions(),function(a){var b=this.getField(a);return b?b.name:a},this);b=b.concat(c);this._orderBy||!a.addBreak||p.isFunction(a.attributeField)||!a.backgroundFillSymbol&&!this._hasSizeDiff(a)||(this._orderBy=[a.attributeField+
" DESC"])},this);this._requiredFields=f.filter(b,l.isDefined)}},_hasSizeDiff:function(a){var b=Number.MAX_VALUE,d=-Number.MAX_VALUE,c,e;f.forEach(a.infos,function(a){if(e=a.symbol){c=0;switch(e.type){case "simplemarkersymbol":c=e.size;break;case "picturemarkersymbol":c=(e.width+e.height)/2;break;case "simplelinesymbol":case "cartographiclinesymbol":c=e.width;break;case "simplefillsymbol":case "picturefillsymbol":c=e.outline&&e.outline.width}c&&(b=Math.min(b,c),d=Math.max(d,c))}});return b!==Number.MAX_VALUE&&
d!==-Number.MAX_VALUE&&1<Math.abs(d-b)},getOrderByFields:function(){var a=this.orderByFields||this._orderBy;return this.supportsAdvancedQueries&&a?f.filter(a,function(a){a=a.split(" ")[0];return!!this._getField(a,!0)},this):null},_getField:function(a,b){var d=this.fields;if(!d||0===d.length)return null;var c;b&&(a=a.toLowerCase());f.some(d,function(d){var e=!1;(e=b?d&&d.name.toLowerCase()===a?!0:!1:d&&d.name===a?!0:!1)&&(c=d);return e});return c},_getDateOpts:function(){this._dtOpts||(this._dtOpts=
{properties:f.map(f.filter(this.fields,function(a){return!(!a||"esriFieldTypeDate"!==a.type)}),function(a){return a.name})});return this._dtOpts},_applyNormalized:function(a,b){a&&b&&f.forEach(a,function(a,d){a&&b[d]&&a.setGeometry(b[d])})},_editHandler:function(a,b,d,c,e,g){e=a.addResults;var k=a.updateResults;a=a.deleteResults;var l,h,m,t,w,r=this.objectIdField,n=this._mode,u=this._isTable;l=this.editFieldsInfo;t=this.getOutFields()||[];var q=l&&l.creatorField,G=l&&l.creationDateField,z=l&&l.editorField,
y=l&&l.editDateField;l=l&&l.realm;-1===f.indexOf(t,"*")&&(q&&-1===f.indexOf(t,q)&&(q=null),G&&-1===f.indexOf(t,G)&&(G=null),z&&-1===f.indexOf(t,z)&&(z=null),y&&-1===f.indexOf(t,y)&&(y=null));var x=G||y?(new Date).getTime():null,O=q||z?this.getUserId():void 0;O&&l&&(O=O+"@"+l);if(e){var A=this.globalIdField;for(l=0;l<e.length;l++)e[l]=new T(e[l]),u||(h=e[l],h.success&&(m=h.objectId,t=b[l],(w=t._graphicsLayer)&&w!==this&&w.remove(t),w=t.attributes||{},w[r]=m,m=h.globalId,A&&m&&(w[A]=m),q&&(w[q]=O),
z&&(w[z]=O),G&&(w[G]=x),y&&(w[y]=x),t.setAttributes(w),n._init&&n.drawFeature(t)))}if(k)for(l=0;l<k.length;l++)if(k[l]=new T(k[l]),!u&&(h=k[l],h.success)){m=h.objectId;t=d[m];if(b=n._getFeature(m))b.geometry!==t.geometry&&t.geometry&&b.setGeometry(ja.fromJson(t.geometry.toJson())),b.attributes!==t.attributes&&t.attributes&&b.setAttributes(p.mixin(b.attributes,t.attributes)),this._repaint(b,m);t=b||t;w=t.attributes||{};z&&(w[z]=O);y&&(w[y]=x);t.setAttributes(w)}if(a){d=[];for(l=0;l<a.length;l++)if(a[l]=
new T(a[l]),!u&&(h=a[l],h.success&&(m=h.objectId,t=n._getFeature(m))))this._unSelectFeatureIIf(m,n)&&d.push(t),t._count=0,n._removeFeatureIIf(m);if(0<d.length)this.onSelectionComplete(d,M.SELECTION_SUBTRACT)}this._resolve([e,k,a],"onEditsComplete",c,g)},_sendAttachment:function(a,b,d,c,e){var g=this;return t({url:this._url.path+"/"+b+"/"+("add"===a?"addAttachment":"updateAttachment"),form:d,content:p.mixin(this._url.query,{f:"json",token:this._getToken()||void 0}),callbackParamName:"callback.html",
handleAs:"json"}).addCallback(function(d){var e="add"===a?"onAddAttachmentComplete":"onUpdateAttachmentComplete";d=new T(d["add"===a?"addAttachmentResult":"updateAttachmentResult"]);d.attachmentId=d.objectId;d.objectId=b;g._resolve([d],e,c);return d}).addErrback(function(a){g._resolve([a],null,e,null,!0)})},_repaint:function(a,b,d){b=l.isDefined(b)?b:a.attributes[this.objectIdField];b in this._selectedFeatures&&this._selectionSymbol||a.setSymbol(a.symbol,d)},_getKind:function(a){var b=this._trackManager;
return b?b.isLatestObservation(a)?1:0:0}});p.mixin(M,{MODE_SNAPSHOT:0,MODE_ONDEMAND:1,MODE_SELECTION:2,SELECTION_NEW:3,SELECTION_ADD:4,SELECTION_SUBTRACT:5,MODE_AUTO:6,MODE_STREAM:7,POPUP_NONE:"esriServerHTMLPopupTypeNone",POPUP_HTML_TEXT:"esriServerHTMLPopupTypeAsHTMLText",POPUP_URL:"esriServerHTMLPopupTypeAsURL"});aa._createWrappers(M);c("extend-esri")&&p.setObject("layers.FeatureLayer",M,a);return M})},"esri/layers/FeatureType":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../symbols/jsonUtils ./RangeDomain ./CodedValueDomain ./InheritedDomain ./FeatureTemplate".split(" "),
function(n,m,h,q,p,f,v,u,r,c,b){n=n(null,{declaredClass:"esri.layers.FeatureType",constructor:function(d){if(d&&m.isObject(d)){this.id=d.id;this.name=d.name;var e=d.symbol;e&&(this.symbol=v.fromJson(e));var e=d.domains,g,k=this.domains={};for(g in e)if(e.hasOwnProperty(g)){var a=e[g];switch(a.type){case "range":k[g]=new u(a);break;case "codedValue":k[g]=new r(a);break;case "inherited":k[g]=new c(a)}}if(g=d.templates)for(e=this.templates=[],d=0;d<g.length;d++)e.push(new b(g[d]))}},toJson:function(){var b=
{id:this.id,name:this.name,symbol:this.symbol&&this.symbol.toJson()},c,g=this.domains,k=this.templates,a=f.fixJson;if(g){var l=b.domains={};for(c in g)g.hasOwnProperty(c)&&(l[c]=g[c]&&g[c].toJson());a(l)}k&&(b.templates=h.map(k,function(a){return a.toJson()}));return a(b)}});q("extend-esri")&&m.setObject("layers.FeatureType",n,p);return n})},"esri/layers/FeatureTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../graphic".split(" "),function(n,m,h,q,p,f){n=
n(null,{declaredClass:"esri.layers.FeatureTemplate",constructor:function(h){h&&m.isObject(h)&&(this.name=h.name,this.description=h.description,this.drawingTool=h.drawingTool,this.thumbnail=h.thumbnail,h=h.prototype,this.prototype=new f(h.geometry,null,h.attributes))},toJson:function(){return p.fixJson({name:this.name,description:this.description,drawingTool:this.drawingTool,thumbnail:p.fixJson(m.clone(this.thumbnail)),prototype:this.prototype&&this.prototype.toJson()})}});m.mixin(n,{TOOL_AUTO_COMPLETE_POLYGON:"esriFeatureEditToolAutoCompletePolygon",
TOOL_CIRCLE:"esriFeatureEditToolCircle",TOOL_ELLIPSE:"esriFeatureEditToolEllipse",TOOL_FREEHAND:"esriFeatureEditToolFreehand",TOOL_LINE:"esriFeatureEditToolLine",TOOL_NONE:"esriFeatureEditToolNone",TOOL_POINT:"esriFeatureEditToolPoint",TOOL_POLYGON:"esriFeatureEditToolPolygon",TOOL_RECTANGLE:"esriFeatureEditToolRectangle",TOOL_ARROW:"esriFeatureEditToolArrow",TOOL_TRIANGLE:"esriFeatureEditToolTriangle",TOOL_LEFT_ARROW:"esriFeatureEditToolLeftArrow",TOOL_RIGHT_ARROW:"esriFeatureEditToolRightArrow",
TOOL_UP_ARROW:"esriFeatureEditToolUpArrow",TOOL_DOWN_ARROW:"esriFeatureEditToolDownArrow"});h("extend-esri")&&m.setObject("layers.FeatureTemplate",n,q);return n})},"esri/layers/FeatureEditResult":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(n,m,h,q){n=n(null,{declaredClass:"esri.layers.FeatureEditResult",constructor:function(h){h&&m.isObject(h)&&(this.objectId=h.objectId,this.globalId=h.globalId,this.success=h.success,h.success||(h=h.error,this.error=
Error(),this.error.code=h.code,this.error.message=h.description))}});h("extend-esri")&&m.setObject("layers.FeatureEditResult",n,q);return n})},"esri/layers/SnapshotMode":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../SpatialReference ../tasks/query ./RenderMode ../srUtils".split(" "),function(n,m,h,q,p,f,v,u){n=n([v],{declaredClass:"esri.layers._SnapshotMode",maxFeatures:5E4,constructor:function(f){this.featureLayer=f;this.pagination=f.queryPagination;this._featureMap=
{};this._hasPartialFeatures=!1;this._drawFeatures=m.hitch(this,this._drawFeatures);this._queryErrorHandler=m.hitch(this,this._queryErrorHandler)},startup:function(){this.pagination=this.pagination&&null!=this.featureLayer.maxRecordCount;this.featureLayer._collection?this._applyTimeFilter():this._fetchAll()},propertyChangeHandler:function(f){this._init&&(f?this.featureLayer._collection?console.log("FeatureLayer: layer created by value (from a feature collection) does not support definition expressions and time definitions. Layer id \x3d "+
this.featureLayer.id):this._fetchAll():this._applyTimeFilter())},drawFeature:function(f){var c=f.attributes[this.featureLayer.objectIdField];this._addFeatureIIf(c,f);this._incRefCount(c)},resume:function(){this.propertyChangeHandler(0)},refresh:function(){var f=this.featureLayer;f._collection?(f._fireUpdateStart(),f._refresh(!0),f._fireUpdateEnd()):this._fetchAll()},hasAllFeatures:function(){return!this._hasPartialFeatures},_getRequestId:function(f){return("_"+f.name+f.layerId+f._ulid).replace(/[^a-zA-Z0-9\_]+/g,
"_")},_fetchAll:function(){var f=this.featureLayer;f._collection||f.suspended||!f.isQueryable()||(f._fireUpdateStart(),this._clearIIf(),this._hasPartialFeatures=!1,this._sendRequest())},_sendRequest:function(h){var c=this.map,b=this.featureLayer,d=b.getDefinitionExpression(),e=new f;e.outFields=b.getOutFields();e.where=d||"1\x3d1";e.returnGeometry=!0;e.outSpatialReference=u.createSpatialReference(c.spatialReference.toJson());e.timeExtent=b.getTimeDefinition();e.maxAllowableOffset=b._maxOffset;e.quantizationParameters=
b._quantizationParameters;b._ts&&(e._ts=(new Date).getTime());e.orderByFields=b.supportsAdvancedQueries?b.getOrderByFields():null;e.multipatchOption=b.multipatchOption;this.pagination&&(this._start=e.start=null==h?0:h,e.num=b.maxRecordCount);var g;b._usePatch&&(g=this._getRequestId(b),this._cancelPendingRequest(null,g));b._task.execute(e,this._drawFeatures,this._queryErrorHandler,g)},_drawFeatures:function(f){this._purgeRequests();var c=f.features,b=this.featureLayer,d=b.objectIdField,e,g=c.length,
k=f.exceededTransferLimit&&!b._collection,a=b._selectedFeatures,l=b.mode===b.constructor.MODE_AUTO;e=c?c.length:0;var h=b.graphics.length+e,m=h>=this.maxFeatures,p,n;b._fireUpdateStart();m&&(h-=this.maxFeatures)&&c.splice(e-h,h);b._sortFeatures(c);for(e=0;e<g;e++)p=c[e],n=p.attributes[d],h=this._addFeatureIIf(n,p),this._incRefCount(n),l&&h!==p&&a[n]&&(h.setGeometry(p.geometry),h.setAttributes(p.attributes));this._applyTimeFilter(!0);this.pagination&&k&&!m||(this._hasPartialFeatures=!!f.exceededTransferLimit,
b._fireUpdateEnd(null,f.exceededTransferLimit?{queryLimitExceeded:!0}:null));k&&(this.pagination&&!m&&this._sendRequest(this._start+b.maxRecordCount),b.onQueryLimitExceeded())},_queryErrorHandler:function(f){this._purgeRequests();this._hasPartialFeatures=!0;var c=this.featureLayer;c._errorHandler(f);c._fireUpdateEnd(f)}});h("extend-esri")&&m.setObject("layers._SnapshotMode",n,q);return n})},"esri/layers/RenderMode":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/io/script ../kernel".split(" "),
function(n,m,h,q,p,f,v){m=m(null,{declaredClass:"esri.layers._RenderMode",constructor:function(){this._prefix="jsonp_"+(n._scopeName||"dojo")+"IoScript"},initialize:function(f){this.map=f;this._init=!0},startup:function(){},propertyChangeHandler:function(f){},destroy:function(){this._init=!1},drawFeature:function(f){},suspend:function(){},resume:function(){},refresh:function(){},hasAllFeatures:function(){return!0},_incRefCount:function(f){(f=this._featureMap[f])&&f._count++},_decRefCount:function(f){(f=
this._featureMap[f])&&f._count--},_getFeature:function(f){return this._featureMap[f]},_addFeatureIIf:function(f,h){var c=this._featureMap,b=c[f],d=this.featureLayer;b||(c[f]=h,d._add(h),h._count=0);return b||h},_removeFeatureIIf:function(f){var h=this._featureMap[f],c=this.featureLayer;if(h){if(h._count)return;delete this._featureMap[f];c._remove(h)}return h},_clearIIf:function(){var f;f=this.featureLayer;var h=f.graphics,c=f._selectedFeatures,b=f.getSelectedFeatures().length,d=f.objectIdField;if(b)for(f=
h.length-1;0<=f;f--){var b=h[f],e=b.attributes[d];e in c?b._count=1:(b._count=0,this._removeFeatureIIf(e))}else f.clear(),this._featureMap={}},_isPending:function(h){return f[this._prefix+h]?!0:!1},_cancelPendingRequest:function(h,m){if(h=h||f[this._prefix+m])try{h.cancel(),f._validCheck(h)}catch(c){}},_purgeRequests:function(){f._validCheck(null)},_toggleVisibility:function(f){var h=this.featureLayer,c=h.graphics,b=f?"show":"hide",d,e=c.length;f=f&&h._ager;for(d=0;d<e;d++){var g=c[d];g[b]();f&&h._repaint(g)}},
_applyTimeFilter:function(f){var h=this.featureLayer;if(h.timeInfo&&!h.suspended){f||h._fireUpdateStart();var c=h._trackManager;c&&c.clearTracks();var b=h.getTimeDefinition(),d=h._getOffsettedTE(h._mapTimeExtent);d?(d=h._getTimeOverlap(b,d))?(b=h._filterByTime(h.graphics,d.startTime,d.endTime),c&&c.addFeatures(b.match),q.forEach(b.match,function(b){var d=b._shape;b.visible||(b.show(),(d=b._shape)&&d._moveToFront());h._ager&&d&&h._repaint(b)}),q.forEach(b.noMatch,function(b){b.visible&&b.hide()})):
this._toggleVisibility(!1):(c&&c.addFeatures(h.graphics),this._toggleVisibility(!0));c&&(c.moveLatestToFront(),c.drawTracks());f||h._fireUpdateEnd()}}});p("extend-esri")&&h.setObject("layers._RenderMode",m,v);return m})},"esri/layers/OnDemandMode":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/has ../kernel ../geometry/Point ../tasks/query ./RenderMode ./GridLayout".split(" "),function(n,m,h,q,p,f,v,u,r,c){n=n([r],{declaredClass:"esri.layers._OnDemandMode",
constructor:function(b){this.featureLayer=b;this._featureMap={};this._hasPartialFeatures=!1;this._queryErrorHandler=h.hitch(this,this._queryErrorHandler)},initialize:function(b){this.inherited(arguments);var d=this.featureLayer,e=d._srInfo;this._gridLayer=new c(new v(e?e.valid[0]:b.extent.xmin,e?e.valid[1]:b.extent.ymax,b.spatialReference),{width:d._tileWidth,height:d._tileHeight},{width:b.width,height:b.height},e);this._cellMap={};this._gridLayer.setResolution(b.extent)},startup:function(){this._ioQueue=
[];this.featureLayer.suspended||(this._zoomHandler(),this._enableConnectors())},propertyChangeHandler:function(b){this._init&&(2>b?this._zoomHandler():console.log("FeatureLayer: layer in on-demand mode does not support time definitions. Layer id \x3d "+this.featureLayer.id+", Layer URL \x3d "+this.featureLayer.url))},destroy:function(){this._disableConnectors();this.inherited(arguments)},drawFeature:function(b){var d=b.geometry,c=[];if(d){var c=this._gridLayer.getCellsInExtent("point"===d.type?{xmin:d.x,
ymin:d.y,xmax:d.x,ymax:d.y}:d.getExtent(),!1).cells,d=this._cellMap,g,k,a=b.attributes[this.featureLayer.objectIdField],l,f,h;for(g=0;g<c.length;g++)k=c[g],l=k.latticeID,f=k.row,h=k.col,l?k=d[l]=d[l]||k:(d[f]=d[f]||{},k=d[f][h]=d[f][h]||k),k.features=k.features||[],k.features.push(b),this._addFeatureIIf(a,b),this._incRefCount(a)}},suspend:function(){this._init&&this._disableConnectors()},resume:function(){this._init&&(this._enableConnectors(),this._zoomHandler())},refresh:function(){this._zoomHandler()},
hasAllFeatures:function(){if(this._hasPartialFeatures)return!0;var b=!1,d=this._getCurrentCells(),c;for(c=0;c<d.length;c++)if(d[c].hasPartialFeatures){b=!0;break}return!b},_enableConnectors:function(){var b=this.map;this._zoomConnect=m.connect(b,"onZoomEnd",this,this._zoomHandler);this._panConnect=m.connect(b,"onPanEnd",this,this._panHandler);this._resizeConnect=m.connect(b,"onResize",this,this._panHandler)},_disableConnectors:function(){m.disconnect(this._zoomConnect);m.disconnect(this._panConnect);
m.disconnect(this._resizeConnect)},_zoomHandler:function(){this._processIOQueue(!0);var b=this.featureLayer,d=this.map;!b.suspended&&b.isQueryable()&&(b._fireUpdateStart(),this._clearIIf(),this._hasPartialFeatures=!1,(b=b._trackManager)&&b.clearTracks(),this._cellMap={},this._gridLayer.setResolution(d.extent),this._sendRequest())},_panHandler:function(b){if(this.featureLayer.isQueryable()){this.featureLayer._fireUpdateStart();var d=this.featureLayer._resized;b=d?b:null;d&&this._gridLayer.setMapState(b,
this.map.width,this.map.height);this._sendRequest(b)}},_getRequestId:function(b,d){return("_"+b.name+b.layerId+b._ulid+"_"+d.resolution+"_"+(d.latticeID||d.row+"_"+d.col)).replace(/[^a-zA-Z0-9\_]+/g,"_")},_sendRequest:function(b){this._exceeds=!1;var d=this.featureLayer,c=this.map;b=b||c.extent;c=this._gridLayer.getCellsInExtent(b,d.latticeTiling).cells;if(!d.isEditable())var g=this._cellMap,c=q.filter(c,function(a){if(a.lattice){if(g[a.latticeID])return!1}else if(g[a.row]&&g[a.row][a.col])return!1;
return!0});var k=d.getOutFields(),a=d.getDefinitionExpression(),l=d._getOffsettedTE(d._mapTimeExtent),f=d.supportsAdvancedQueries?d.getOrderByFields():null,h=d._usePatch,m=this._ioQueue,p,n=this,r=this._drawFeatures,v,D,H;this._pending=this._pending||0;for(p=0;p<c.length;p++){v=c[p];D=new u;D.geometry=v.extent||v.lattice;D.outFields=k;D.where=a;d.latticeTiling&&v.extent&&(D.spatialRelationship=u.SPATIAL_REL_CONTAINS);D.returnGeometry=!0;D.timeExtent=l;d._ts&&(D._ts=(new Date).getTime());D.orderByFields=
f;D.multipatchOption=d.multipatchOption;D.maxAllowableOffset=d._maxOffset;D.quantizationParameters=d._quantizationParameters;(H=d.advancedQueryCapabilities)&&H.supportsQueryWithResultType&&(D.resultType="tile");H=null;if(h&&(H=this._getRequestId(d,v),this._isPending(H)))continue;this._pending++;m.push(d._task.execute(D,function(){var a=v;return function(b){r.apply(n,[b,a])}}.call(this),this._queryErrorHandler,H))}this._removeOldCells(b);this._endCheck()},_drawFeatures:function(b,d){d.hasPartialFeatures=
!!b.exceededTransferLimit;this._exceeds=this._exceeds||b.exceededTransferLimit;this._finalizeIO();var c=this.featureLayer,g=this.map.extent,k=d.extent,a=d.row,l=d.col,f=c.objectIdField,h=b.features,m=this._gridLayer,p=this._cellMap,n=d.latticeID,q=n?p[n]:p[a]&&p[a][l];if(d.resolution==m._resolution&&(n?n===m.getLatticeID(g):m.intersects(k,g)))if(q)c._sortFeatures(h),this._updateCell(q,h);else for(c._sortFeatures(h),d.features=h,n?p[n]=d:(p[a]=p[a]||{},p[a][l]=d),g=h.length,c=0;c<g;c++)k=h[c],a=k.attributes[f],
this._addFeatureIIf(a,k),this._incRefCount(a);else q&&this._removeCell(a,l,n);this._endCheck()},_queryErrorHandler:function(b){this._finalizeIO();this._hasPartialFeatures=!0;this.featureLayer._errorHandler(b);this._endCheck(!0)},_finalizeIO:function(){this._purgeRequests();this._pending--},_endCheck:function(b){if(0===this._pending){this._processIOQueue();var d=this.featureLayer,c=d._trackManager;c&&(c.clearTracks(),c.addFeatures(d.graphics),d._ager&&q.forEach(d.graphics,function(b){b._shape&&d._repaint(b)}),
c.moveLatestToFront(),c.drawTracks());this.featureLayer._fireUpdateEnd(b&&Error("FeatureLayer: an error occurred while updating the layer"),this._exceeds?{queryLimitExceeded:!0}:null);if(this._exceeds)d.onQueryLimitExceeded()}},_processIOQueue:function(b){this._ioQueue=q.filter(this._ioQueue,function(b){return-1<b.fired?!1:!0});b&&q.forEach(this._ioQueue,this._cancelPendingRequest)},_getCurrentCells:function(b){var d=[];b=b||this._cellMap;for(var c in b)if(b.hasOwnProperty(c)){var g=b[c];g&&(g.hasOwnProperty("row")||
g.hasOwnProperty("latticeID")?d.push(g):"object"===typeof g&&d.push.apply(d,this._getCurrentCells(g)))}return d},_removeOldCells:function(b){var d=this._cellMap,c=this._gridLayer,g,k;for(g in d)if(d[g]){var a=d[g],l=a.latticeID,f=0,h=0;if(l)f++,l!==c.getLatticeID(b)&&(this._removeCell(null,null,l),h++);else for(k in a)a[k]&&(f++,c.intersects(a[k].extent,b)||(this._removeCell(g,k),h++));h===f&&delete d[g]}},_updateCell:function(b,d){var c=this.featureLayer,g=c.objectIdField,c=c._selectedFeatures,k,
a=d.length;b.features=b.features||[];for(k=0;k<a;k++){var l=d[k],f=l.attributes[g],h=this._addFeatureIIf(f,l);h===l?(this._incRefCount(f),b.features.push(h)):f in c||(h.setGeometry(l.geometry),h.setAttributes(l.attributes))}},_removeCell:function(b,d,c){var e=this._cellMap,k=this.featureLayer,a=k.objectIdField,l=c?e[c]:e[b]&&e[b][d];if(l)for(c?delete e[c]:delete e[b][d],b=l.features,d=0;d<b.length;d++)c=b[d].attributes[a],this._decRefCount(c),c in k._selectedFeatures||this._removeFeatureIIf(c)}});
p("extend-esri")&&h.setObject("layers._OnDemandMode",n,f);return n})},"esri/layers/GridLayout":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../SpatialReference ../geometry/Extent ../geometry/Polyline ../srUtils".split(" "),function(n,m,h,q,p,f,v,u,r){n=n(null,{declaredClass:"esri.layers._GridLayout",constructor:function(c,b,d,e){this.origin=c;this.cellWidth=b.width;this.cellHeight=b.height;this.mapWidth=d.width;this.mapHeight=d.height;this.srInfo=e},setResolution:function(c){this._resolution=
(c.xmax-c.xmin)/this.mapWidth;this.srInfo&&(c=Math.round(Math.round(2*this.srInfo.valid[1]/this._resolution)/this.cellWidth),this._frameStats=[c,0,c-1])},setMapState:function(c,b,d){this.mapWidth=b;this.mapHeight=d;this.setResolution(c)},getCellCoordinates:function(c){var b=this._resolution,d=this.origin;return{row:Math.floor((d.y-c.y)/(this.cellHeight*b)),col:Math.floor((c.x-d.x)/(this.cellWidth*b))}},normalize:function(c){var b=this._frameStats;if(b){var d=b[0],e=b[1],b=b[2];c<e?(c%=d,c=c<e?c+d:
c):c>b&&(c%=d)}return c},intersects:function(c,b){var d=this.srInfo;return d?h.some(b._getParts(d),function(b){return c.intersects(b.extent)}):c.intersects(b)},getCellExtent:function(c,b){var d=this._resolution,e=this.origin,g=this.cellWidth,k=this.cellHeight;return new v(b*g*d+e.x,e.y-(c+1)*k*d,(b+1)*g*d+e.x,e.y-c*k*d,r.createSpatialReference(e.spatialReference.toJson()))},getLatticeID:function(c){var b=this.getCellCoordinates({x:c.xmin,y:c.ymax}),d=this.getCellCoordinates({x:c.xmax,y:c.ymin});c=
b.row;var e=d.row,b=this.normalize(b.col),d=this.normalize(d.col);return c+"_"+e+"_"+b+"_"+d},sorter:function(c,b){return c<b?-1:1},getCellsInExtent:function(c,b){var d=this.getCellCoordinates({x:c.xmin,y:c.ymax}),e=this.getCellCoordinates({x:c.xmax,y:c.ymin}),g=d.row,k=e.row,d=d.col,e=e.col,a=[],l,f,m,p=[],n=[],q,r,v,D,H=[];for(l=g;l<=k;l++)for(f=d;f<=e;f++)m=this.normalize(f),c=this.getCellExtent(l,m),h.some(a,function(a){return a.row===l&&a.col===m})||a.push({row:l,col:m,extent:c,resolution:this._resolution}),
b&&(p.push(c.xmin,c.xmax),n.push(c.ymin,c.ymax));d=this.normalize(d);e=this.normalize(e);p.sort(this.sorter);n.sort(this.sorter);f=p.length;for(l=f-1;0<=l;l--)l<f-1&&p[l]===p[l+1]&&p.splice(l,1);f=n.length;for(l=f-1;0<=l;l--)l<f-1&&n[l]===n[l+1]&&n.splice(l,1);if(p.length&&n.length){q=p[0];r=p[p.length-1];v=n[0];D=n[n.length-1];f=p.length;for(l=0;l<f;l++)H.push([[p[l],D],[p[l],v]]);f=n.length;for(l=0;l<f;l++)H.push([[q,n[l]],[r,n[l]]]);p=new u({paths:H,spatialReference:this.origin.spatialReference.toJson()});
a.push({latticeID:g+"_"+k+"_"+d+"_"+e,lattice:p,resolution:this._resolution})}return{minRow:g,maxRow:k,minCol:d,maxCol:e,cells:a}}});q("extend-esri")&&m.setObject("layers._GridLayout",n,p);return n})},"esri/layers/SelectionMode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./RenderMode"],function(n,m,h,q,p){n=n([p],{declaredClass:"esri.layers._SelectionMode",constructor:function(f){this.featureLayer=f;this._featureMap={}},propertyChangeHandler:function(f){this._init&&
0===f&&this._applyTimeFilter()},resume:function(){this.propertyChangeHandler(0)},hasAllFeatures:function(){return!this.featureLayer._hasPartialSelectedFeatures}});h("extend-esri")&&m.setObject("layers._SelectionMode",n,q);return n})},"esri/layers/StreamMode":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../SpatialReference ../tasks/query ../tasks/QueryTask ../geometry/jsonUtils ./RenderMode".split(" "),function(n,m,h,q,p,f,v,u,r,c){n=n([c],{declaredClass:"esri.layers._StreamMode",
constructor:function(b,d){this.featureLayer=b;this._featureMap={};this._setRefreshRate();this._drawBuffer={adds:[],updates:[]};this._timeoutId=null;this._flushDrawBuffer=m.hitch(this,this._flushDrawBuffer);this._featuresByTime={};this._lastEndTimeCheck=null;this._maxFeatureAge=0;b.purgeOptions&&b.purgeOptions.age&&"number"===typeof b.purgeOptions.age&&(this._maxFeatureAge=1E3*Math.ceil(60*b.purgeOptions.age));this._drawFeatures=m.hitch(this,this._drawFeatures);this._queryErrorHandler=m.hitch(this,
this._queryErrorHandler)},startup:function(){},propertyChangeHandler:function(b){this._init&&(0===b?this._applyTimeFilter():3===b?this._redrawAllTracks():console.debug("StreamLayer: Stream Layer only supports changing map time or maximumTrackPoints. Layer id \x3d "+this.featureLayer.id))},destroy:function(){this.inherited(arguments);clearTimeout(this._timeoutId);this._featuresByTime=this._drawBuffer=this._featureMap=null},drawFeature:function(b){var d=this.featureLayer,c=d.objectIdField;this._timeoutId||
(this._timeoutId=setTimeout(this._flushDrawBuffer,this._refreshRate));d._joinField&&this._getFeature(b.attributes[c])?this._drawBuffer.updates.push({oid:b.attributes[c],updates:b}):this._drawBuffer.adds.push(b)},resume:function(){this.propertyChangeHandler(0)},refresh:function(){var b=this.featureLayer;b&&(b._relatedUrl||b._keepLatestUrl?(b._fireUpdateStart(),b._refreshing=!0,b.disconnect(),b.clear(),b._relatedQueried=!1,b._keepLatestQueried=!1,b.connect()):(b._fireUpdateStart(),b.clear(),b._fireUpdateEnd()))},
_drawFeatures:function(b,d){this._purgeRequests();var c=this.featureLayer;c._create(b.features||[]);c._fireUpdateEnd(null,d)},_applyTimeFilter:function(b){this.inherited(arguments);this._redrawAllTracks()},_removeFeatures:function(b){var d=this.featureLayer,c=d.objectIdField;b&&h.forEach(b,function(b){b=b.attributes[c];d._unSelectFeatureIIf(b,this);this._decRefCount(b);this._removeFeatureIIf(b)},this)},_addFeatures:function(b){var d=this.featureLayer,c=d._endTimeField,g=d._startTimeField,k,a,l,f=
[],m=[],p=[];k=d._trackManager;a=d.objectIdField;if(k)for(l in b=k.addFeatures(b),b)b.hasOwnProperty(l)&&(f.push(l),b[l].adds&&(m=m.concat(b[l].adds)),b[l].deletes&&(p=p.concat(b[l].deletes)));else m=b;h.forEach(m,function(b){var d=b.attributes[a],e;e=c&&b.attributes[c];!e&&this._maxFeatureAge&&(e=g&&b.attributes[g]?b.attributes[g]+this._maxFeatureAge:Date.now()+this._maxFeatureAge);e&&(e=1E3*Math.ceil(e/1E3),this._featuresByTime[e]?this._featuresByTime[e].push(d):this._featuresByTime[e]=[d]);this._addFeatureIIf(d,
b);this._incRefCount(d)},this);p.length&&this._removeFeatures(p);k&&k.refreshTracks(f)},_updateFeatures:function(b){var d=this.featureLayer,c,g,k=[];c=d._trackManager;g=d._trackIdField;h.forEach(b,function(a){var b=a.updates;a=this._getFeature(a.oid);var e;if(a){b.geometry&&a.setGeometry(b.geometry);b=b.attributes||{};for(e in b)b.hasOwnProperty(e)&&(a.attributes[e]=b[e]);a.setAttributes(a.attributes);a.visible=this._checkFeatureTimeIntersects(a);c&&a.attributes[g]?k.push(a.attributes[g]):d._repaint(a,
null,!0)}},this);k.length&&c.refreshTracks(k)},_redrawAllTracks:function(){var b=this.featureLayer._trackManager,d;b&&(d=b.trimTracks())&&0<d.length&&(this._removeFeatures(d),b.refreshTracks())},_flushDrawBuffer:function(){clearTimeout(this._timeoutId);var b=this._drawBuffer,d=b.adds.splice(0,b.adds.length),c=b.updates.splice(0,b.updates.length),b=this.featureLayer;if(!b)return!1;b.updating||b._fireUpdateStart();this._addFeatures(d);this._updateFeatures(c);(d=this._getExpiredFeatures())&&d.length&&
(this._removeFeatures(d),b._trackManager&&b._trackManager.removeFeatures(d));b._purge();b._fireUpdateEnd();this._timeoutId=null},_clearDrawBuffer:function(){var b=this._timeoutId,d=this._drawBuffer,c=d.adds,d=d.updates;b&&clearTimeout(b);c.splice(0,c.length);d.splice(0,d.length);this._timeoutId=null},_clearTimeBin:function(){this._featuresByTime={};this._lastEndTimeCheck=1E3*Math.ceil(Date.now()/1E3)},_clearFeatureMap:function(){this._featureMap={}},_setRefreshRate:function(b){b=b||0===b?b:200;0>
b&&(b=200);this._refreshRate=b},_checkFeatureTimeIntersects:function(b){var d=this.featureLayer,c=d.getMap();return(c=c?c.timeExtent:null)&&d.timeInfo&&(d.timeInfo.startTimeField||d.timeInfo.endTimeField)?0<d._filterByTime([b],c.startTime,c.endTime).match.length:!0},_getRequestId:function(b){return("_"+b.name+b.layerId+b._ulid).replace(/[^a-zA-Z0-9\_]+/g,"_")},_fetchArchive:function(b){function d(b){p++;k.execute(a).then(function(a){b(null,a)},function(a){b(a)})}function c(b,e){if(b)p>=n||!g._relatedUrl?
q._queryErrorHandler(Error("Could not get features from related feature service")):(x={relatedFeatureWarning:"Querying related feature service using the current filter failed. All related features are displayed, and the filter is applied to the stream service only"},a.where="1\x3d1",d(c));else{var k=q._fixFieldNameCasing(g,e);e.features=k;q._drawFeatures(e,x)}}var g=this.featureLayer,k,a,l,h,m;g._fireUpdateStart();if(b&&this.map){k=new u(b);a=new v;b=this.map;l=g.getFilter()||{};h=l.where||"1\x3d1";
m=l.geometry?r.fromJson(l.geometry):null;l=l.outFields?l.outFields.split(","):["*"];a.geometry=m;a.where=h;a.outFields=l;a.returnGeometry=!0;a.outSpatialReference=new f(b.spatialReference.toJson());g._usePatch&&(b=this._getRequestId(g),this._cancelPendingRequest(null,b));var p=0,n=2,q=this,x=null;d(c)}else return this._fireUpdateEnd({error:"Archive data cannot be fetched if no feature service url is provided or if the layer is not added to a map"}),!1},_queryErrorHandler:function(b){this._purgeRequests();
var d=this.featureLayer;d._errorHandler(b);d._fireUpdateEnd(b)},_fixFieldNameCasing:function(b,d){var c=d.features||[],g=d.fields;if(!g||!c.length)return c;for(var g=this._mapFieldNameDifferences(b.fields,g),k=[],a,l,f=0,h=d.features.length;f<h;f++)a=c[f],l=this._swizzleResponseAttributes(a.attributes,g),k.push({geometry:a.geometry,attributes:l});return k},_mapFieldNameDifferences:function(b,d){var c=[],g={},k,a;k=0;for(a=d.length;k<a;k++)c.push(d[k].name);k=0;for(a=b.length;k<a;k++){var f=b[k].name,
h=this._checkForStreamFieldName(f,c);h&&(g[h]=f)}return g},_checkForStreamFieldName:function(b,d){for(var c=b.toLowerCase(),g,k=0,a=d.length;k<a;k++)if(d[k].toLowerCase()===c){g=d[k];break}return g},_swizzleResponseAttributes:function(b,d){var c={},g;for(g in b)if(b.hasOwnProperty(g)){var k=b[g];d.hasOwnProperty(g)?c[d[g]]=k:c[g]=k}return c},_getExpiredFeatures:function(){var b,d,c,g=[],k=[];if(!this.featureLayer._endTimeField&&!this._maxFeatureAge)return k;b=1E3*Math.floor(this._lastEndTimeCheck/
1E3);this._lastEndTimeCheck=d=1E3*Math.ceil(Date.now()/1E3);if(b&&b!==d)for(c=this._featuresByTime;b<=d;b+=1E3)c[b]&&(g=g.concat(c[b]),delete c[b]);h.forEach(g,function(a){(a=this._getFeature(a))&&k.push(a)},this);return k}});q("extend-esri")&&m.setObject("layers._StreamMode",n,p);return n})},"esri/layers/TrackManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/dom-construct dojox/gfx ../kernel ../graphic ../geometry/Polyline ./GraphicsLayer".split(" "),function(n,
m,h,q,p,f,v,u,r,c){var b=-1!==f.renderer.toLowerCase().indexOf("canvas");n=n(null,{declaredClass:"esri.layers._TrackManager",constructor:function(b){this.layer=b;this.trackMap={};this.trackLineMap={}},initialize:function(d){this.map=d;var e=this.layer,g=e._getRenderer(),g=g&&g.trackRenderer;if("esriGeometryPoint"===e.geometryType){var k=this.container=new c._GraphicsLayer({id:e.id+"_tracks",_child:!0,visible:e.visible,minScale:e.minScale,maxScale:e.maxScale});k.loaded=!0;k.onLoad(k);k._setMap(d,e._div);
if(!b){d=k._div.getNode();var a=e._div.getNode();d&&a&&p.place(d,a,"first")}k.setRenderer(g);e.on("visibility-change",m.hitch(this,function(a){this.container.setVisibility(a.visible);this.container.evaluateSuspension()}));e.on("scale-range-change",m.hitch(this,function(){this.container.setScaleRange(this.layer.minScale,this.layer.maxScale)}))}},addFeatures:function(b){var d=this.trackMap,c=this.layer,k=c._trackIdField,a=[];h.forEach(b,function(b){var c=b.attributes[k];(d[c]=d[c]||[]).push(b);-1===
h.indexOf(a,c)&&a.push(c)});var f=c._startTimeField,m=c.objectIdField,p=function(a,b){var d=a.attributes[f],c=b.attributes[f];return d===c?a.attributes[m]<b.attributes[m]?-1:1:d<c?-1:1};h.forEach(a,function(a){d[a].sort(p)})},trimTracks:function(b){function d(b){for(b=c[b]||[];b.length>k;)a.push(b.shift())}var c=this.trackMap,k=this.layer.maximumTrackPoints||0,a=[],f;if(!k)return a;if(b)h.forEach(b,function(a){d(a)});else for(f in c)c.hasOwnProperty(f)&&d(f);return a},drawTracks:function(b){function d(b){var d=
a[b],e,g,l;g=c.trackLineMap[b];k.remove(g);delete c.trackLineMap[b];g=null;if(!d||2>d.length)return!1;g=[];for(e=d.length-1;0<=e;e--)(l=d[e].geometry)&&g.push([l.x,l.y]);d={};d[m]=b;1<g.length&&(g=new u(new r({paths:[g],spatialReference:f}),null,d),k.add(g),c.trackLineMap[b]=g)}var c=this,k=this.container,a,f,m,p;if(k)if(a=this.trackMap,f=this.map.spatialReference,m=this.layer._trackIdField,b)h.forEach(b,function(a){d(a)});else for(p in a)a.hasOwnProperty(p)&&d(p)},refreshTracks:function(b){function d(b){var d,
e;c.drawTracks([b]);if(f&&f.latestObservationRenderer)for(b=k[b]||[],d=b.length,e=0;e<d;e++)a._repaint(b[e],null,!0)}var c=this,k=this.trackMap,a=this.layer,f=a._getRenderer(),m;if(b)h.forEach(b,function(a){d(a)});else for(m in k)k.hasOwnProperty(m)&&d(m);this.moveLatestToFront()},moveLatestToFront:function(b){h.forEach(this.getLatestObservations(b),function(b){var d=b._shape;d&&d._moveToFront();this._repaint(b,null,!0)},this.layer)},getLatestObservations:function(b){function d(b){b=a[b];return b[b.length-
1]}var c=[],k=this.layer._getRenderer(),a=this.trackMap,f;if(!k.latestObservationRenderer)return c;if(b)h.forEach(b,function(a){c.push(d(a))});else for(f in a)a.hasOwnProperty(f)&&c.push(d(f));return c},clearTracks:function(b){var d=this.getLatestObservations(b),c=this.container,k;b?h.forEach(b,function(a){delete this.trackMap[a];c&&(k=this.trackLineMap[a],c.remove(k),delete this.trackLineMap[a])},this):(this.trackMap={},this.trackLineMap={},c&&c.clear());h.forEach(d,function(a){this._repaint(a,null,
!0)},this.layer)},isLatestObservation:function(b){var d=this.trackMap[b.attributes[this.layer._trackIdField]];return d?d[d.length-1]===b:!1},destroy:function(){var b=this.container;b&&(b.clear(),b._unsetMap(this.map,this.layer._div));this.map=this.layer=this.trackMap=this.container=null}});q("extend-esri")&&m.setObject("layers._TrackManager",n,v);return n})},"esri/layers/HeatmapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/_base/array require ../kernel ../sniff ../geometry/Point ../geometry/webMercatorUtils ./MapImage ../renderers/HeatmapRenderer ../tasks/query dojo/_base/fx".split(" "),
function(n,m,h,q,p,f,v,u,r,c,b,d,e){function g(){}function k(a){var b=a.layer;return{geometry:a.geometry,attributes:a.attributes,getLayer:function(){return b}}}n=n(null,{declaredClass:"esri.layers.HeatmapManager",heatmapRenderer:null,sourceLayer:null,imageLayer:null,useTiles:!0,useWorker:!1,map:null,constructor:function(a){this.sourceLayer=a;this._hndls=[]},initialize:function(a){this.map=a;var d=this.sourceLayer,c=d.renderer;d.setDrawMode(!1);this.imageLayer=a._getMapImageLyr();var e=this;this.heatmapRenderer=
c instanceof b?c:(c.getRendererInfoByZoom(a.getZoom())||c.getRendererInfoByScale(a.getScale())).renderer;this._setupDraw=this._setupDraw.bind(this);this.recalculateHeatmap=this.recalculateHeatmap.bind(this);this._removeRenderer=this._removeRenderer.bind(this);this._handleRendererChange=this._handleRendererChange.bind(this);this._rendererChangeHandle=this.sourceLayer.on("renderer-change",this._handleRendererChange);this._handleOpacityChange=this._handleOpacityChange.bind(this);this._reprojectFeature=
this._reprojectFeature.bind(this);p(["../workers/heatmapCalculator"],function(a){e._calculator=new a(m.mixin({width:e.map.width,height:e.map.height},e._getOptions()));e._setupRenderer();e.heatmapRenderer.getStats=a.calculateStats;e.heatmapRenderer.getHistogramData=a.getHistogramData})},destroy:function(){this._removeHandlers();this._rendererChangeHandle&&this._rendererChangeHandle.remove();this._rendererChangeHandle=this.sourceLayer=this.imageLayer=this.map=this.heatmapRenderer=this._hndls=null},
_handleRendererChange:function(a){var d=a.renderer,c=d instanceof b;this.heatmapRenderer?c?this.heatmapRenderer=d:this._removeRenderer(a):c&&(this.heatmapRenderer=d,this.sourceLayer&&this.map&&this._setupRenderer())},_handleOpacityChange:function(a){a=a.opacity;var b=this._getImageBySourceId(this.sourceLayer.id);b&&b.setOpacity(a)},_setupRenderer:function(){var a=this._hndls,b=this.sourceLayer,d=this.map,c=this;b._originalDraw=b._draw;b._draw=g;b._div.clear();clearTimeout(this._resetTimer);this._resetTimer=
setTimeout(this._resetGraphics.bind(this),250);a.push(b.on("update-end",this._setupDraw));a.push(b.on("suspend",function(a){(a=c._getImageBySourceId(c.sourceLayer.id))&&a.hide()}));a.push(b.on("resume",function(a){(a=c._getImageBySourceId(c.sourceLayer.id))&&a.show()}));a.push(h.after(b,"redraw",this._setupDraw));a.push(d.on("layer-remove",function(a){a.layer==b&&((a=c._getImageBySourceId(c.sourceLayer.id))&&c.imageLayer.removeImage(a),c._removeRenderer({target:b}))}));b._collection&&a.push(b.on("graphic-add",
function(a){c._reprojectFeature(a.graphic);c._setupDraw()}));1!==b.mode&&(a.push(d.on("resize, pan-end",this._setupDraw)),a.push(d.on("zoom-end",this._setupDraw)));a.push(b.on("opacity-change",this._handleOpacityChange));this.imageLayer.suspended&&this.imageLayer.resume();b.graphics&&b.graphics.length&&(b.graphics[0].geometry&&!d.spatialReference.equals(b.graphics[0].geometry.spatialReference)&&q.forEach(b.graphics,function(a){this._reprojectFeature(a)}.bind(this)),this._setupDraw())},_setupDraw:function(){if(!this._drawTimer){var a=
this;this._drawTimer=setTimeout(function(){clearTimeout(a._drawTimer);a._drawTimer=null;a.sourceLayer._getRenderer().isInstanceOf(b)&&a.recalculateHeatmap()},16)}},_removeRenderer:function(a){var b=a.target;b._draw=b._originalDraw;delete b._originalDraw;b.setDrawMode(!0);this._removeHandlers();this._hndls=[];var d=this._getImageBySourceId(this.sourceLayer.id);d&&this.imageLayer.removeImage(d);clearTimeout(this._drawTimer);clearTimeout(this._resetTimer);this._drawTimer=this._resetTimer=null;b.renderer!=
a.renderer&&b.renderer.getRendererInfo?this.heatmapRenderer=null:(b.redraw(),this.destroy())},recalculateHeatmap:function(){this._calculator?this._doMainCalculation():this._calculatorClient&&this._doWorkerCalculation()},_reprojectFeature:function(a){if(a&&a.geometry){var b=a.geometry,d=this.map.spatialReference;d.equals(b.spatialReference)||(b=r.project(b,d),null==b?console.log("Unable to reproject features to map's spatial reference. Please convert feature geometry before adding to layer"):a.geometry=
b)}},_doWorkerCalculation:function(){},_doMainCalculation:function(){var a=this.sourceLayer,b=this.map,e=this.heatmapRenderer,g=this.map.extent,f=this.map.width,h=this.map.height,p=this._calculator,n=this,q=function(d){d=n._getScreenPoints(d.features,b,a);d=p.calculateImageData(m.mixin({screenPoints:d,mapinfo:{extent:[g.xmin,g.ymin,g.xmax,g.ymax],resolution:b.getResolution()},width:f,height:h},n._getOptions()));d=e.getSymbol(k({geometry:b.extent,attributes:{size:[f,h],imageData:d},layer:a}));d=new c({extent:b.extent,
href:d.url,opacity:0,sourceId:a.id});n._swapMapImages(d,n._getImageBySourceId(a.id));a.suspended&&d.hide()},r={geometry:b.extent,timeExtent:a.useMapTime?b.timeExtent:void 0,spatialRelationship:d.SPATIAL_REL_INTERSECTS};null!=a._canDoClientSideQuery(r)?a.queryFeatures(r,q):q({features:a.graphics})},_getScreenPoints:function(a,b,d){var c=[],e=a.length,g=0,f=0,k,h=new u(b.extent.xmin,b.extent.ymax,b.spatialReference),l=b.toScreen(h),m=l.x,l=l.y,p=b.getResolution(),n;for((f=b.extent.getCacheValue("_parts"))&&
(n=q.map(f,function(a){return d._intersects(b,a.extent)[0]}));e--;)f=a[e],f.geometry&&(k={x:Math.ceil((f.geometry.x-h.x)/p+m),y:Math.floor((h.y-f.geometry.y)/p-l),attributes:f.attributes},n&&(f=1<n.length&&k.x<-n[0]?n[1]:n[0],k.x+=f),c[g++]=k);return c},_getImageBySourceId:function(a){var b=this.imageLayer.getImages(),b=q.filter(b,function(b){return b.sourceId==a});if(b.length)return b[b.length-1]},_swapMapImages:function(a,b){function d(){c.removeImage(b)}var c=this.imageLayer,g=this.sourceLayer.opacity;
c.addImage(a);e.anim(a._node,{opacity:g},null,null,function(){a.opacity=g});null!=b&&e.anim(b._node,{opacity:0},null,null,d)},_removeHandlers:function(){if(null!=this._hndls)for(var a=this._hndls.length;a--;)this._hndls[a].remove()},_getOptions:function(){var a=this.heatmapRenderer;return{blurRadius:a.blurRadius,gradient:a.gradient,maxPixelIntensity:a.maxPixelIntensity,minPixelIntensity:a.minPixelIntensity,field:a.field,fieldOffset:a.fieldOffset}},_resetGraphics:function(){clearTimeout(this._resetTimer);
this._resetTimer=null;for(var a=this.sourceLayer.graphics,b=a.length,d;b--;)d=a[b],d._shape=d._offsets=void 0}});v("extend-esri")&&m.setObject("layers.HeatmapManager",n,f);return n})},"esri/layers/clustering/ClusterManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../../kernel ../../Evented ../../graphic ../../dijit/PopupTemplate ../../dijit/Legend/utils ../../renderers/SimpleRenderer ../../symbols/SimpleMarkerSymbol ../GraphicsLayer ./GeohashAggregation".split(" "),
function(n,m,h,q,p,f,v,u,r,c,b,d,e){n=n(f,{declaredClass:"esri.layers.clustering.ClusterManager",layer:null,aggregationInfo:null,container:null,defaults:{clusterSize:80,markerSymbol:{color:[77,77,77,255],size:6,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[255,255,255,255],width:.75,type:"esriSLS",style:"esriSLSSolid"}}},_map:null,_eventHandles:null,_clusterSize:null,_renderer:null,_statisticInfos:null,_infoTemplate:null,_clusterGenerator:null,constructor:function(b){this._eventHandles=
[];this.layer=b.layer;this.setAggregationInfo(b.aggregationInfo)},initialize:function(b){this._map=b;this.container=this._createContainer();this._clusterGenerator=this._createClusterGenerator();this._initClusterGenerator();this._createLayerEventListeners();this._createMapEventListeners()},destroy:function(){this._destroyEventListeners();this._destroyClusterGenerator();this._destroyContainer();this.layer=this.aggregationInfo=this._map=null},setAggregationInfo:function(b){this.aggregationInfo=b;this._applyAggregationInfo()},
getClusterRenderer:function(){return this._renderer},redraw:function(){this.container&&this.container.redraw()},isClusteringEnabled:function(){return this._clusterGenerator&&this._clusterGenerator.clustersEnabled},_createContainer:function(){var b=this.layer,c=new d._GraphicsLayer({_child:!0,id:b.id+"_clusters",visible:b.visible,minScale:b.minScale,maxScale:b.maxScale,infoTemplate:this._infoTemplate});c.setRenderer(this._renderer);c.loaded=!0;c.onLoad(c);c._setMap(this._map,b._div);return b._childLayer=
c},_destroyContainer:function(){var b=this.container;b&&(b.clear(),b._unsetMap(this._map,this.layer._div),this.layer._childLayer=null);this.container=null},_createClusterGenerator:function(){return new e({map:this._map,layer:this.layer,clusterSize:this._clusterSize,statisticInfos:this._statisticInfos})},_initClusterGenerator:function(){var b=this._clusterGenerator;b.loaded?(this._applyRenderer(),this._initClusterUpdates()):this._eventHandles.push(b.on("load",m.hitch(this,function(){this._applyRenderer();
this._initClusterUpdates()})),b.on("load-error",m.hitch(this,function(b){console.log(b.error)})));this._eventHandles.push(b.on("mode-change",m.hitch(this,function(){this.emit("mode-change")})))},_destroyClusterGenerator:function(){this._clusterGenerator&&this._clusterGenerator.destroy();this._clusterGenerator=null},_applyAggregationInfo:function(){this._applyClusterSize();this._applyRenderer();this._clusterGenerator&&!this._clusterGenerator.isUpdateScheduled()&&this.redraw()},_applyClusterSize:function(){var b=
this.aggregationInfo;this._clusterSize=b&&b.clusterSize||this.defaults.clusterSize;this._clusterGenerator&&this._clusterGenerator.setClusterSize(this._clusterSize)},_applyRenderer:function(){this._renderer=this._getRenderer(this.aggregationInfo,"avg");this._statisticInfos=this._createStatisticInfos(this._renderer,"avg");this._clusterGenerator&&this._clusterGenerator.setStatisticInfos(this._statisticInfos);this.container&&(this.container.setRenderer(this._renderer),this.emit("renderer-change"),h.forEach(this.container.graphics,
function(b){b.setAttributes(b._cluster.attributes)}));this._applyInfoTemplate()},_applyInfoTemplate:function(){this._infoTemplate=this._getInfoTemplate(this.aggregationInfo,this._statisticInfos);this.container&&this.container.setInfoTemplate(this._infoTemplate)},_getRenderer:function(b,d){var a=b&&b.renderer;a||(a=(a=this.layer&&this.layer.renderer)?this._createClusterRenderer(a,d):this._getDefaultClusterRenderer());return a},_getDefaultClusterRenderer:function(){var d=new c(new b(this.defaults.markerSymbol));
this._addSizeByCountVariable(d);return d},_createClusterRenderer:function(b,d){if(!this._isSupportedRenderer(b))return this._getDefaultClusterRenderer();var a=new b.constructor(b.toJson()),c=d+"_";a.attributeField=c+a.attributeField;a.normalizationField&&(a.normalizationField=c+a.normalizationField);a.setVisualVariables(null);var c=this._getSupportedVariables(b),e=this._createClusterVariables(c.allVars,d);a.setVisualVariables(e);c.sizeVars.length||this._addSizeByCountVariable(a);return a},_isSupportedRenderer:function(b){var d=
b.declaredClass.toLowerCase();return-1<d.indexOf("simplerenderer")?!0:-1<d.indexOf("classbreaksrenderer")?b.valueExpression?!1:b.isContinuousRenderer():!1},_getSupportedVariables:function(b){var d=b.getVisualVariablesForType("colorInfo",!1)||[],a=b.getVisualVariablesForType("sizeInfo",!1)||[];b=b.getVisualVariablesForType("opacityInfo",!1)||[];d=h.filter(d,this._variableFilter);a=h.filter(a,this._variableFilter);b=h.filter(b,this._variableFilter);return{colorVars:d,sizeVars:a,opacityVars:b,allVars:d.concat(a).concat(b)}},
_variableFilter:function(b){return"string"===typeof b.field},_createClusterVariables:function(b,d){return h.map(b,function(a){return this._createVarForAvg(a,d)},this)},_createVarForAvg:function(b,d){var a=m.clone(b),c=d+"_";a.field=c+a.field;a.normalizationField&&(a.normalizationField=c+a.normalizationField);this._setVariableTitle(a,b);return a},_setVariableTitle:function(b,d){b.legendOptions&&b.legendOptions.title||(b.legendOptions=b.legendOptions||{},b.legendOptions.title=r.getVisualVariableTitle(d,
this.layer))},_createStatisticInfos:function(b,d){if(-1!==b.declaredClass.toLowerCase().indexOf("classbreaksrenderer")){var a=[b.attributeField,b.normalizationField];h.forEach(b.visualVariables,function(b){"count"!==b.field&&(a.push(b.field),a.push(b.normalizationField))});a=h.filter(a,function(a){return!!a});a.sort();var a=h.filter(a,function(b,d){return 0===d||a[d-1]!==b}),c=d+"_";return h.map(a,function(a){return{field:a.replace(c,""),type:d}})}},_addSizeByCountVariable:function(b){var d=this._createSizeByCountVariable();
d&&this._addVariable(b,d)},_getSizeByCountVariable:function(b){b=b.getVisualVariablesForType("sizeInfo",!1)||[];return h.filter(b,function(b){return"count"===b.field})[0]},_updateSizeByCountVariable:function(){var b=this._renderer,d=this._getSizeByCountVariable(b);if(d){var a=this._createSizeByCountVariable();a&&this._replaceVariable(b,d,a)}else this._addSizeByCountVariable(b)},_createSizeByCountVariable:function(){var b=this._clusterGenerator,d;b&&(b=b.getCurrentLodStats(),d={type:"sizeInfo",field:"count",
valueUnit:"unknown",minSize:8,maxSize:50,minDataValue:b.min,maxDataValue:b.max,legendOptions:{title:"Number of features"}});return d},_addVariable:function(b,d){var a=b.visualVariables||[];a.push(d);b.setVisualVariables(a)},_replaceVariable:function(b,d,a){var c=b.visualVariables;d=h.indexOf(c,d);-1<d&&c.splice(d,1);c.push(a);b.setVisualVariables(c)},_getInfoTemplate:function(b,d){var a=b&&b.infoTemplate;if(!a){var c=this.layer,e=[{fieldName:"count",visible:!0,label:"Number of features",format:{digitSeparator:!0,
places:0}}],g=[];h.forEach(d,function(a){var b=a.type+"_"+a.field;e.push({fieldName:b,visible:!0,label:"Average "+c.getFieldLabel(a.field),format:{digitSeparator:!0,places:1}});g.push("Average \x3cb\x3e"+c.getFieldLabel(a.field)+"\x3c/b\x3e within this cluster is \x3cb\x3e{"+b+"}\x3c/b\x3e.\x3cbr\x3e")});a=g.length?"\x3cbr\x3e"+g.join(""):"";a=new u({fieldInfos:e,description:"This cluster represents \x3cb\x3e{count}\x3c/b\x3e features.\x3cbr\x3e"+a})}return a},_removeFromPopup:function(b){var d=this._map.infoWindow,
a=d.features,c=[];h.forEach(a,function(a,d){a.getLayer()===b&&c.push(d)});c.length&&(c.sort(function(a,b){return b-a}),a=a.slice(0),h.forEach(c,function(b){a.splice(b,1)}),d.setFeatures(a),a.length||d.hide())},_initClusterUpdates:function(){this._updateClusters(!0,!1);this._eventHandles.push(this._clusterGenerator.on("update-end",m.hitch(this,function(b){this._updateClusters(b.levelChange,b.modeChange)})))},_updateClusters:function(b,d){this.isClusteringEnabled()&&d&&this._removeFromPopup(this.layer);
var a=h.map(this._clusterGenerator.clusters,function(a){var b=new v(a.centroid,null,a.attributes);b._cluster=a;return b});this._addGraphics(a,b)},_addGraphics:function(b,d){var a=this.container;a.clear();var c=this.aggregationInfo&&this.aggregationInfo.renderer;d&&this.isClusteringEnabled()&&this._renderer!==c&&(this._updateSizeByCountVariable(),this.emit("renderer-change"));h.forEach(b,function(b){a.add(b)})},_createLayerEventListeners:function(){var b=this.layer;this._eventHandles.push(b.on("visibility-change",
m.hitch(this,function(b){this.container.setVisibility(b.visible);this.container.evaluateSuspension()})),b.on("scale-range-change",m.hitch(this,function(){this.container.setScaleRange(this.layer.minScale,this.layer.maxScale)})),b.on("renderer-change",m.hitch(this,function(){this._applyRenderer()})))},_createMapEventListeners:function(){this._eventHandles.push(this._map.on("zoom-start",m.hitch(this,function(b){this.isClusteringEnabled()&&this._removeFromPopup(this.container);this.container.clear()})))},
_destroyEventListeners:function(){h.forEach(this._eventHandles,function(b){b.remove()})}});q("extend-esri")&&m.setObject("layers.clustering.ClusterManager",n,p);return n})},"esri/dijit/Legend/utils":function(){define(["dojo/_base/lang","esri/lang","dojo/i18n!../../nls/jsapi"],function(n,m,h){var q=h.widgets.legend;return{getVisualVariableTitle:function(h,f){var p,u=h.field,r=h.normalizationField,c=!1,b=!1,d=!1,e,u=n.isFunction(u)?null:u,r=n.isFunction(r)?null:r;if(h.legendOptions&&h.legendOptions.title)p=
h.legendOptions.title;else if(h.valueExpressionTitle)p=h.valueExpressionTitle;else{if(f.renderer&&f.renderer.authoringInfo&&f.renderer.authoringInfo.visualVariables){var g=f.renderer.authoringInfo.visualVariables;for(e=0;e<g.length;e++){var k=g[e];if("colorInfo"===k.type&&"ratio"===k.style){c=!0;break}else if("colorInfo"===k.type&&"percent"===k.style){b=!0;break}else if("colorInfo"===k.type&&"percentTotal"===k.style){d=!0;break}}}(c=d&&"showRatioPercentTotal"||b&&"showRatioPercent"||c&&"showRatio"||
r&&"showNormField"||u&&"showField"||null)&&(p=m.substitute({field:u&&f.getFieldLabel(u),normField:r&&f.getFieldLabel(r)},q[c]))}return p},getRendererTitle:function(h,f){}}})},"esri/layers/clustering/GeohashAggregation":function(){define("dojo/has dojo/_base/declare dojo/_base/lang dojo/_base/array ../../kernel ../../Evented ../../geometry/Point ../../geometry/mathUtils ./geohashUtils".split(" "),function(n,m,h,q,p,f,v,u,r){m=m(f,{loaded:!1,map:null,layer:null,lod:null,tolerance:null,maxLod:null,clusterMode:null,
clusterSize:null,sortEnabled:!0,filterEnabled:!0,bufferEnabled:!0,updateEnabled:!0,clusters:null,clustersEnabled:!0,statisticInfos:null,defaults:{lod:1,tolerance:0,clusterMode:"auto",clusterSize:80,sortEnabled:!0,filterEnabled:!0,bufferEnabled:!0,updateEnabled:!0},_eventHandles:null,_updateHandle:null,_cellIndex:null,_globalIndex:null,_perfProfile:null,_maxGeohashLength:12,_minClusterSize:15,_active:!1,_levelChange:!0,_modeChange:!1,constructor:function(c){this._update=h.hitch(this,this._update);
this._eventHandles=[];this._globalIndex={numFeatures:null,fullExtent:null,lodStats:null};this._perfProfile={lastIndex:{total:null,numFeatures:0},lastUpdate:{cells:null,clusters:null,total:null}};this.clusters=[];this.map=c.map;this.layer=c.layer;this.setLod(c.lod);this.setTolerance(c.tolerance);this.setClusterMode(c.clusterMode);this.setClusterSize(c.clusterSize);this.setSortEnabled(c.sortEnabled);this.setFilterEnabled(c.filterEnabled);this.setBufferEnabled(c.bufferEnabled);this.setUpdateEnabled(c.updateEnabled);
this.setStatisticInfos(c.statisticInfos);this._load();this.loaded?this._startup():this._eventHandles.push(this.on("load",h.hitch(this,this._startup)))},destroy:function(){this._displayFeatures(!0);q.forEach(this._eventHandles,function(c){c.remove()});clearTimeout(this._updateHandle);this._cellIndex=this._globalIndex=this._eventHandles=this._updateHandle=this.map=this.layer=this.clusters=null},setLod:function(c){var b=this.lod;this.lod=c||this.defaults.lod;b!==this.lod&&this.update()},setTolerance:function(c){var b=
this.tolerance;this.tolerance=c||this.defaults.tolerance;b!==this.tolerance&&this.update()},setClusterMode:function(c){var b=this.clusterMode;this.clusterMode=c||this.defaults.clusterMode;this._evalClusterParams();b!==this.clusterMode&&this.update()},setClusterSize:function(c){var b=this.clusterSize;this.clusterSize=null!=c?c:this.defaults.clusterSize;this._evalClusterParams();b!==this.clusterSize&&this.update()},setSortEnabled:function(c){var b=this.sortEnabled;this.sortEnabled=null!=c?!!c:this.defaults.sortEnabled;
b!==this.sortEnabled&&this.update()},setFilterEnabled:function(c){var b=this.filterEnabled;this.filterEnabled=null!=c?!!c:this.defaults.filterEnabled;b!==this.filterEnabled&&this.update()},setBufferEnabled:function(c){var b=this.bufferEnabled;this.bufferEnabled=null!=c?!!c:this.defaults.bufferEnabled;b!==this.bufferEnabled&&this.update()},setUpdateEnabled:function(c){var b=this.updateEnabled;(this.updateEnabled=null!=c?!!c:this.defaults.updateEnabled)&&b!==this.updateEnabled&&this.update()},setStatisticInfos:function(c){this.statisticInfos=
c||[];this.loaded&&this._applyStatInfos(this.statisticInfos)},update:function(){this.loaded&&null==this._updateHandle&&(this._updateHandle=setTimeout(this._update,0))},isUpdateScheduled:function(){return null!=this._updateHandle},getCell:function(c){return this._cellIndex[c.length][c]},getCluster:function(c){var b;q.some(this.clusters,function(d){-1<q.indexOf(d.geohashes,c)&&(b=d);return!!b});return b},getCellsInCluster:function(c){var b=[];q.forEach(c&&c.geohashes,function(d){(d=this.getCell(d))&&
b.push(d)},this);return b},getCurrentLodStats:function(){var c=this._globalIndex.lodStats;return c&&c[this.lod]},_load:function(){this._displayFeatures(!1);this._checkLoadStatus();this.map.loaded||this._eventHandles.push(this.map.on("load",h.hitch(this,this._checkLoadStatus)));this.layer.loaded||this._eventHandles.push(this.layer.on("load",h.hitch(this,this._checkLoadStatus)))},_checkLoadStatus:function(){if(this.map.loaded&&this.layer.loaded){var c;if("esriGeometryPoint"!==this.layer.geometryType)c=
Error("GeohashAggregation is supported only for points");else{var b=this.map.spatialReference;b.isWebMercator()||4326===b.wkid||(c=Error("GeohashAggregation is supported only when map spatial reference is WGS84 or WebMercator"))}c?(this.loadError=c,this.emit("load-error",{error:c})):(this.loaded=!0,this.emit("load"))}},_startup:function(){this._evalUpdateStatus();this._processFeatures();this._processExtentChange();this._eventHandles.push(this.layer.on("update-end",h.hitch(this,this._processFeatures)),
this.layer.on("suspend",h.hitch(this,this._evalUpdateStatus)),this.layer.on("resume",h.hitch(this,this._evalUpdateStatus)),this.map.on("extent-change",h.hitch(this,this._processExtentChange)))},_processFeatures:function(){this._indexFeatures();this.update()},_evalUpdateStatus:function(){this.setUpdateEnabled(!this.layer.suspended)},_processExtentChange:function(){this._evalClusterParams();this.update()},_update:function(){this._updateHandle=null;if(this.updateEnabled){this.emit("update-start");this._evalClustersEnabled();
if(this.clustersEnabled){var c=this.map.geographicExtent;if(c){var b=this._getIntersectingCells(c),c=this._getClusters(b.cells,c);this.clusters=c.clusters;this._applyStatInfosToClusters(this._getStatFields(this.statisticInfos));var b=b.profile,c=c.profile,d=b.total+c.total;b.total=this._getElapsedTime(b.total);c.total=this._getElapsedTime(c.total);var e=this._perfProfile.lastUpdate={};e.cells=b;e.clusters=c;e.total=this._getElapsedTime(d)}}else this.clusters=[],this._perfProfile.lastUpdate=null;this.emit("update-end",
{levelChange:this._levelChange,modeChange:this._modeChange});this._modeChange&&this.emit("mode-change")}},_evalClustersEnabled:function(){var c=this.clustersEnabled;(this.clustersEnabled=!(null!=this.maxLod&&this.lod>this.maxLod))&&!this._active&&(this._active=!0);this._modeChange=!1;!this._active||c===this.clustersEnabled&&this.layer._params.drawMode!==this.clustersEnabled||(this._modeChange=!0,this._displayFeatures(!this.clustersEnabled))},_displayFeatures:function(c){var b=this.layer;b.setDrawMode(c);
c?b.redraw():b.clearNodes()},_indexFeatures:function(){var c=this._getTime();this._initializeIndexing();var b=0,d=this._globalIndex.fullExtent;q.forEach(this.layer.graphics,function(c){var a=this._getLngLat(c.geometry),e;a&&(e=r.pointToGeohash(a));e&&(this._addGeohashToIndex(e,c,a),b++,this._updateExtent(d,a))},this);this._applyStatInfosToIndex(this._getStatFields(this.statisticInfos));this._globalIndex.numFeatures=b;for(var e=this._globalIndex.lodStats,g=1;g<=this._maxGeohashLength;g++)e[g]=this._getLODStats(g,
b);this.maxLod=b?this._findMaxLOD(e):null;this._perfProfile.lastIndex.total=this._getElapsedTime(c,this._getTime());this._perfProfile.lastIndex.numFeatures=b;this.emit("index-complete")},_initializeIndexing:function(){this._globalIndex={numFeatures:0,fullExtent:{xmin:Infinity,ymin:Infinity,xmax:-Infinity,ymax:-Infinity},lodStats:{}};for(var c=this._cellIndex=[],b=1;b<=this._maxGeohashLength;b++)c[b]={}},_getLngLat:function(c){if(c){var b=c.getLongitude();c=c.getLatitude();c=null!=b&&null!=c?{x:b,
y:c}:null}return c},_addGeohashToIndex:function(c,b,d){for(var e=this._cellIndex,g="",f=0;f<this._maxGeohashLength;f++){var g=g+c[f],a=e[g.length],h=a[g];h||(h=a[g]={count:0,centroid:{x:null,y:null},extent:{xmin:Infinity,ymin:Infinity,xmax:-Infinity,ymax:-Infinity},features:[],geohash:g,statistics:null});this._updateItem(h,1,d,!0);h.features.push(b)}},_getLODStats:function(c,b){var d=this._cellIndex[c],e=0,g=Infinity,f=-Infinity,a=null,h;for(h in d){var m=d[h];e++;m.count<g&&(g=m.count);m.count>f&&
(f=m.count)}0<e&&(a=Number((b/e).toFixed(2)));return{lod:c,count:e,min:Infinity===g?null:g,max:-Infinity===f?null:f,avg:a}},_findMaxLOD:function(c){for(var b=this._maxGeohashLength;1<b&&c[b].count===c[b-1].count;)b--;return b-1},_evalClusterParams:function(){if(this.loaded&&"auto"===this.clusterMode){var c=this._getClusterParams(this.map.getResolutionInMeters(),this.clusterSize,this._minClusterSize);this._levelChange=this.lod!==c.lod;this.lod=c.lod;this.tolerance=c.tolerance}},_getClusterParams:function(c,
b,d){b<d&&(b=d);d=Math.ceil(c*b);c=this._getClosestLODRange(d).max;var e;do e=this._getCellSize(c),b=d-e,(e=b>e||1===e)||(c+=1);while(!e);d=b/this._getCellSize(c);return{lod:c,tolerance:b,multiplier:Number(d.toFixed(2))}},_getClosestLODRange:function(c){for(var b,d=this._maxGeohashLength;1<=d;d--)if(this._getCellSize(d)>=c){b=d;break}null==b&&(b=1);c=b+1;c>this._maxGeohashLength&&(c=this._maxGeohashLength);return{min:b,max:c}},_getCellSize:function(c){c=r.getCellSizeInMeters(c);return Math.ceil(Math.min(c.width,
c.height))},_sorter:function(c,b){var d=c.centroid,e=b.centroid;return c.count>b.count?-1:c.count<b.count?1:d.x>e.x?-1:d.x<e.x?1:0},_getIntersectingCells:function(c){var b=this._getTime(),d=r.getIntersecting(c,this.lod,this.bufferEnabled?this.tolerance:0);c=this._getTime();var e=[],g=this.tolerance,f=this.sortEnabled;q.forEach(d,function(a){(a=this.getCell(a))&&e.push(a)},this);g&&f&&e.sort(this._sorter);d=this._getTime();return{cells:e,profile:{findCells:this._getElapsedTime(b,c),scanAndSortCells:this._getElapsedTime(c,
d),total:d-b}}},_getClusters:function(c,b){var d=this._getTime(),e=[],g={},f={findCells:0};q.forEach(c,function(a,b){var d=this._createCluster(a,g,f);d&&e.push(d)},this);this._markIntersecting(e,b);this.filterEnabled&&(e=this._getIntersectingClusters(e));var a=this._getTime();return{clusters:e,profile:{findCellsInCluster:this._getElapsedTime(f.findCells),total:a-d}}},_markIntersecting:function(c,b){var d=b.normalize();q.forEach(c,function(b){var c=b.centroid.x,e=b.centroid.y;b.isIntersecting=q.some(d,
function(a){return c>=a.xmin&&c<=a.xmax&&e>=a.ymin&&e<=a.ymax})})},_getIntersectingClusters:function(c){return q.filter(c,function(b){return b.isIntersecting})},_createCluster:function(c,b,d){if(!b[c.geohash]){var e=[{cell:c,distance:0}];if(this.tolerance){var g=this._getTime(),f=r.getNeighborsWithinDistance(c.centroid,this.lod,this.tolerance);d.findCells+=this._getTime()-g;q.forEach(f,function(a){if(a!==c.geohash&&(a=this.getCell(a))){var b=this._calculateDistance(c.centroid,a.centroid);b<=this.tolerance&&
e.push({cell:a,distance:b})}},this)}return this._mergeCells(e,b)}},_calculateDistance:function(c,b){return u.getLength(r.geographicToWebMercator(c),r.geographicToWebMercator(b))},_mergeCells:function(c,b){var d=this._initializeCluster({},c[0].cell.geohash);q.forEach(c,function(c){var e=c.cell,f=e.geohash;c=c.distance;var a=b[f];if(a)if(c<a.distance)this._removeCellFromCluster(f,b);else return;b[f]={cluster:d,distance:c};this._updateItem(d,e.count,e.centroid);d.geohashes.push(f)},this);return d},_removeCellFromCluster:function(c,
b){var d=b[c].cluster;delete b[c];var e=q.indexOf(d.geohashes,c);-1<e&&d.geohashes.splice(e,1);this._reevaluateCluster(d)},_reevaluateCluster:function(c){var b=c.geohashes;c=this._initializeCluster(c,c.primary);q.forEach(b,function(b){var d=this.getCell(b);d&&(this._updateItem(c,d.count,d.centroid),c.geohashes.push(b))},this)},_initializeCluster:function(c,b){c.count=0;c.centroid=new v(null,null);c.geohashes=[];c.primary=b;c.statistics=null;return c},_applyStatInfos:function(c){c=this._getStatFields(c);
this._applyStatInfosToIndex(c);this._applyStatInfosToClusters(c)},_getStatFields:function(c){c=this._getValidStatInfos(c);var b=[];q.forEach(c,function(d){-1===q.indexOf(b,d.field)&&b.push(d.field)});return b},_getValidStatInfos:function(c){var b=this.layer;return q.filter(c,function(d){return b.loaded&&b.isOutField(d.field)&&("sum"===d.type||"avg"===d.type)})},_applyStatInfosToIndex:function(c){var b=this._cellIndex;if(b)for(var d=1;d<=this._maxGeohashLength;d++){var e=b[d],g;for(g in e)this._applyStatInfosToCell(e[g],
c)}},_applyStatInfosToCell:function(c,b){var d=this._initializeStats(c,b);q.forEach(c.features,function(c){this._calcFeatureStats(c,b,d)},this);this._summarizeStats(c,d,b)},_calcFeatureStats:function(c,b,d){var e=c.attributes;e&&q.forEach(b,function(b){var c=e[b];b=d[b];this._isValidNumber(c)&&(b.count++,b.sum+=c)},this)},_applyStatInfosToClusters:function(c){q.forEach(this.clusters,function(b){var d=this._initializeStats(b,c);q.forEach(this.getCellsInCluster(b),function(b){this._calcCellStats(b,
c,d)},this);this._summarizeStats(b,d,c);b.attributes.clusterId=b.primary},this)},_calcCellStats:function(c,b,d){var e=c.statistics;q.forEach(b,function(b){var c=e[b];b=d[b];c.count&&(b.count+=c.count,b.sum+=c.sum)})},_initializeStats:function(c,b){var d=c.statistics={};q.forEach(b,function(b){d[b]={count:0,sum:null,avg:null}});return d},_summarizeStats:function(c,b,d){var e=c.attributes={count:c.count};q.forEach(d,function(d){var c=b[d];0<c.count&&(c.avg=c.sum/c.count);e["sum_"+d]=c.sum;e["avg_"+
d]=c.avg})},_updateItem:function(c,b,d,e){var f=d.y,h=c.centroid,a=c.count;h.x=(a*h.x+b*d.x)/(a+b);h.y=(a*h.y+b*f)/(a+b);c.count+=b;e&&this._updateExtent(c.extent,d)},_updateExtent:function(c,b){var d=b.x,e=b.y;d<c.xmin&&(c.xmin=d);d>c.xmax&&(c.xmax=d);e<c.ymin&&(c.ymin=e);e>c.ymax&&(c.ymax=e)},_isValidNumber:function(c){return"number"===typeof c&&!isNaN(c)&&Infinity!==c&&-Infinity!==c},_getTime:function(){return window.performance?window.performance.now():(new Date).getTime()},_getElapsedTime:function(c,
b){var d,e;e=null!=c&&null!=b?b-c:c;null!=e&&(d="millisecond",1E3<=e&&(e/=1E3,d="second",60<=e&&(e/=60,d="minute")),d={value:Number(e.toFixed(2)),unit:d});return d}});n("extend-esri")&&h.setObject("layers.clustering.GeohashAggregation",m,p);return m})},"esri/layers/clustering/geohashUtils":function(){define("dojo/has dojo/string dojo/_base/lang dojo/_base/array ../../kernel ../../geometry/Point ../../geometry/Extent ../../SpatialReference ../../geometry/webMercatorUtils".split(" "),function(n,m,h,
q,p,f,v,u,r){function c(a){var b=a.spatialReference;if(!b)return{x:a.x,y:a.y};var d=b.isWebMercator(),c;4326===b.wkid?c={x:a.x,y:a.y}:d&&(c={x:a.getLongitude(),y:a.getLatitude()});return c}function b(a){var b=a.spatialReference,d=!(!b||!b.isWebMercator()),c;b&&4326===b.wkid?c=new v(a.toJson()):d&&(c=r.webMercatorToGeographic(a,!0));return c}function d(a,b){b.x=f.prototype._normalizeX(a.x,u.prototype._info[4326]);b.y=a.y;return b}function e(a){a=F.decimals[a].toString(2);return m.pad(a,F.bitsPerBase32Char,
"0")}function g(a,b){var d;b=b.slice();b.splice(1,0,0);for(var c=b[0],e=b[2],f=0;f<a.length;f++)Number(a[f])?b[0]=b[1]:b[2]=b[1],d=b[1]=(b[0]+b[2])/2,c=b[0],e=b[2];return{value:d,min:c,max:e}}function k(a,b,d){var c=[];b=b.slice();b.splice(1,0,0);for(var e=b[0],f=b[2],g=0;g<d;g++)a>=b[1]?(b[0]=b[1],e=1):(b[2]=b[1],e=0),b[1]=(b[0]+b[2])/2,c.push(e),e=b[0],f=b[2];return{value:c.join(""),min:e,max:f}}function a(a){var b=a*F.bitsPerBase32Char;0===b%2?a=b/=2:(a=(b+1)/2,b-=a);return{lon:a,lat:b}}function l(a){var b=
0;a=a.split("").reverse().join("");for(var d=0;d<a.length;d++)b+=Number(a[d])*Math.pow(2,d);return F.base32[b]}function t(a,b){var d={x:a.xmin,y:a.ymax},c={x:a.xmax,y:a.ymin},e={x:a.xmax,y:a.ymax};return{sw:K.pointToGeohash({x:a.xmin,y:a.ymin},b),nw:K.pointToGeohash(d,b),se:K.pointToGeohash(c,b),ne:K.pointToGeohash(e,b)}}function z(a,b,d,c,e){var f=a;do e[f]||(e[f]=!0,c.push(f)),(a=f===b)||(f=E(f,d));while(!a)}function y(a,b,d,c){var e=t(a,b);a=[];z(e.sw,e.nw,"n",a,{});b=[];z(e.se,e.ne,"n",b,{});
for(e=0;e<a.length;e++)z(a[e],b[e],"e",d,c)}function A(a){return q.filter(a,function(a){return 180===a.xmax?!0:!1})[0]}function B(a){return q.filter(a,function(a){return-180===a.xmin?!0:!1})[0]}function x(a,b,d,c){var e=K.geographicToWebMercator(a);a={x:e.x-b,y:e.y-b};b=K.webMercatorToGeographic({x:e.x+b,y:e.y+b},!0);a=K.webMercatorToGeographic(a,!0);return new v(null!=d?d:a.x,a.y,null!=c?c:b.x,b.y)}function C(a,b,d,c){var e;a=t(a,b);var f,g;"min"===c?g=180:"max"===c&&(f=-180);var h=f;c=g;e=K.geohashToCell(a.sw).extent;
b=K.geohashToCell(a.ne).extent;a=null!=h?h:e.xmin;e=e.ymin;c=null!=c?c:b.xmax;b=b.ymax;a=x({x:a,y:e},d,f,g);d=x({x:c,y:b},d,f,g);return new v(a.xmin,a.ymin,d.xmax,d.ymax)}function D(a,b,d){var c=a,e=0;do e++,(a=c===b)||(c=E(c,d));while(!a);return e}function H(a,b){var d=t(a,b),c=D(d.nw,d.ne,"e");return{rows:D(d.nw,d.sw,"s"),cols:c}}function E(a,b){var d=a.length%2,c=a.slice(-1),e=F.decimals[c],f=a.slice(0,-1);-1!=F.borders[b][d].indexOf(c)&&f&&(f=E(f,b));return f+F.neighbors[b][d][e]}var F={base32:"0123456789bcdefghjkmnpqrstuvwxyz",
decimals:function(){for(var a={},b=0;32>b;b++)a["0123456789bcdefghjkmnpqrstuvwxyz"[b]]=b;return a}(),neighbors:{n:[null,"238967debc01fg45kmstqrwxuvhjyznp"],s:[null,"bc01fg45238967deuvhjyznpkmstqrwx"],e:[null,"14365h7k9dcfesgujnmqp0r2twvyx8zb"],w:[null,"p0r21436x8zb9dcf5h7kjnmqesgutwvy"]},borders:{n:[null,"bcfguvyz"],s:[null,"0145hjnp"],e:[null,"prxz"],w:[null,"028b"]},bitsPerBase32Char:5,maxGeohashLength:12,longitudeRange:[-180,180],latitudeRange:[-90,90]};F.neighbors.n[0]="14365h7k9dcfesgujnmqp0r2twvyx8zb";
F.neighbors.s[0]="p0r21436x8zb9dcf5h7kjnmqesgutwvy";F.neighbors.e[0]="238967debc01fg45kmstqrwxuvhjyznp";F.neighbors.w[0]="bc01fg45238967deuvhjyznpkmstqrwx";F.borders.n[0]="prxz";F.borders.s[0]="028b";F.borders.e[0]="bcfguvyz";F.borders.w[0]="0145hjnp";var K={geographicToWebMercator:function(a){a=f.lngLatToXY(a.x,a.y);return{x:a[0],y:a[1]}},webMercatorToGeographic:function(a,b){var d=f.xyToLngLat(a.x,a.y,b);return{x:d[0],y:d[1]}},geohashToCell:function(a){for(var b=[],d=0;d<a.length;d++)b.push(e(a[d]));
for(var b=b.join(""),d=[],c=[],f=0;f<b.length;f++)0===f%2?d.push(b[f]):c.push(b[f]);d=d.join("");c=c.join("");d=[d,c];b=g(d[0],F.longitudeRange);d=g(d[1],F.latitudeRange);return{point:{x:b.value,y:d.value},extent:{xmin:b.min,xmax:b.max,ymin:d.min,ymax:d.max},geohash:a}},pointToCell:function(b,e){var f,g,h;e=e||F.maxGeohashLength;var m=c(b);if(m){m=d(m,m);f=a(e);h=k(m.x,F.longitudeRange,f.lon);var p=k(m.y,F.latitudeRange,f.lat);f=h.value;g=p.value;h={xmin:h.min,xmax:h.max,ymin:p.min,ymax:p.max};for(var p=
[],n=Math.ceil((f.length+g.length)/F.bitsPerBase32Char),q=0,r=0,w=0;w<n*F.bitsPerBase32Char;w++){var u=0===w%2?f[q++]:g[r++];null==u&&(u=0);p.push(u)}f=p.join("");g=F.bitsPerBase32Char;p=f.length/g;n=[];for(q=0;q<p;q++)r=f.substr(q*g,g),n.push(l(r));f=n.join("");return{point:m,extent:h,geohash:f}}},geohashToPoint:function(a){return K.geohashToCell(a).point},pointToGeohash:function(a,b){var d=K.pointToCell(a,b);return d&&d.geohash},getCells:function(a){return q.map(a,function(a){return K.geohashToCell(a)})},
getCellSize:function(b){var d=F.longitudeRange,c=F.latitudeRange,d=Math.abs(d[1]-d[0]),c=Math.abs(c[1]-c[0]);b=a(b||1);return{width:d/Math.pow(2,b.lon),height:c/Math.pow(2,b.lat)}},getCellSizeInMeters:function(a){a=K.getCellSize(a);var b=r.metersPerDegree;a.width*=b;a.height*=b;return a},getIntersecting:function(a,d,c){d=d||1;c=c||0;var e=[],f=b(a);if(f){c&&(f=K.expandExtent(a,d,c));a=f.normalize();var g={};q.forEach(a,function(a){y(a,d,e,g)})}return e},countIntersecting:function(a,c,e){c=c||1;e=
e||0;var f=0,g=b(a);if(g){e&&(g=K.expandExtent(a,c,e));a=g.normalize();if(2===a.length){f=A(a);g=B(a);e=H(f,c);var h=H(g,c);a=e.rows;e=e.cols+h.cols;f={x:f.xmin,y:f.ymax};g={x:g.xmax,y:g.ymax};f=d(f,{});g=d(g,{});f=K.pointToGeohash(f,c);c=K.pointToGeohash(g,c);f===c&&e--;c={rows:a,cols:e}}else c=H(a[0],c);f=c.cols*c.rows}return f},getChildren:function(a){a=a||"";var b=[],d;for(d in F.decimals)b.push(a+d);return b},getNeighbors:function(a){var b=E(a,"n"),d=E(a,"s");return[b,E(b,"e"),E(b,"w"),d,E(d,
"e"),E(d,"w"),E(a,"e"),E(a,"w")]},getExtentFromDistance:function(a,b){b=b||1E3;var d,e=c(a);e&&(d=x(e,b));return d},expandExtent:function(a,d,c){d=d||1;c=c||0;if(a=b(a)){if(c){a=a.normalize();if(2===a.length){var e=c;c=A(a);a=B(a);c=C(c,d,e,"min");a=C(a,d,e,"max");360<=c.getWidth()+a.getWidth()?(d=-180,a=180):(d=c.xmin,a=a.xmax);return new v(d,c.ymin,a,c.ymax)}return C(a[0],d,c)}return a}},getNeighborsWithinDistance:function(a,b,d){d=d||1E3;b=b||1;var e=[];if(a=c(a)){d=x(a,d).normalize();var f={};
q.forEach(d,function(a){y(a,b,e,f)})}return e}};n("extend-esri")&&h.setObject("layers.clustering.geohashUtils",K,p);return K})},"*noref":1}});
define("esri/arcgis/utils","require dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Deferred dojo/_base/json dojo/_base/url dojo/on dojo/DeferredList dojo/dom-construct dojo/sniff ../kernel ../config ../Color ../lang ../request ../SpatialReference ../map ../urlUtils ../geometry/ScreenPoint ../geometry/Extent ../geometry/webMercatorUtils ../symbols/jsonUtils ../renderers/jsonUtils ../dijit/PopupTemplate ../dijit/Popup ../tasks/query ../tasks/GeometryService ../layers/ArcGISTiledMapServiceLayer ../layers/FeatureLayer dojo/i18n!../nls/jsapi".split(" "),function(n,
m,h,q,p,f,v,u,r,c,b,d,e,g,k,a,l,t,z,y,A,B,x,C,D,H,E,F,K,w,G){function O(b){return a({url:Q.arcgisUrl+"/"+b.itemId+"/data",content:{f:"json"},callbackParamName:"callback"},{disableIdentityLookup:!0,_preLookup:!0})}function da(b,d){var c={f:"json"};d&&(c.token=d);return a({url:b,content:c,callbackParamName:"callback"},{disableIdentityLookup:!0})}function Z(a){!a.layerDefinition||a.layerDefinition.drawingInfo&&a.layerDefinition.drawingInfo.labelingInfo||(a.showLabels=!1);a.itemProperties.layerDefinition&&
(a.layerDefinition?(a.layerDefinition.drawingInfo||(a.layerDefinition.drawingInfo=a.itemProperties.layerDefinition.drawingInfo),k.isDefined(a.layerDefinition.definitionExpression)||(a.layerDefinition.definitionExpression=a.itemProperties.layerDefinition.definitionExpression),k.isDefined(a.layerDefinition.minScale)||(a.layerDefinition.minScale=a.itemProperties.layerDefinition.minScale),k.isDefined(a.layerDefinition.maxScale)||(a.layerDefinition.maxScale=a.itemProperties.layerDefinition.maxScale)):
a.layerDefinition=a.itemProperties.layerDefinition);!a.itemProperties.popupInfo||a.popupInfo||a.disablePopup||(a.popupInfo=a.itemProperties.popupInfo);k.isDefined(a.itemProperties.showLabels)&&!k.isDefined(a.showLabels)&&(a.showLabels=a.itemProperties.showLabels);k.isDefined(a.itemProperties.showLegend)&&!k.isDefined(a.showLegend)&&(a.showLegend=a.itemProperties.showLegend);k.isDefined(a.itemProperties.refreshInterval)&&!k.isDefined(a.refreshInterval)&&(a.refreshInterval=a.itemProperties.refreshInterval)}
function ja(a){Z(a);a.itemProperties.layerDefinition&&a.layerDefinition&&(!k.isDefined(a.layerDefinition.maximumTrackPoints)&&k.isDefined(a.itemProperties.layerDefinition.maximumTrackPoints)&&(a.layerDefinition.maximumTrackPoints=a.itemProperties.layerDefinition.maximumTrackPoints),!a.layerDefinition.definitionGeometry&&a.itemProperties.layerDefinition.definitionGeometry&&(a.layerDefinition.definitionGeometry=a.itemProperties.layerDefinition.definitionGeometry));a.itemProperties.purgeOptions&&!a.purgeOptions&&
(a.purgeOptions=a.itemProperties.purgeOptions)}function aa(a,b){var d=new p,c=a.itemData,e=[],f=[];h.forEach(c.operationalLayers,function(a){if(a.itemId&&!a.type){var b=a.url.toLowerCase();-1<b.indexOf("/featureserver")||-1<b.indexOf("/mapserver/")?(f.push(a),e.push(O(a))):-1<b.indexOf("/mapserver")&&-1===b.indexOf("/mapserver/")&&(!a.layers||!k.isDefined(a.minScale)&&!k.isDefined(a.maxScale))?(f.push(a),e.push(O(a))):-1<b.indexOf("/imageserver")&&!k.isDefined(a.minScale)&&!k.isDefined(a.maxScale)?
(f.push(a),e.push(O(a))):-1<b.indexOf("/streamserver")&&(f.push(a),e.push(O(a)))}});c.baseMap&&c.baseMap.baseMapLayers&&h.forEach(c.baseMap.baseMapLayers,function(a){a.itemId&&"VectorTileLayer"!==a.layerType&&(f.push(a),e.push(O(a)))});if(0<e.length){var g={};(new r(e)).addCallback(function(b){h.forEach(f,function(a,d){var c=b[d][1];if(c&&!(c instanceof Error)&&(g[a.itemId]=c,!a.type)){var e=a.url.toLowerCase();(-1<e.indexOf("/featureserver")||-1<e.indexOf("/mapserver/"))&&c.layers?h.forEach(c.layers,
function(b){var d="/featureserver/"+b.id;(d=e.match(d+"$")==d)||(d="/mapserver/"+b.id,d=e.match(d+"$")==d);d&&(a.itemProperties=b,Z(a))}):-1<e.indexOf("/streamserver")?(a.itemProperties=c,ja(a)):-1<e.indexOf("/mapserver")?(c.layers&&!a.layers&&(a.layers=c.layers),k.isDefined(c.minScale)&&!k.isDefined(a.minScale)&&(a.minScale=c.minScale),k.isDefined(c.maxScale)&&!k.isDefined(a.maxScale)&&(a.maxScale=c.maxScale),k.isDefined(c.refreshInterval)&&!k.isDefined(a.refreshInterval)&&(a.refreshInterval=c.refreshInterval),
c.visibleLayers&&!a.visibleLayers&&(a.visibleLayers=c.visibleLayers)):-1<e.indexOf("/imageserver")&&(k.isDefined(c.minScale)&&!k.isDefined(a.minScale)&&(a.minScale=c.minScale),k.isDefined(c.maxScale)&&!k.isDefined(a.maxScale)&&(a.maxScale=c.maxScale),k.isDefined(c.refreshInterval)&&!k.isDefined(a.refreshInterval)&&(a.refreshInterval=c.refreshInterval),!c.popupInfo||a.popupInfo||a.disablePopup||(a.popupInfo=c.popupInfo),c.renderingRule&&!a.renderingRule&&(a.renderingRule=c.renderingRule,c.renderingRule.functionName&&
(a.renderingRule.rasterFunction=c.renderingRule.functionName)),c.bandIds&&!a.bandIds&&(a.bandIds=c.bandIds),c.mosaicRule&&!a.mosaicRule&&(a.mosaicRule=c.mosaicRule),c.format&&!a.format&&(a.format=c.format),k.isDefined(c.compressionQuality)&&!k.isDefined(a.compressionQuality)&&(a.compressionQuality=c.compressionQuality),!c.layerDefinition||!c.layerDefinition.definitionExpression||k.isDefined(a.layerDefinition)&&k.isDefined(a.layerDefinition.definitionExpression)||(a.layerDefinition=a.layerDefinition||
{},a.layerDefinition.definitionExpression=c.layerDefinition.definitionExpression))}});a.relatedItemsData=g;d.callback(a)})}else d.callback(a);return d}function sa(a,b){var c=new p,e=a.itemData,f=e.baseMap.baseMapLayers[0];if("BingMapsAerial"===f.type||"BingMapsRoad"===f.type||"BingMapsHybrid"===f.type)if(f.portalUrl&&d.id)delete b.bingMapsKey,d.id.checkSignInStatus(z.urlToObject(Q.arcgisUrl).path).then(m.hitch(null,function(a,b,d,c,e){da(f.portalUrl,e.token).then(m.hitch(null,I,a,b,d,c),m.hitch(null,
L,a,b,d,c))},a,b,e,c),m.hitch(null,function(a,b,d,c,e){da(f.portalUrl).then(m.hitch(null,I,a,b,d,c),m.hitch(null,L,a,b,d,c))},a,b,e,c));else if(b.bingMapsKey){var g=new W({bingMapsKey:b.bingMapsKey,mapStyle:W.MAP_STYLE_AERIAL});q.connect(g,"onLoad",m.hitch(this,function(){c.callback([a,b])}));q.connect(g,"onError",function(d){delete b.bingMapsKey;a.itemData=R(e);f=a.itemData.baseMap.baseMapLayers[0];f.errors=[];f.errors.push({message:"The owner of the application has not provided a valid Bing Key for the Bing Map it includes. Switching to Esri layers."});
c.callback([a,b])})}else a.itemData=R(e),f=a.itemData.baseMap.baseMapLayers[0],f.errors=[],f.errors.push({message:"The owner of the application has not provided a Bing Key for the Bing Map it includes. Switching to Esri layers."}),c.callback([a,b]);else c.callback([a,b]);return c}function ta(a){var b=new p,d,c;a=a.itemData;var e=a.baseMap&&a.baseMap.baseMapLayers;if(ra&&!ra.supported())for(a=0;a<e.length;a++){var f=e[a];if(!f.isReference){"VectorTileLayer"===f.layerType&&(d=f.itemId,c=a);break}}d?
va(d,!1).addBoth(function(a){var d=/^https?:\/\/basemaps(dev)?\.arcgis\.com\/arcgis\/rest\/services\/World_Basemap\/VectorTileServer/i;a&&a.item&&d.test(a.item.url)&&(e[c]={id:"FB_"+f.id,layerType:"ArcGISTiledMapServiceLayer",opacity:"opacity"in f?f.opacity:1,visibility:"visibility"in f?f.visibility:!0,url:"https://services.arcgisonline.com/arcgis/rest/services/World_Street_Map/MapServer"});b.resolve()}):b.resolve();return b}function I(a,b,d,c,e){e.bingKey?(b.bingMapsKey=e.bingKey,e=new W({bingMapsKey:b.bingMapsKey,
mapStyle:W.MAP_STYLE_AERIAL}),q.connect(e,"onLoad",m.hitch(this,function(){c.callback([a,b])})),q.connect(e,"onError",function(e){delete b.bingMapsKey;a.itemData=R(d);e=a.itemData.baseMap.baseMapLayers[0];e.errors=[];e.errors.push({message:"The owner of the map has not provided a valid Bing Key for the Bing Map it includes. Switching to Esri layers."});c.callback([a,b])})):L(a,b,d,c)}function L(a,b,d,c){delete b.bingMapsKey;a.itemData=R(d);d=a.itemData.baseMap.baseMapLayers[0];d.errors=[];d.errors.push({message:"The owner of the map has not provided a Bing Key for the Bing Map it includes. Switching to Esri layers."});
c.callback([a,b])}function R(a){a.baseMap="BingMapsAerial"===a.baseMap.baseMapLayers[0].type?{title:"Imagery",baseMapLayers:[{id:"World_Imagery_2017",visibility:!0,opacity:1,url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"}]}:"BingMapsRoad"===a.baseMap.baseMapLayers[0].type?{title:"Streets",baseMapLayers:[{id:"World_Street_Map_8421",opacity:1,visibility:!0,url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer"}]}:{title:"Imagery with Labels",
baseMapLayers:[{id:"World_Imagery_6611",opacity:1,visibility:!0,url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"},{id:"World_Boundaries_and_Places_1145",isReference:!0,opacity:1,visibility:!0,url:"https://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer"}]};return a}function U(a,b,d,c){var e=a.dynamicLayerInfos||a.layerInfos,f=b.layers;if(f&&e)if(c.usePopupManager){var g;h.forEach(e,function(a){var b=a.id;if(!a.subLayerIds)for(a=
0;a<f.length;a++){var c=f[a];if(c.id===b&&c.popupInfo){g||(g={});g[b]={infoTemplate:new d(c.popupInfo),layerUrl:c.layerUrl};break}}});g&&a.setInfoTemplates(g)}else{var J=[],l=[],m=[],p=[],n=[],q=[];h.forEach(e,function(b){var d=b.id;if(!b.subLayerIds&&-1!==h.indexOf(a.visibleLayers,d))for(b=0;b<f.length;b++){var c=f[b];if(c.id===d){l.push(d);J.push(c.popupInfo);m.push(c.layerUrl||"");c.layerDefinition&&c.layerDefinition.definitionExpression?p.push(c.layerDefinition.definitionExpression):p.push("");
n.push(k.isDefined(c.minScale)?c.minScale:null);q.push(k.isDefined(c.maxScale)?c.maxScale:null);break}}});J.length&&(a.__popups=J,a.__popupIds=l,a.__popupUrls=m,a.__popupWhereClauses=p,a.__popupMinScales=n,a.__popupMaxScales=q,a.__resourceInfo=b.resourceInfo)}}function T(a){if(!a)return!1;var b=(new v(Q.arcgisUrl)).authority;return-1!==a.indexOf(".arcgis.com/")||-1!==a.indexOf(b)}function Y(a){return a?-1!==a.indexOf("/services.arcgisonline.com/")||-1!==a.indexOf("/server.arcgisonline.com/"):!1}function S(a){"https:"===
location.protocol&&(T(a)||Y(a))&&(a=a.replace("http:","https:"));return a}function ea(a,b,d){var c=[],e;a.displayLevels||(c=h.map(a.resourceInfo.tileInfo.lods,function(a){return a.level}));a.exclusionAreas&&(e=m.clone(a.exclusionAreas),e=h.map(e,function(a){a.geometry=new A(a.geometry);return a}));c=new K(S(a.url),{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,displayLevels:a.displayLevels||c,id:a.id,minScale:a.minScale,maxScale:a.maxScale,refreshInterval:a.refreshInterval,exclusionAreas:e});
d.ignorePopups||U(c,a,b,d);return c}function fa(a,b){if(!a||!b||0===b.length)return[];var d=","+b+",",c=[],e,f=",";for(e=0;e<a.length;e++)if(null!==a[e].subLayerIds){if(-1===d.indexOf(","+a[e].id+",")||-1<f.indexOf(","+a[e].id+","))f+=a[e].subLayerIds.toString()+","}else-1<d.indexOf(","+a[e].id+",")&&-1===f.indexOf(","+a[e].id+",")&&c.push(a[e].id);return c}function ka(a,b,d){var c=new Ha;c.format="png24";a.resourceInfo&&a.resourceInfo.supportedImageFormatTypes&&-1<a.resourceInfo.supportedImageFormatTypes.indexOf("PNG32")&&
(c.format="png32");var c=new Ia(S(a.url),{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,id:a.id,imageParameters:c,minScale:a.minScale,maxScale:a.maxScale,refreshInterval:a.refreshInterval}),e=a.visibleLayers;if(!a.visibleLayers){var f="";h.forEach(c.layerInfos,function(a){a.defaultVisibility&&(f+=(0<f.length?",":"")+a.id)});e=f}if(a.layers&&0<a.layers.length){var g=[],k=[],J,l=[],p,n;h.forEach(a.layers,function(b){b.layerDefinition&&b.layerDefinition.definitionExpression&&(g[b.id]=
b.layerDefinition.definitionExpression);if(b.layerDefinition&&b.layerDefinition.source){J=null;n=b.layerDefinition.source;if("mapLayer"===n.type){var c=h.filter(a.resourceInfo.layers,function(a){return a.id===n.mapLayerId});c.length&&(J=m.mixin(c[0],b))}else J=m.mixin({},b);J&&(J.source=n,delete J.popupInfo,J=new Ja(J),a.visibleLayers&&(c="string"==typeof a.visibleLayers?a.visibleLayers.split(","):a.visibleLayers,-1<h.indexOf(c,b.id)?J.defaultVisibility=!0:J.defaultVisibility=!1),k.push(J))}b.layerDefinition&&
b.layerDefinition.source&&b.layerDefinition.drawingInfo&&(p=new Ka(b.layerDefinition.drawingInfo),l[b.id]=p)},this);0<g.length&&c.setLayerDefinitions(g);0<k.length?(c.setDynamicLayerInfos(k,!0),0<l.length&&c.setLayerDrawingOptions(l,!0)):(e=fa(c.layerInfos,e),c.setVisibleLayers(e))}else e=fa(c.layerInfos,e),c.setVisibleLayers(e);d.ignorePopups||U(c,a,b,d);return c}function la(a,b,c){var d=new La;d.bandIds=a.bandIds;null!=a.format&&(d.format=a.format,null!=a.compressionQuality&&(d.compressionQuality=
a.compressionQuality));if(a.renderingRule&&a.renderingRule.rasterFunction){var e=new Ma(a.renderingRule);d.renderingRule=e}a.mosaicRule&&(e=new Na(a.mosaicRule),d.mosaicRule=e);k.isDefined(a.noData)&&(d.noData=a.noData);k.isDefined(a.noDataInterpretation)&&(d.noDataInterpretation=a.noDataInterpretation);k.isDefined(a.interpolation)&&(d.interpolation=a.interpolation);e=a.layerType?"ArcGISImageServiceVectorLayer"===a.layerType:!1;k.isDefined(a.layerType)||(e=a.resourceInfo.hasMultidimensions&&("esriImageServiceDataTypeVector-UV"===
a.resourceInfo.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===a.resourceInfo.serviceDataType));d={resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,id:a.id,imageServiceParameters:d,minScale:a.minScale,maxScale:a.maxScale,refreshInterval:a.refreshInterval};d=e?new Oa(S(a.url),d):new Pa(S(a.url),d);a.layerDefinition&&(a.layerDefinition.drawingInfo&&a.layerDefinition.drawingInfo.renderer&&(e=C.fromJson(a.layerDefinition.drawingInfo.renderer),d.setRenderer(e)),a.layerDefinition.definitionExpression&&
d.setDefinitionExpression(a.layerDefinition.definitionExpression,!0));!c.ignorePopups&&a.popupInfo&&d.setInfoTemplate(new b(a.popupInfo));return d}function ba(a,b,d){var c=[102113,102100,3857],e=d||new l(b[0].layerObject.fullExtent.spatialReference),f=new l(a.resourceInfo.fullExtent.spatialReference);return e.wkt==f.wkt&&(e.wkid==f.wkid||k.isDefined(e.latestWkid)&&e.latestWkid==f.wkid||k.isDefined(f.latestWkid)&&e.wkid==f.latestWkid||k.isDefined(e.latestWkid)&&e.latestWkid==f.latestWkid)||e.wkid&&
f.wkid&&h.some(c,function(a){return a===f.wkid})&&h.some(c,function(a){return a===e.wkid})?!0:!1}function ga(a,b,d){if(!b[0].layerObject.tileInfo)return!1;a=a.resourceInfo.tileInfo;b=b[0].layerObject.tileInfo;d=d.width>d.height?d.width:d.height;for(var c=!1,e=!1,f=0;f<a.lods.length;f++){for(var g=a.lods[f].scale/a.dpi,h=0;h<b.lods.length;h++){var k=b.lods[h].scale/b.dpi;if(Math.abs(k-g)/k<1/d)if(c){e=!0;break}else c=!0}if(e)break}return e||c&&(1===a.lods.length||1===b.lods.length)?!0:!1}function ma(a,
b,c,e,g,p){var n,r,J=c._clazz;if("OpenStreetMap"===a.type)n=new Qa({id:a.id,opacity:a.opacity,visible:null!==a.visibility&&void 0!==a.visibility?a.visibility:!0});else if("WFS"===a.type)e={customParameters:a.wfsInfo.customParameters,geometryType:a.layerDefinition.geometryType,id:a.id,labelingInfo:a.layerDefinition.drawingInfo.labelingInfo,maxFeatures:a.wfsInfo.maxFeatures,mode:a.mode,name:a.wfsInfo.name,showLabels:!0,swapXY:a.wfsInfo.swapXY,title:a.title,url:a.url,version:a.wfsInfo.version,visible:a.visibility,
wkid:a.layerDefinition.spatialReference.wkid},n=new Ra,n.fromJson(e,function(){k.isDefined(a.opacity)&&n.setOpacity(a.opacity);k.isDefined(a.visibility)&&n.setVisibility(a.visibility);(a.minScale||a.maxScale)&&n.setScaleRange(a.minScale,a.maxScale);n.renderer=C.fromJson(a.layerDefinition.drawingInfo.renderer);!c.ignorePopups&&a.popupInfo&&n.setInfoTemplate(new J(a.popupInfo));n.emit("fromJsonComplete")});else if("WMS"===a.type){var t=[],ia=[];h.forEach(a.layers,function(a){ia.push(new Sa({name:a.name,
title:a.title,legendURL:a.legendURL,queryable:a.queryable,showPopup:a.showPopup}));t.push(a.name)},this);a.visibleLayers&&(t=a.visibleLayers);e=new A(a.extent[0][0],a.extent[0][1],a.extent[1][0],a.extent[1][1],new l({wkid:4326}));e={customLayerParameters:a.customLayerParameters,customParameters:a.customParameters,extent:e,layerInfos:ia,version:a.version,maxWidth:a.maxWidth,maxHeight:a.maxHeight,featureInfoFormat:a.featureInfoFormat,getFeatureInfoURL:a.featureInfoUrl,getMapURL:a.mapUrl,spatialReferences:a.spatialReferences,
title:a.title,copyright:a.copyright,minScale:a.minScale||0,maxScale:a.maxScale||0,format:a.format};n=new Ta(a.url,{id:a.id,visibleLayers:t,format:"png",transparent:a.firstLayer?!1:!0,opacity:a.opacity,visible:null!==a.visibility?a.visibility:!0,resourceInfo:e,refreshInterval:a.refreshInterval});n.spatialReference.wkid=e.spatialReferences[0]}else if("KML"===a.type){r=a.url;if(d.id){var V=d.id.findCredential(z.urlToObject(Q.arcgisUrl).path);V&&(b=Q.arcgisUrl.substring(Q.arcgisUrl.indexOf("//")+2,Q.arcgisUrl.indexOf("/",
Q.arcgisUrl.indexOf("//")+3)),g=b.split("."),g=g[g.length-2]+"."+g[g.length-1],p=r.indexOf(g),-1<p&&(r="https://"+b+r.substring(p+g.length),r+="?token\x3d"+V.token))}n=new Ua(r,{id:a.id,visible:null!==a.visibility?a.visibility:!0,outSR:e,refreshInterval:a.refreshInterval});q.connect(n,"onLoad",function(){(a.opacity||0===a.opacity)&&n.setOpacity(a.opacity);k.isDefined(a.minScale)&&k.isDefined(a.maxScale)&&n.setScaleRange(a.minScale,a.maxScale);a.visibleFolders&&h.forEach(n.folders,function(b){-1<h.indexOf(a.visibleFolders,
b.id)?n.setFolderVisibility(b,!0):n.setFolderVisibility(b,!1)},this)})}else if("WebTiledLayer"===a.type){if(n=new Va(a.templateUrl,{id:a.id,visible:null!==a.visibility?a.visibility:!0,opacity:a.opacity,copyright:a.copyright,fullExtent:a.fullExtent&&new A(a.fullExtent),initialExtent:a.fullExtent&&new A(a.fullExtent),subDomains:a.subDomains,tileInfo:a.tileInfo?new Wa(a.tileInfo):null,refreshInterval:a.refreshInterval,wmtsInfo:a.wmtsInfo}),k.isDefined(a.minScale)||k.isDefined(a.maxScale))n.loaded?n.setScaleRange(a.minScale,
a.maxScale):q.connect(n,"onLoad",function(){n.setScaleRange(a.minScale,a.maxScale)})}else if("GeoRSS"===a.type)n=new Xa(a.url,{id:a.id,opacity:a.opacity,outSpatialReference:e,refreshInterval:a.refreshInterval}),q.connect(n,"onLoad",function(){!1===a.visibility&&n.hide();k.isDefined(a.minScale)&&k.isDefined(a.maxScale)&&n.setScaleRange(a.minScale,a.maxScale);var b=n.getFeatureLayers();h.forEach(b,function(c){a.pointSymbol&&"esriGeometryPoint"===c.geometryType?(c.renderer.symbol=x.fromJson(a.pointSymbol),
1===b.length&&(n.pointSymbol=x.fromJson(a.pointSymbol))):a.lineSymbol&&"esriGeometryPolyline"===c.geometryType?(c.renderer.symbol=x.fromJson(a.lineSymbol),1===b.length&&(n.polylineSymbol=x.fromJson(a.lineSymbol))):a.polygonSymbol&&"esriGeometryPolygon"===c.geometryType&&(c.renderer.symbol=x.fromJson(a.polygonSymbol),1===b.length&&(n.polygonSymbol=x.fromJson(a.polygonSymbol)))})});else if("CSV"==a.type&&a.url)e={layerDefinition:a.layerDefinition,columnDelimiter:a.columnDelimiter,id:a.id?a.id:null,
visible:null!==a.visibility?a.visibility:!0,opacity:a.opacity,refreshInterval:a.refreshInterval},a.locationInfo&&(e.latitudeFieldName=a.locationInfo.latitudeFieldName,e.longitudeFieldName=a.locationInfo.longitudeFieldName),c.ignorePopups||(e.infoTemplate=new D(a.popupInfo?a.popupInfo:Ya.generateDefaultPopupInfo(a))),n=new Za(a.url,e);else if("VectorTileLayer"===a.layerType&&a.styleUrl)n=new ra(a.styleUrl,{id:a.id,minScale:a.minScale,maxScale:a.maxScale,opacity:a.opacity,visible:a.visibility});else if(a.layerDefinition&&
!a.url)e=f.fromJson(f.toJson(a)),delete e.id,delete e.opacity,delete e.visibility,n=new w(e,{id:a.id,opacity:a.opacity,visible:a.visibility,outFields:["*"],autoGeneralize:!0}),!c.ignorePopups&&e.popupInfo&&n.setInfoTemplate(new J(e.popupInfo)),P(n);else if("BingMapsAerial"===a.type||"BingMapsRoad"===a.type||"BingMapsHybrid"===a.type)c.bingMapsKey?(e=W.MAP_STYLE_AERIAL_WITH_LABELS,"BingMapsAerial"===a.type?e=W.MAP_STYLE_AERIAL:"BingMapsRoad"===a.type&&(e=W.MAP_STYLE_ROAD),n=new W({bingMapsKey:c.bingMapsKey,
mapStyle:e,opacity:a.opacity,id:a.id}),q.connect(n,"onError",m.hitch(this,function(a){a.errors=a.errors||[];a.errors.push({message:"This application does not have a valid Bing Key for the Bing layer that is included in this map. [type:"+a.type+"]"})},a))):(a.errors=a.errors||[],a.errors.push({message:"This application does not provide a Bing Key for the Bing layer that is included in this map. [type:"+a.type+"]"}));else if(a.resourceInfo&&a.resourceInfo.mapName)n=!0===a.resourceInfo.singleFusedMapCache&&
(a.baseMapLayer||ba(a,b,e)&&ga(a,g,p))?ea(a,J,c):ka(a,J,c);else if(a.resourceInfo&&a.resourceInfo.pixelSizeX)n=!0===a.resourceInfo.singleFusedMapCache&&(a.baseMapLayer||ba(a,b,e)&&ga(a,g,p))?ea(a,J,c):la(a,J,c);else if(a.resourceInfo&&"Feature Layer"===a.resourceInfo.type){a.capabilities&&(a.resourceInfo.capabilities=a.capabilities);var ca;!1===c.editable?ca=!1:c.privileges&&-1===h.indexOf(c.privileges,"features:user:edit")&&d.id&&d.id.findCredential(a.url)&&(ca=!1);n=new w(S(a.url),{resourceInfo:a.resourceInfo,
opacity:a.opacity,visible:a.visibility,id:a.id,mode:a.mode===w.MODE_SELECTION?w.MODE_SELECTION:w.MODE_AUTO,editable:ca,outFields:["*"],autoGeneralize:!0,refreshInterval:a.refreshInterval});!c.ignorePopups&&a.popupInfo&&n.setInfoTemplate(new J(a.popupInfo));a.layerDefinition&&(a.layerDefinition.drawingInfo&&a.layerDefinition.drawingInfo.renderer&&(e=C.fromJson(a.layerDefinition.drawingInfo.renderer),e.isMaxInclusive=!0,n.setRenderer(e)),a.layerDefinition.drawingInfo&&a.layerDefinition.drawingInfo.labelingInfo&&
(e=h.map(a.layerDefinition.drawingInfo.labelingInfo,function(a){return new $a(a)}),n.setLabelingInfo(e)),a.layerDefinition.definitionExpression&&n.setDefinitionExpression(a.layerDefinition.definitionExpression),k.isDefined(a.layerDefinition.minScale)&&n.setMinScale(a.layerDefinition.minScale),k.isDefined(a.layerDefinition.maxScale)&&n.setMaxScale(a.layerDefinition.maxScale));P(n)}else a.resourceInfo&&a.resourceInfo.streamUrls&&(e={resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,
id:a.id},a.layerDefinition&&(V=a.layerDefinition.drawingInfo,a.layerDefinition.definitionGeometry&&(r=r||{},r.geometry=a.layerDefinition.definitionGeometry),k.isDefined(a.layerDefinition.definitionExpression)&&(r=r||{},r.where=a.layerDefinition.definitionExpression),k.isDefined(a.layerDefinition.maximumTrackPoints)&&(e.maximumTrackPoints=a.layerDefinition.maximumTrackPoints)),r&&(e.filter=r),a.purgeOptions&&(e.purgeOptions=a.purgeOptions),n=new ab(S(a.url),e),V&&V.renderer&&(e=V.renderer,n.setRenderer(C.fromJson(e))),
!c.ignorePopups&&a.popupInfo&&n.setInfoTemplate(new J(a.popupInfo)),a.layerDefinition&&(k.isDefined(a.layerDefinition.minScale)&&n.setMinScale(a.layerDefinition.minScale),k.isDefined(a.layerDefinition.maxScale)&&n.setMaxScale(a.layerDefinition.maxScale)),u.once(n,"error",function(b){a.errors.push({message:"Error loading stream layer. Check websocket url"})}));n&&(n.arcgisProps={title:a.title},a.baseMapLayer&&(a.isReference?(n.attr("data-reference",!0),n._basemapGalleryLayerType="reference"):n._basemapGalleryLayerType=
"basemap"));return n}function ha(a,b,c,d,e){h.forEach(a,function(f){f.layerObject=ma(f,a,b,c,d,e)});var f=h.filter(a,function(a){return!a.isReference}),g=h.filter(a,function(a){return!!a.isReference});return a=f.concat(g)}function M(a){var b=null;a=a[0];a.url&&!a.type?a.resourceInfo.spatialReference&&(b=new l,a.resourceInfo.spatialReference.wkid&&(b.wkid=a.resourceInfo.spatialReference.wkid),a.resourceInfo.spatialReference.wkt&&(b.wkt=a.resourceInfo.spatialReference.wkt)):a.type&&(-1<a.type.indexOf("BingMaps")||
"OpenStreetMap"==a.type?b=new l({wkid:102100}):"WMS"==a.type&&(b=new l({wkid:a.spatialReferences[0]})));return b}function N(a,b,c,d,e,f,g,k){h.forEach(b,function(b){b.url&&!b.type&&(b.resourceInfo=a[b.deferredsPos][1],delete b.deferredsPos)});f=f||M(b);b=ha(b,c,f,g,k);e.callback(b);return e}function P(a){!window.CanvasRenderingContext2D&&a.renderer&&"esri.renderer.HeatmapRenderer"===a.renderer.declaredClass&&a.setRenderer(C.fromJson({type:"simple",symbol:{color:[77,77,77,255],size:6,angle:0,xoffset:0,
yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[255,255,255,255],width:.75,type:"esriSLS",style:"esriSLSSolid"}}}))}function wa(b,c){var d=S(b);return a({url:d,content:{f:"json"},callbackParamName:"callback",error:function(a,b){a.message=a.message?a.message+(" [url:"+d+"]"):"[url:"+d+"]";c.push(a);e.defaults.io.errorHandler(a,b)}})}function xa(b){var c=Q.arcgisUrl+"/"+b.itemId+"/data";return a({url:c,content:{f:"json"},callbackParamName:"callback",error:function(a,d){a.message=a.message?
a.message+(" [url:"+c+"]"):"[url:"+c+"]";b.errors=b.errors||[];b.errors.push(a);e.defaults.io.errorHandler(a,d)}})}function ya(a,b,c){var d=new p;if(!(c.featureCollection&&c.featureCollection.layers||c.layers))return console.log("Invalid Feature Collection item data [item id: "+a.itemId+"]: ",c),a.errors=a.errors||[],a.errors.push({message:"Invalid Feature Collection item data. [item id: "+a.itemId+"]"}),d.errback(),d;c.layers&&(c.featureCollection={layers:c.layers},delete c.layers,k.isDefined(c.showLegend)&&
(c.featureCollection.showLegend=c.showLegend,delete c.showLegend));za(a,c.featureCollection,b).then(function(b){c.featureCollection=b;a.featureCollection&&a.featureCollection.layers?h.forEach(c.featureCollection.layers,function(b,c){var d=a.featureCollection.layers[c];d.popupInfo||d.layerDefinition?d.layerDefinition?(k.isDefined(d.layerDefinition.minScale)&&k.isDefined(d.layerDefinition.maxScale)&&(d.layerDefinition.minScale!==b.layerDefinition.minScale||d.layerDefinition.maxScale!==b.layerDefinition.maxScale)&&
(delete b.layerDefinition.minScale,delete b.layerDefinition.maxScale),d.layerDefinition.drawingInfo&&f.toJson(d.layerDefinition.drawingInfo)!==f.toJson(b.layerDefinition.drawingInfo)&&delete b.layerDefinition.drawingInfo,d.layerDefinition.showLegend!==b.layerDefinition.showLegend&&delete b.layerDefinition.showLegend,d.layerDefinition=m.mixin(d.layerDefinition,b.layerDefinition)):d.layerDefinition=b.layerDefinition:(d.popupInfo=b.popupInfo,d.layerDefinition=b.layerDefinition);d.featureSet=b.featureSet;
d.nextObjectId=b.nextObjectId}):(a.featureCollection=a.featureCollection||{},a.featureCollection=m.mixin(a.featureCollection,c.featureCollection));d.callback(a)});return d}function za(a,b,c){var d=new p;n(["./csv"],function(e){var f=[];h.forEach(b.layers,function(a){a.featureSet&&a.featureSet.features&&a.featureSet.features.length&&a.featureSet.features[0].geometry&&a.featureSet.features[0].geometry.spatialReference&&(a.deferredsPos=f.length,f.push(e.projectFeatureCollection(a,c,a.featureSet.features[0].geometry.spatialReference)))});
(new r(f)).addCallback(function(){h.forEach(b.layers,function(b){k.isDefined(b.deferredsPos)&&(f[b.deferredsPos].results&&f[b.deferredsPos].results.length?b=f[b.deferredsPos].results[0]:(console.log("Errors projecting feature collection. ["+a.title+" - "+b.layerDefinition.name+"]"),b.errors=b.errors||[],b.errors.push({message:"Errors projecting feature collection. ["+a.title+" - "+b.layerDefinition.name+"]"})),delete b.deferredsPos)});d.callback(b)})});return d}function na(a,b,c,d,e){var f=new p,
g=new p,k=[],l;h.forEach(a.operationalLayers,function(a){a.itemId&&"Feature Collection"==a.type&&k.push(xa(a).then(m.hitch(null,ya,a,c)))});0===k.length?Aa(a,b,c,d,g,e):(l=new r(k),l.addCallback(function(f){Aa(a,b,c,d,g,e)}));g.then(function(a){k=[];h.forEach(a,function(a){var b;a=a.layerObject;a instanceof w&&!a.loaded&&!a.loadError?(b=new p,u.once(a,"load, error",function(){b.callback(a)}),k.push(b)):a&&"esri.layers.WFSLayer"===a.declaredClass&&!a.loadError&&(b=new p,u.once(a,"fromJsonComplete, error",
function(c){b.callback(a)}),k.push(b))});if(k.length){var b=new p;l=new r(k);l.addCallback(function(){b.callback(a)});return b.promise}return a}).then(function(a){var b=[];h.forEach(a,function(a){var c=a.layerObject;c instanceof w?c.loaded&&c.labelingInfo&&(a.showLabels||c._collection)&&b.push(c):c&&"esri.layers.WFSLayer"===c.declaredClass&&c.loaded&&c.labelingInfo&&b.push(c)});b.length?n(["../layers/LabelLayer"],function(c){var d=new c;h.forEach(b,function(a){d.addFeatureLayer(a)});a.push({layerObject:d});
f.callback(a)}):f.callback(a)});return f}function Aa(a,b,c,d,e,f){var g=[],k=[],l=[];h.forEach(a.operationalLayers,function(a,b){if(a.featureCollection&&a.featureCollection.layers){var c=a.featureCollection.layers.length;h.forEach(a.featureCollection.layers,function(d,e){var f=!0;a.visibleLayers&&-1==h.indexOf(a.visibleLayers,e)&&(f=!1);d.visibility=a.visibility&&f;d.opacity=a.opacity;d.id=(a.id||"operational"+b)+"_"+e;a.title&&(d.title=1!==c&&d.layerDefinition.name&&a.title!==d.layerDefinition.name?
a.title+" - "+d.layerDefinition.name:a.title);l.push(d)},this)}else l.push(a)});h.forEach(a.baseMap.baseMapLayers,function(a,b){a.baseMapLayer=!0;a.id=a.id||"base"+b;g.push(a)});h.forEach(l,function(a,b){a.id=a.id||"operational"+b;g.push(a)});h.forEach(g,function(a){a.url&&!a.type&&(a.deferredsPos=k.length,a.errors=a.errors||[],k.push(wa(a.url,a.errors)))});0===k.length?(c=c||M(g),g=ha(g,b,c,d,f),e.callback(g)):(new r(k)).addCallback(function(a){N(a,g,b,k,e,c,d,f)});return e}function oa(a,b,c,d){var e=
a.minScale,f=a.maxScale;if(10.1>=c.version&&b)for(a=b.length-1;0<=a;a--){if(b[a].id==d)if(0==e&&0<b[a].minScale?e=b[a].minScale:0<e&&0==b[a].minScale?e=c.minScale:0<e&&0<b[a].minScale&&(e=Math.min(e,b[a].minScale)),f=Math.max(c.maxScale||0,b[a].maxScale||0),c.setScaleRange(e,f),-1<b[a].parentLayerId)d=b[a].parentLayerId;else break}else 10.1<c.version&&(h.forEach(a.layerInfos,function(a){a.id==d&&(0==e&&0<a.minScale?e=a.minScale:0<e&&0==a.minScale||0<e&&0<a.minScale&&(e=Math.min(e,a.minScale)),f=Math.max(f||
0,a.maxScale||0))}),c.setScaleRange(e,f))}function pa(a,b,c,d){var e=a.url,f=a.__popupIds,g=a.__popupUrls,l=a.__popupWhereClauses,n=a.__popupMinScales,p=a.__popupMaxScales,r=a.__resourceInfo,u=[];h.forEach(a.__popups,function(d,m){if(d){var t,v=[];h.forEach(d.fieldInfos,function(a){"shape"!==a.fieldName.toLowerCase()&&v.push(a.fieldName)});if(a.dynamicLayerInfos&&0<a.dynamicLayerInfos.length){var x=h.filter(a.dynamicLayerInfos,function(a){return f[m]==a.id})[0].source;t=new w(e+"/dynamicLayer",{id:a.id+
"_"+f[m],source:x,outFields:v,mode:w.MODE_SELECTION,infoTemplate:d&&new c(d),drawMode:!1,visible:a.visible,autoGeneralize:!0});var V=function(c,d){0<l[c].length&&d.setDefinitionExpression(l[c]);if(k.isDefined(n[c])||k.isDefined(p[c]))if(k.isDefined(a.minScale)||k.isDefined(a.maxScale)){var e=a.minScale,g=a.maxScale;0==e&&0<n[c]?e=n[c]:0<e&&0==n[c]||0<e&&0<n[c]&&(e=Math.min(e,n[c]));g=Math.max(g||0,p[c]||0);d.setScaleRange(e,g)}else d.setScaleRange(n[c],p[c]);else oa(a,b||r.layers,d,f[c])};t.loaded?
V(m,t):q.connect(t,"onLoad",function(a){V(m,t)})}else{var ia=null,ca=e+"/"+f[m];if(g[m].length)ca=g[m];else if(b)for(x=0;x<b.length;x++)if(b[x].id===f[m]){ia=b[x];break}t=new w(S(ca),{id:a.id+"_"+f[m],outFields:v,mode:w.MODE_SELECTION,infoTemplate:d&&new c(d),drawMode:!1,visible:a.visible,resourceInfo:ia,autoGeneralize:!0});t.loaded?(0<l[m].length&&t.setDefinitionExpression(l[m]),oa(a,b||r.layers,t,f[m])):q.connect(t,"onLoad",function(c){0<l[m].length&&t.setDefinitionExpression(l[m]);oa(a,b||r.layers,
c,f[m])})}u.push(t)}});0<u.length&&(q.connect(a,"onVisibilityChange",m.hitch(this,function(a,b){h.forEach(a,function(a){b?a.show():a.hide()})},u)),q.connect(d,"onLayerRemove",m.hitch(this,function(a,b,c){a.id===c.id&&h.forEach(b,function(a){d.removeLayer(a)})},a,u)));delete a.__popups;delete a.__popupIds;delete a.__popupUrls;delete a.__popupWhereClauses;delete a.__popupMinScales;delete a.__popupMaxScales;delete a.__resourceInfo;return u}function Ba(b){return a({url:S(b.url+"/layers"),content:{f:"json"},
callbackParamName:"callback",error:function(){}})}function Ca(a,b,c){var d=[];h.forEach(a,function(a){var b=a.__popups;b&&1<b.length&&10<=a.version&&(a.__deferredsPos=d.length,d.push(Ba(a)))});var e=[];0<d.length?(new r(d)).addCallback(function(d){h.forEach(a,function(a){a.__popups&&0<a.__popups.length&&(a.__deferredsPos||0===a.__deferredsPos?(e=e.concat(pa(a,d[a.__deferredsPos][1].layers,c,b)),delete a.__deferredsPos):e=e.concat(pa(a,null,c,b)))});b.addLayers(e)}):(h.forEach(a,function(a){a.__popups&&
0<a.__popups.length&&(e=e.concat(pa(a,null,c,b)))}),b.addLayers(e))}function Da(a){h.forEach(a,function(a){var b=a.layer;b.toJson&&(a=b.toJson(),a.featureSet&&b.name&&-1<b.name.indexOf("Text")&&h.forEach(a.featureSet.features,function(a,c){if(a.attributes.TEXT){var d=b.graphics[c];d.symbol.setText(a.attributes.TEXT);a.symbol.horizontalAlignment&&(d.symbol.align=a.symbol.horizontalAlignment);d.setSymbol(d.symbol);d.setAttributes(a.attributes)}},this))})}function Ea(a){var b=6;h.forEach(a,function(a){if(a=
a.renderer)"esri.renderer.SimpleRenderer"===a.declaredClass?((a=a.symbol)&&a.xoffset&&(b=Math.max(b,Math.abs(a.xoffset))),a&&a.yoffset&&(b=Math.max(b,Math.abs(a.yoffset)))):"esri.renderer.UniqueValueRenderer"!==a.declaredClass&&"esri.renderer.ClassBreaksRenderer"!==a.declaredClass||h.forEach(a.infos,function(a){(a=a.symbol)&&a.xoffset&&(b=Math.max(b,Math.abs(a.xoffset)));a&&a.yoffset&&(b=Math.max(b,Math.abs(a.yoffset)))})});return b}function ua(a){var b=this,c=b.infoWindow,d=a.graphic;if(b.loaded){c.hide();
c.clearFeatures();var e=[];h.forEach(b.graphicsLayerIds,function(a){(a=b.getLayer(a))&&a instanceof w&&a.loaded&&a.visible&&(a.clearSelection(),a.infoTemplate&&!a.suspended&&e.push(a))});h.forEach(b.layerIds,function(a){(a=b.getLayer(a))&&-1!==a.declaredClass.indexOf("ArcGISImageServiceLayer")&&a.loaded&&a.visible&&a.infoTemplate&&e.push(a)});d=d&&d.getInfoTemplate()?d:null;if(e.length||d){var f=Ea(e),g=a.screenPoint,k=b.toMap(new y(g.x-f,g.y+f)),f=b.toMap(new y(g.x+f,g.y-f)),k=new A(k.x,k.y,f.x,
f.y,b.spatialReference),l=new E;l.geometry=k;l.timeExtent=b.timeExtent;var m=!0,k=h.map(e,function(b){var c;-1!==b.declaredClass.indexOf("ArcGISImageServiceLayer")?(l.geometry=a.mapPoint,m=!1,c=b.queryVisibleRasters(l,{rasterAttributeTableFieldPrefix:"Raster.",returnDomainValues:!0}),c.addCallback(function(){return b.getVisibleRasters()})):(c=b.selectFeatures(l),c.addCallback(function(){return b.getSelectedFeatures()}));return c});d&&(f=new p,f.callback([d]),k.splice(0,0,f));if(!h.some(k,function(a){return-1===
a.fired})){var n=d?1:0;h.forEach(e,function(a){n=-1!==a.declaredClass.indexOf("ArcGISImageServiceLayer")?n+a.getVisibleRasters().length:n+a.getSelectedFeatures().length});if(!n)return}c.setFeatures(k);c.show(a.mapPoint,{closestFirst:m})}}}function cb(a,b){var d=b.mapOptions||{},e;d.infoWindow||(e=new H({visibleWhenEmpty:!1},c.create("div")),d.infoWindow=e);k.isDefined(d.showInfoWindowOnClick)||b.usePopupManager||(d.showInfoWindowOnClick=!1);d=new t(a,d);q.connect(d,"onLayersAddResult",Da);return d}
function X(a,b,c,d,e,f){var g,k,l,m;d.map?(g=d.map,k=d.clickEventHandle,l=d.clickEventListener,m=d.errors):(g=cb(d,e),e.ignorePopups||e.disableClickBehavior||e.usePopupManager||(k=q.connect(g,"onClick",ua),l=ua));g.addLayers(a);e.ignorePopups||e.usePopupManager||Ca(a,g,e._clazz);var n=m||[];h.forEach(b,function(a){a.errors&&(n=n.concat(a.errors))},this);g.loaded?f.callback({map:g,itemInfo:c,errors:n,clickEventHandle:k,clickEventListener:l}):q.connect(g,"onLoad",function(){f.callback({map:g,itemInfo:c,
errors:n,clickEventHandle:k,clickEventListener:l})})}function qa(a,b,c,d,e){var f=[];h.forEach(e,function(a){m.isArray(a.layerObject)?h.forEach(a.layerObject,function(a){f.push(a)}):f.push(a.layerObject)});if("BingMapsAerial"===e[0].type||"BingMapsRoad"===e[0].type||"BingMapsHybrid"===e[0].type)var g=setInterval(function(){if(e[0].layerObject&&e[0].layerObject.loaded)clearInterval(g),Fa(a,b,c,d,e,f);else if(e[0].errors){clearInterval(g);var h="";e[0].errors&&e[0].errors.length&&(h=" ("+e[0].errors[0].message+
")");d.errback(Error(G.arcgis.utils.baseLayerError+h))}},10);else if(!f[0]&&e[0].baseMapLayer){var k="";e[0].errors&&e[0].errors.length&&(k=" ("+e[0].errors[0].message+")");d.errback(Error(G.arcgis.utils.baseLayerError+k))}else Fa(a,b,c,d,e,f)}function Fa(a,b,c,d,f,m){try{var n=c.mapOptions||{};c.mapOptions=n;var p=a.item,q=a.itemData;!n.backgroundColor&&q.background&&q.background.color&&null!=q.background.color[0]&&(n.backgroundColor=g.toDojoColor(q.background.color));m=h.filter(m,k.isDefined);if(p)if(p.extent&&
p.extent.length)if(n.extent)X(m,f,a,b,c,d);else{var r=new A(p.extent[0][0],p.extent[0][1],p.extent[1][0],p.extent[1][1],new l({wkid:4326})),t=m[0].spatialReference;4326===t.wkid?(n.extent=r,X(m,f,a,b,c,d)):102100===t.wkid||102113===t.wkid||3857===t.wkid?(r.xmin=Math.max(r.xmin,-180),r.xmax=Math.min(r.xmax,180),r.ymin=Math.max(r.ymin,-89.99),r.ymax=Math.min(r.ymax,89.99),n.extent=B.geographicToWebMercator(r),X(m,f,a,b,c,d)):c.geometryServiceURL||e.defaults.geometryService?(c.geometryServiceURL?new F(c.geometryServiceURL):
e.defaults.geometryService).project([r],t,function(e){e=e[0];n.extent=n.extent||e;X(m,f,a,b,c,d)},function(){X(m,f,a,b,c,d)}):d.errback(Error(G.arcgis.utils.geometryServiceError))}else X(m,f,a,b,c,d);else X(m,f,a,b,c,d)}catch(fb){d.errback(fb)}}function db(a){var b=[];h.forEach(a.operationalLayers,function(a){a.featureCollection?b.push({featureCollection:a.featureCollection,visibility:a.visibility,title:a.title}):a.layerObject&&b.push({layer:a.layerObject,visibility:a.visibility,title:a.title})});
return b}function Ga(a){var b=[],c=a.baseMap.baseMapLayers;a.operationalLayers&&(c=c.concat(a.operationalLayers));h.forEach(c,function(a){var c={};if(a.featureCollection&&"CSV"!==a.type)!0===a.featureCollection.showLegend&&h.forEach(a.featureCollection.layers,function(d){if(!1!==d.showLegend){var e=d.layerObject.renderer;c={layer:d.layerObject,title:a.title,defaultSymbol:e&&e.defaultSymbol&&e.defaultLabel?!0:!1};1<a.featureCollection.layers.length&&(c.title+=" - "+d.layerDefinition.name);b.push(c)}});
else if(a.baseMapLayer&&!0===a.showLegend&&a.layerObject||!a.baseMapLayer&&!1!==a.showLegend&&a.layerObject&&!(a.layerObject instanceof w&&a.layerObject.mode===w.MODE_SELECTION)){var d=a.layerObject.renderer,e=a.layerObject.declaredClass,d=!d||d&&d.defaultSymbol&&d.defaultLabel?!0:!1;if(10.1>a.layerObject.version&&("esri.layers.ArcGISDynamicMapServiceLayer"===e||"esri.layers.ArcGISTiledMapServiceLayer"===e)||"esri.layers.ArcGISImageServiceLayer"===e)d=!0;c={layer:a.layerObject,title:a.title,defaultSymbol:d};
a.layers&&(e=h.map(h.filter(a.layers,function(a){return!1===a.showLegend}),function(a){return a.id}),e.length&&(c.hideLayers=e));b.push(c)}});return b}function eb(a,b){function c(a,b){h.forEach(a,function(a,c){switch(a){case "../layers/ArcGISDynamicMapServiceLayer":Ia=b[c];break;case "../layers/ArcGISImageServiceLayer":Pa=b[c];break;case "../layers/ArcGISImageServiceVectorLayer":Oa=b[c];break;case "./csv":Ya=b[c];break;case "../layers/CSVLayer":Za=b[c];break;case "../layers/DynamicLayerInfo":Ja=b[c];
break;case "../layers/GeoRSSLayer":Xa=b[c];break;case "../layers/ImageParameters":Ha=b[c];break;case "../layers/ImageServiceParameters":La=b[c];break;case "../layers/KMLLayer":Ua=b[c];break;case "../layers/LabelClass":$a=b[c];break;case "../layers/LayerDrawingOptions":Ka=b[c];break;case "../layers/MosaicRule":Na=b[c];break;case "../layers/OpenStreetMapLayer":Qa=b[c];break;case "../layers/RasterFunction":Ma=b[c];break;case "../layers/StreamLayer":ab=b[c];break;case "../layers/TileInfo":Wa=b[c];break;
case "../layers/VectorTileLayer":ra=b[c];break;case "../virtualearth/VETiledLayer":W=b[c];break;case "../layers/WebTiledLayer":Va=b[c];break;case "../layers/WFSLayer":Ra=b[c];break;case "../layers/WMSLayer":Ta=b[c];break;case "../layers/WMSLayerInfo":Sa=b[c]}})}var d=new p,e=a.itemData,f=[];e.baseMap&&e.baseMap.baseMapLayers&&(f=f.concat(e.baseMap.baseMapLayers));e.operationalLayers&&(f=f.concat(e.operationalLayers));for(var e=h.map(f,function(a){return a&&a.layerType}),g=[],k=[],f=!1,l=0;l<e.length;l++){switch(e[l]){case "ArcGISFeatureLayer":-1===
h.indexOf(g,"../layers/LabelClass")&&g.push("../layers/LabelClass");break;case "ArcGISImageServiceLayer":case "ArcGISTiledImageServiceLayer":-1===h.indexOf(g,"../layers/ArcGISImageServiceLayer")&&(g.push("../layers/ArcGISImageServiceLayer"),k.push("../layers/ImageServiceParameters"),k.push("../layers/MosaicRule"),k.push("../layers/RasterFunction"));break;case "ArcGISImageServiceVectorLayer":-1===h.indexOf(g,"../layers/ArcGISImageServiceVectorLayer")&&(g.push("../layers/ArcGISImageServiceVectorLayer"),
k.push("../layers/ImageServiceParameters"),k.push("../layers/MosaicRule"),k.push("../layers/RasterFunction"));break;case "ArcGISMapServiceLayer":case "ArcGISTiledMapServiceLayer":-1===h.indexOf(g,"../layers/ArcGISDynamicMapServiceLayer")&&(g.push("../layers/ArcGISDynamicMapServiceLayer"),k.push("../layers/DynamicLayerInfo"),k.push("../layers/ImageParameters"),k.push("../layers/LayerDrawingOptions"));break;case "ArcGISStreamLayer":-1===h.indexOf(g,"../layers/StreamLayer")&&g.push("../layers/StreamLayer");
break;case "BingMapsAerial":case "BingMapsHybrid":case "BingMapsRoad":-1===h.indexOf(g,"../virtualearth/VETiledLayer")&&g.push("../virtualearth/VETiledLayer");break;case "CSV":-1===h.indexOf(g,"../layers/CSVLayer")&&(g.push("../layers/CSVLayer"),k.push("./csv"));break;case "GeoRSS":-1===h.indexOf(g,"../layers/GeoRSSLayer")&&g.push("../layers/GeoRSSLayer");break;case "KML":-1===h.indexOf(g,"../layers/KMLLayer")&&g.push("../layers/KMLLayer");break;case "OpenStreetMap":-1===h.indexOf(g,"../layers/OpenStreetMapLayer")&&
g.push("../layers/OpenStreetMapLayer");break;case "VectorTileLayer":-1===h.indexOf(g,"../layers/VectorTileLayer")&&g.push("../layers/VectorTileLayer");break;case "WebTiledLayer":-1===h.indexOf(g,"../layers/WebTiledLayer")&&(g.push("../layers/WebTiledLayer"),k.push("../layers/TileInfo"));break;case "WFS":-1===h.indexOf(g,"../layers/WFSLayer")&&g.push("../layers/WFSLayer");break;case "WMS":-1===h.indexOf(g,"../layers/WMSLayer")&&(g.push("../layers/WMSLayer"),k.push("../layers/WMSLayerInfo"));break;
default:f=!0}if(f)break}f&&(g=gb,k=hb);g.length?n(g,function(){c(g,arguments);k.length?n(k,function(){c(k,arguments);d.resolve()}):d.resolve()}):d.resolve();return d}function bb(a,b,c,d){var e=d.itemData;e.baseMap&&e.baseMap.baseMapLayers&&e.baseMap.baseMapLayers.length&&(e.baseMap.baseMapLayers[0].firstLayer=!0);var f=b.layerMixins,g=f&&f.length;if(g){var k=function(a){for(var b=0;b<g;b++){var c=f[b];if(c.mixin)if(c.hasOwnProperty("id")){if(a.id===c.id){m.mixin(a,c.mixin);break}}else if(a.url===
c.url){m.mixin(a,c.mixin);break}}};h.forEach(e.baseMap&&e.baseMap.baseMapLayers,k);h.forEach(e.operationalLayers,k)}eb(d,b).then(function(){return ta(d,b)}).then(function(){return sa(d,b)}).then(function(b){var d=b[0],e=b[1];if(d.itemData.operationalLayers&&0!==d.itemData.operationalLayers.length){var f=new p,g=d.itemData.baseMap.baseMapLayers.slice(),k=h.filter(d.itemData.baseMap.baseMapLayers,function(a){return!a.isReference});b={item:d.item,itemData:{baseMap:{baseMapLayers:k}}};d.itemData.baseMap.baseMapLayers=
h.filter(d.itemData.baseMap.baseMapLayers,function(a){return a.isReference});aa(b,e).addCallback(function(b){na(b.itemData,e).addCallback(m.hitch(null,qa,b,a,e,f))});f.then(function(a){aa(d,e).addCallback(function(b){na(b.itemData,e,a.map.spatialReference,k,a.map).addCallback(function(d){b.itemData.baseMap.baseMapLayers=g;qa(b,a,e,c,d)})})},m.hitch(c,c.errback))}else aa(d,e).addCallback(function(b){na(b.itemData,e).addCallback(m.hitch(null,qa,b,a,e,c))})})}function va(b,c){"undefined"===typeof c&&
(c=!0);Q._arcgisUrl&&0<Q._arcgisUrl.length&&(Q.arcgisUrl=Q._arcgisUrl);var d=Q.arcgisUrl+"/"+b,e={},f=new p;a({url:d,content:{f:"json"},callbackParamName:"callback",load:function(b){e.item=b;c?a({url:d+"/data",content:{f:"json"},callbackParamName:"callback",load:function(a){e.itemData=a;f.callback(e)},error:function(a){f.errback(a)}}):f.callback(e)},error:function(a){f.errback(a)}});return f}var Q,Ia,Pa,Oa,Ya,Za,Ja,Xa,Ha,La,Ua,$a,Ka,Na,Qa,Ma,ab,Wa,ra,W,Va,Ra,Ta,Sa,gb="../layers/ArcGISDynamicMapServiceLayer ../layers/ArcGISImageServiceLayer ../layers/ArcGISImageServiceVectorLayer ../layers/CSVLayer ../layers/GeoRSSLayer ../layers/KMLLayer ../layers/LabelClass ../layers/OpenStreetMapLayer ../layers/StreamLayer ../layers/VectorTileLayer ../virtualearth/VETiledLayer ../layers/WebTiledLayer ../layers/WFSLayer ../layers/WMSLayer".split(" "),
hb="./csv ../layers/DynamicLayerInfo ../layers/ImageParameters ../layers/ImageServiceParameters ../layers/LayerDrawingOptions ../layers/MosaicRule ../layers/RasterFunction ../layers/TileInfo ../layers/WMSLayerInfo".split(" ");Q={arcgisUrl:z.getProtocolForWebResource()+"//www.arcgis.com/sharing/rest/content/items",getItem:va,createMap:function(a,b,c){var d=new p;c=c||{};var e=c.infoTemplateClass;c._clazz=e&&(m.isObject(e)?e:m.getObject(e))||D;m.isString(a)?va(a).addCallback(m.hitch(null,bb,b,c,d)).addErrback(m.hitch(d,
d.errback)):bb(b,c,d,a);return d},getLayerList:function(a){return a&&a.itemInfo&&a.itemInfo.itemData?db(a.itemInfo.itemData):[]},getLegendLayers:function(a){return a&&a.itemInfo&&a.itemInfo.itemData?Ga(a.itemInfo.itemData):[]},_arcgisUrl:null,_getItemProps:aa,_getItemData:O,_getBingKey:da,_portalUrlResponse:I,_portalUrlFailure:L,_processFSItemProperties:Z,_processSSItemProperties:ja,_getLayers:na,_preBuildLayerObjects:N,_buildLayerObjects:ha,_preCreateMap:qa,_getMapSR:M,_createMap:X,_addSelectionLayers:Ca,
_createSelectionFeatureLayers:pa,_getServiceInfo:wa,_getFeatureCollectionItem:xa,_mergeFeatureCollectionItem:ya,_projectFeatureCollection:za,_getLayersInfo:Ba,_initLayer:ma,_loadAsCached:ea,_loadAsDynamic:ka,_processPopups:U,_onLayersAddResult:Da,_sameSpatialReferenceAsBasemap:ba,_sameTilingSchemeAsBasemap:ga,_showPopup:ua,_calculateClickTolerance:Ea,_getVisibleFeatureLayers:fa,_updateLayerScaleInfo:oa,_checkUrl:S,_isHostedService:T,_isAgolService:Y,_getLegendLayers:Ga};m.setObject("arcgis.utils",
Q,d);return Q});